<div v-view-setup="PLyinbaoZDkkCtrl" v-init="init()">
    <!-- 乐盈宝自动转入签约  1-->
	<div v-page v-transition="native" title="乐盈宝自动转入签约 ">
	     <div class="bg_box">
	        <div class="box_cont">
	            <div class="zz_cont">
	                    <ul>
				      		<li>
								<em>签约账号：</em>
								<i>
								   {{accountNo|encryptAcNo}}
								</i>
								</i>
							</li>
							<li>
								<em>签约状态：</em>
								<i>{{state}}</i>
							</li>
					 </ul>
	            </div>
	            <div v-show="isSign != 'X'">
					<input type="button" class="button_1" name="button" value="查询"  v-click="toQry()">
				</div>
				
				<div v-show="isSign == 'X'">
					<input type="button" class="button_1" name="button" value="签约"  v-click="toSignPre()">
				</div>	
	        </div>
	     </div>
	</div>
	<!-- 乐盈宝自动转入签约详情  2-->
	<div v-page v-transition="native" title="乐盈宝自动转入签约">
	    <form name="transInput" class="bg_box">
	          <div class="box_cont">
	              <div class="zz_cont">
	                 	<ul>
						<li>
							<em>签约账号：</em>
							<i>{{accountNo|encryptAcNo}}</i>
						</li>
						<li>
							<em>保留金额：</em>
							<i class="colff6">{{amount|number:2}}元<button class="button_bj" v-click="modify()">修改金额</button></i>
						</li>
<!-- 					    <li> -->
<!-- 							<em>自动转入：</em> -->
<!-- 							<i>启用</i> -->
<!-- 						</li> -->
<!-- 						<li> -->
<!-- 							<em>手机号码：</em> -->
<!-- 							<i>{{mobileNo}}</i> -->
<!-- 						</li> -->
<!-- 						<li> -->
<!-- 							<em>签约状态：</em> -->
<!-- 							<i>{{state}}</i> -->
<!-- 						</li> -->
						<li>
							<em>签约日期：</em>
							<i>{{signDate|formatDate}}</i>
						</li>
					</ul>
	              </div>
	              <div class="zz_cont">
					<input type="button" class="button_1" name="button" value="解约"  v-click="toCancelPre()">
				</div>
	          </div>
	    </form>
	</div>
	<!-- 乐盈宝自动转入额度修改录入  3-->
	<div v-page v-transition="native" title="乐盈宝自动转入签约">
	    <form name="transConfirm" class="bg_box">
	       <div class="box_cont">
	            <div class="selected">
		        <span><img class="jindu" src="images/u1.png" /></span>
		         <span><img class="jindu" src="images/u2_1.png" /></span>
		          <span><img class="jindu" src="images/u3_1.png" /></span>
		      </div>
		      <div class="zz_cont">
		         <ul>
						<li><em>签约账号：</em><i>{{accountNo|encryptAcNo}}</i></li>
<!-- 						<li><em>自动转入：</em> -->
<!-- 						<i>启用</i> -->
<!-- 						</li> -->
						<li><em>保留金额：</em>
						<i>
						<input type="text" name="amount" placeholder="请输入金额" v-model="amount"  ui-num='{"maxlength":11,"hasDot":true}' class="y_srk" required>
						</i>
						</li>
					
				  </ul>
		        </div>
		        <div>
		     		<input type="submit"  class="button_1" name="Submit" v-disabled="!amount"  value="下一步" v-click="toNextConfirm()">
		     	</div>
	          </div>
	    </form>
	     <div class="zz_cont"><img src="images/ts.png" />
		    <font class="tishi">
				温馨提示</br>
			</font>
				<em>&nbsp;&nbsp;1、超出保留金额部分每日02:00后转入乐盈宝。</em></br>
				<em>&nbsp;&nbsp;2、保留金额最低设置为0.01元。</em></br>
			<div style="font-size:12px; line-height:16px; color:#929292;"> </div>
	  </div>
	</div>
	<!-- 乐盈宝自动转入额度修改确认  4-->
	<div v-page v-transition="native" title="乐盈宝自动转入签约">
	     <form name="transConfirm" class="bg_box">
	         <div class="box_cont">
	            <div class="selected">
		        <span><img class="jindu" src="images/u1.png" /></span>
		         <span><img class="jindu" src="images/u2.png" /></span>
		          <span><img class="jindu" src="images/u3_1.png" /></span>
		      </div>
		      <div class="zz_cont">
		           <ul>
						<li><em>签约账号：</em><i>{{accountNo|encryptAcNo}}</i></li>
<!-- 						<li><em>自动转入：</em><i>启用</i></li> -->
						<li><em>保留金额：</em><i>{{amount}}</i></li>
						 <li><em>验证码：</em> <i> <input type="tel" id="imgcode"
						name="imgcode" maxlength=4 v-model="imgcode" class="y_srk"
						placeholder="请输入验证码" style="width: 50%;" />
				</i>
				 					<img id="img" name="img" v-model="img" src="data:image/png;base64,{{TokenImg}}" data-ke-src="data:image/png;base64,{{TokenImg}}"  style="position:relative;left:40%;margin-top:3%" v-click="freshCode()">
<!-- 					<img id="img" name="img" v-model="img" -->
<!-- 					src="/pmobile/GenTokenImg.do" -->
<!-- 					style="position: relative; left: 40%; margin-top: 2%" -->
<!-- 					v-click="freshCode('img')"> -->
					</li>
				  </ul>
		      </div>
		      <div>
		     		<input type="submit"  class="button_1"  name="Submit"  value="确认" v-click="toModifyConfirm()">
		     	</div>
	         </div>
	     </form>
	      <div class="zz_cont"><img src="images/ts.png" />
		    <font class="tishi">
				温馨提示</br>
			</font>
				<em>&nbsp;&nbsp;1、超出保留金额部分每日02:00后转入乐盈宝。</em></br>
				<em>&nbsp;&nbsp;2、保留金额最低设置为0.01元。</em></br>
			<div style="font-size:12px; line-height:16px; color:#929292;"> </div>
	  </div>
	</div>
	<!--乐盈宝自动转入额度修改结果 5-->
	<div v-page v-transition="native" data-back="false" title="乐盈宝自动转入签约">
		<div class="bg_box">
		    <div class="box_cont">
			      <div class="selected">
			        <span><img class="jindu" src="images/u1.png" /></span>
			        <span><img class="jindu" src="images/u2.png" /></span>
			        <span><img class="jindu" src="images/u3.png" /></span>
			      </div>
			      	 
				  <div class="zz_cont">
				  	 <div v-show="IsReward=='true'" class="maind" style="margin:0px">
						<div class="d1" style="float:left;padding-left:5px;width:20%;padding-top:20px"><img src="images/cg_img.png" style="width:60px;height:60px"/></div>
						<div class="d2" style="float:left;width:50%;height:70px;  padding-top:9%;">
							 <div style="  text-align: center;font-size:x-large;color:#0069c9"> 修改成功</div>
							<div class="transtime" style="padding-bottom:0px;padding-top:10px;font-size:inherit;">{{TransDate}}</div>
						</div>
						<div class="d3"  style="padding-top: 25px;float:left;width:20%;margin-left:-3%"><img  v-click="gotoRewardPage()" src="images/img_reward.gif" style="width:100px;height:60px;"/></div>
					</div>
					<div v-hide="IsReward=='true'">
						<div class="d1" style="float:left;padding-left:50px;;width:20%;padding-top:20px"><img src="images/cg_img.png" style="width:60px;height:60px"/></div>
						<div class="d2" style="float:right;width:50%;height:70px;  padding-top:9%;padding-right:30px">
							 <div style="  text-align: center;font-size:x-large;color:#0069c9"> 修改成功</div>
							<div class="transtime" style="padding-bottom:0px;padding-top:10px;font-size:inherit;">{{TransDate}}</div>
						</div>
					</div>
<!-- 				     <div class="cc_img" ><img src="images/cg_img.png" style="width:120px;height:120px" /><br/>修改成功</div> -->
<!-- 				     <div class="transtime">{{TransDate}}</div> -->
				  </div>
		 	</div>
 		</div>
	</div>
	<!--乐盈宝自动转入签约录入 6-->
	<div v-page v-transition="native" title="乐盈宝自动转入">
	   <form name="transConfirm" class="bg_box">
	       <div class="box_cont">
	          <div class="selected">
	              <span><img class="jindu" src="images/u1.png" /></span>
		          <span><img class="jindu" src="images/u2_1.png" /></span>
		          <span><img class="jindu" src="images/u3_1.png" /></span>
	          </div>
	          <div class="zz_cont">
	                <ul>
						<li><em>签约账号：</em><i>{{accountNo|encryptAcNo}}</i></li>
						<li><em>保留金额：</em><i><input type="text" placeholder="最少0.01元" name="amount" v-model="amount" class="y_srk" required maxlength=18/></i></li>
				  </ul>
	          </div>
	          <div class="zz_cont" style="background-color: white">
	          			<input type="checkbox" name="agree" v-model="agree" /> 已阅读并同意<a
				style="color: blue" v-click="toXieYiPage()">《乐盈宝自动转入签约协议》</a>
		     		<input type="submit"  class="button_1" name="Submit"  v-disabled="!agree" value="下一步" v-click="toSignConfirm()">
		     	</div>
	       </div>
	   </form>
	   <div class="zz_cont"><img src="images/ts.png" />
		    <font class="tishi">
				温馨提示</br>
			</font>
				<em>&nbsp;&nbsp;1、超出保留金额部分每日02:00后转入乐盈宝。</em></br>
				<em>&nbsp;&nbsp;2、保留金额最低设置为0.01元。</em></br>
			<div style="font-size:12px; line-height:16px; color:#929292;"> </div>
	  </div>
	</div>
	<!-- 乐盈宝自动转入签约确认 7-->
	<div v-page v-transition="native" title="乐盈宝自动转入签约">
	   <form name="transConfirm" class="bg_box">
	      <div class="box_cont">
		      <div class="selected">
		        <span><img class="jindu" src="images/u1.png" /></span>
		         <span><img class="jindu" src="images/u2.png" /></span>
		          <span><img class="jindu" src="images/u3_1.png" /></span>
		      </div>
		          <div class="zz_cont">
			      <ul>
						<li><em>签约账号：</em><i>{{accountNo|encryptAcNo}}</i></li>
<!-- 						<li><em>自动转入：</em><i>启用</i></li> -->
						<li><em>保留金额：</em><i>{{amount}}</i></li>
							<li><em>验证码：</em> <i> <input type="tel" id="imgcode"
						name="imgcode" maxlength=4 v-model="imgcode" class="y_srk"
						placeholder="请输入验证码" style="width: 50%;" />
				</i> 	
				<img id="img" name="img" v-model="img" src="data:image/png;base64,{{TokenImg}}" data-ke-src="data:image/png;base64,{{TokenImg}}"  style="position:relative;left:40%;margin-top:3%" v-click="freshCode()">
<!-- 					<img id="img" name="img" v-model="img" -->
<!-- 					src="/pmobile/GenTokenImg.do" -->
<!-- 					style="position: relative; left: 40%; margin-top: 2%" -->
<!-- 					v-click="freshCode('img')"> -->
					</li>
				  </ul>
		       </div>
		       <div>
		     		<input type="submit"  class="button_1"  name="Submit1"  value="提交" v-click="toResult()">
		     	</div>
		   </div>
	   </form>
	    <div class="zz_cont"><img src="images/ts.png" />
		    <font class="tishi">
				温馨提示</br>
			</font>
				<em>&nbsp;&nbsp;1、超出保留金额部分每日02:00后转入乐盈宝。</em></br>
				<em>&nbsp;&nbsp;2、保留金额最低设置为0.01元。</em></br>
			<div style="font-size:12px; line-height:16px; color:#929292;"> </div>
	  </div>
	</div>
	<!-- 乐盈宝自动转入签约结果 8-->
	<div v-page v-transition="native" data-back="false"  title="乐盈宝自动转入签约">
	    	<div class="bg_box">
		    <div class="box_cont">
			      <div class="selected">
			        <span><img class="jindu" src="images/u1.png" /></span>
			        <span><img class="jindu" src="images/u2.png" /></span>
			        <span><img class="jindu" src="images/u3.png" /></span>
			      </div>
				  <div class="zz_cont">
				  <div v-show="IsReward=='true'" class="maind" style="margin:0px">
						<div class="d1" style="float:left;padding-left:5px;width:20%;padding-top:20px"><img src="images/cg_img.png" style="width:60px;height:60px"/></div>
						<div class="d2" style="float:left;width:50%;height:70px;  padding-top:9%;">
							 <div style="  text-align: center;font-size:x-large;color:#0069c9"> 签约成功</div>
							<div class="transtime" style="padding-bottom:0px;padding-top:10px;font-size:inherit;">{{TransDate}}</div>
						</div>
						<div class="d3"  style="padding-top: 25px;float:left;width:20%;margin-left:-3%"><img  v-click="gotoRewardPage()" src="images/img_reward.gif" style="width:100px;height:60px;"/></div>
					</div>
					<div v-hide="IsReward=='true'">
						<div class="d1" style="float:left;padding-left:50px;;width:20%;padding-top:20px"><img src="images/cg_img.png" style="width:60px;height:60px"/></div>
						<div class="d2" style="float:right;width:50%;height:70px;  padding-top:9%;padding-right:30px">
							 <div style="  text-align: center;font-size:x-large;color:#0069c9"> 签约成功</div>
							<div class="transtime" style="padding-bottom:0px;padding-top:10px;font-size:inherit;">{{TransDate}}</div>
						</div>
					</div>
<!-- 				     <div class="cc_img" ><img src="images/cg_img.png" style="width:120px;height:120px" /><br/>签约成功</div> -->
<!-- 				     <div class="transtime">{{TransDate}}</div> -->
				  </div>
		 	</div>
 		</div>
	</div>
	<!-- 乐盈宝自动转入解约录入 9 -->
	<div v-page v-transition="native" title="乐盈宝自动转入签约">
	   <form name="transConfirm" class="bg_box">
	         <div class="box_cont">
	            <div class="selected">
		        <span><img class="jindu" src="images/u1.png" /></span>
		         <span><img class="jindu" src="images/u2_1.png" /></span>
		          <span><img class="jindu" src="images/u3_1.png" /></span>
		      </div>
		      <div class="zz_cont">
		         <ul>
		           <li><em>签约账号：</em><i>{{accountNo|encryptAcNo}}</i></li>
		         </ul>
		      </div>
		      <div>
		     		<input type="submit"  class="button_1" name="Submit"  v-disabled="!accountNo"  value="确认" v-click="toCancelConfirm()">
		     	</div>
	         </div>
	   </form>
	</div>
	<!-- 乐盈宝自动转入解约确认 10-->
	<div v-page v-transition="native" title="乐盈宝自动转入签约">
	     <form name="transConfirm" class="bg_box">
	         <div class="box_cont">
	            <div class="selected">
		        <span><img class="jindu" src="images/u1.png" /></span>
		         <span><img class="jindu" src="images/u2.png" /></span>
		          <span><img class="jindu" src="images/u3_1.png" /></span>
		      </div>
		      <div class="zz_cont">
		          <ul>
		             <li><em>签约账号：</em><i>{{accountNo|encryptAcNo}}</i></li>
		             <li><em>验证码：</em> <i> <input type="tel" id="imgcode"
						name="imgcode" maxlength=4 v-model="imgcode" class="y_srk"
						placeholder="请输入验证码" style="width: 50%;" />
				</i> 					
				<img id="img" name="img" v-model="img" src="data:image/png;base64,{{TokenImg}}" data-ke-src="data:image/png;base64,{{TokenImg}}"  style="position:relative;left:40%;margin-top:3%" v-click="freshCode()">
<!-- 					<img id="img" name="img" v-model="img" -->
<!-- 					src="/pmobile/GenTokenImg.do" -->
<!-- 					style="position: relative; left: 40%; margin-top: 2%" -->
<!-- 					v-click="freshCode('img')"> -->
					</li>
		          </ul>
		      </div>
		      <div>
		     		<input type="submit"  class="button_1" name="Submit" value="提交" v-click="toResult1()">
		     	</div>
	         </div>
	     </form>
	</div>
	<!-- 乐盈宝自动转入解约结果 11-->
	<div  v-page v-transition="native" data-back="false" title="乐盈宝自动转入签约">
	   <div class="bg_box">
	       <div class="box_cont">
	          <div class="selected">
			        <span><img class="jindu" src="images/u1.png" /></span>
			        <span><img class="jindu" src="images/u2.png" /></span>
			        <span><img class="jindu" src="images/u3.png" /></span>
			      </div>
			   	  <div class="zz_cont">
				  	 <div v-show="IsReward=='true'" class="maind" style="margin:0px">
						<div class="d1" style="float:left;padding-left:5px;width:20%;padding-top:20px"><img src="images/cg_img.png" style="width:60px;height:60px"/></div>
						<div class="d2" style="float:left;width:50%;height:70px;  padding-top:9%;">
							 <div style="  text-align: center;font-size:x-large;color:#0069c9"> 解约成功</div>
							<div class="transtime" style="padding-bottom:0px;padding-top:10px;font-size:inherit;">{{TransDate}}</div>
						</div>
						<div class="d3"  style="padding-top: 25px;float:left;width:20%;margin-left:-3%"><img  v-click="gotoRewardPage()" src="images/img_reward.gif" style="width:100px;height:60px;"/></div>
					</div>
					<div v-hide="IsReward=='true'">
						<div class="d1" style="float:left;padding-left:50px;;width:20%;padding-top:20px"><img src="images/cg_img.png" style="width:60px;height:60px"/></div>
						<div class="d2" style="float:right;width:50%;height:70px;  padding-top:9%;padding-right:30px">
							 <div style="  text-align: center;font-size:x-large;color:#0069c9"> 解约成功</div>
							<div class="transtime" style="padding-bottom:0px;padding-top:10px;font-size:inherit;">{{TransDate}}</div>
						</div>
					</div>
<!-- 				     <div class="cc_img" ><img src="images/cg_img.png" style="width:120px;height:120px" /><br/>解约成功</div> -->
<!-- 				     <div class="transtime">{{TransDate}}</div> -->
				  </div>
	       </div>
	   </div>
	</div>
			<div v-page v-transition="native" title="贷款协议">
		 <div class="bg_box">
		    <div class="box_cont">
			     	<div id="LYBFileId" style="width:100%;height:auto"></div>
			     <div>
			     	<input type="submit"  class="button_1" name="Submit" value="同意" v-click="backInputPage()">
			     </div>
		 	</div>
		 </div>
	</div>
</div>
<script>		
PLyinbaoZDkkCtrl.$inject = ["$scope","$remote","$targets","$filter","$context","$chartService"];
function PLyinbaoZDkkCtrl($scope,$remote,$targets,$filter,$context,$chartService){
	$scope.init=function(){
		 $remote.post("/pmobile/getNewTokenName.do",{},function(data){
				$scope.tokenName=data._tokenName;
		 });
		$scope.accountNo=$context.getJson().acNo;
		$scope.prdCode=$context.getJson().prdCode;
		var parms={
				"accountNo":$scope.accountNo,
				"prdCode":$scope.prdCode,
// 				"accountNo":"6223230011012886124"
		}
		$remote.post("/pmobile/PLyinbaoInfoQuery.do",parms,function(data){
            if(data!=null){
            	if("0"==data.status){
            		if("0"==data.state){
                		$scope.isSign="Y";
                		$scope.state="已签约";
                		$scope.accountNo=data.accountNo;
                		$scope.amount=data.amount;
                		$scope.signDate=data.signDate;
                	}else{
                		$scope.state="未签约";
                		$scope.isSign="X";
                	}
            	}else{
            		$scope.state="未签约";
            		$scope.isSign="X";
            	}
            }
		});
		
	}
	$scope.toQry=function(){//跳转到详情页 
		$targets("content","#2");
	}
	$scope.toSignPre=function(){//跳转到签约录入页面
		$scope.transType="0";
		$targets("content","#6");
	}
	$scope.toSignConfirm=function(){//跳转到签约确认页面 
		$scope.freshCode();
		if(!$scope.amount){
			$scope.amount=0.01;
		}
		$targets("content","#7");
	}
	$scope.modify=function(){//跳转到签约修改录入页面
		$scope.transType="0";
		$scope.hasFlag="true";
		$scope.amount="";
		$targets("content","#3");
	}
	$scope.toNextConfirm=function(){//跳转到签约修改确认页面  
		    $scope.freshCode();
			$targets("content","#4");
	}
	$scope.toModifyConfirm=function(){//跳转到签约修改结果页面  
		var parms={
				"accountNo":$scope.accountNo,
				"prdCode":$scope.prdCode,
				"tranType":"3",
				"amount":$scope.amount,
				"flag":$scope.transType,
				"_vTokenName":$scope.imgcode
			   }
		$remote.post("/pmobile/GenTimeStamp.do", {}, function(data) {
			var serviceTime = data._sysDate;
			var min="";
			min=new Date();
			min.getMinutes();
			$scope.nowdate = $scope.formartDate(serviceTime, 0);
			$scope.time = parseFloat($scope.nowdate) + "";
			$scope.yy = $scope.time.substr(0, 4);
			$scope.mm = $scope.time.substr(4, 2);
			$scope.dd = $scope.time.substr(6, 2);
			$scope.time = $scope.yy + "年" + $scope.mm + "月" + $scope.dd+"日"+min.getHours()+"时"+min.getMinutes()+"分";
		});
				$remote.post("/pmobile/PLyinbaoZDkk.do",parms,function(data){
				    if(data._RejCode=="000000"){
				    	$scope.TransDate=$scope.time; 
				    	console.log($scope.TransDate);
				    	$targets("content","#5");
				    }
				});
	}

	$scope.toResult=function(){//提交签约 
		var parms={
		"accountNo":$scope.accountNo,
		"prdCode":$scope.prdCode,
		"tranType":"1",
		"amount":$scope.amount,
		"flag":$scope.transType,
		"_vTokenName":$scope.imgcode
	   }
		$remote.post("/pmobile/GenTimeStamp.do", {}, function(data) {
			var serviceTime = data._sysDate;
			var min="";
			min=new Date();
			$scope.nowdate = $scope.formartDate(serviceTime, 0);
			$scope.time = parseFloat($scope.nowdate) +  "";
			$scope.yy = $scope.time.substr(0, 4);
			$scope.mm = $scope.time.substr(4, 2);
			$scope.dd = $scope.time.substr(6, 2);
			$scope.time = $scope.yy + "年" + $scope.mm + "月" + $scope.dd+"日"+min.getHours()+"时"+min.getMinutes()+"分";
		});
	    	$remote.post("/pmobile/PLyinbaoZDkk.do",parms,function(data){
			    if(data._RejCode=="000000"){
			    	$scope.TransDate=$scope.time; 
			    	$targets("content","#8");
			    }
			});
	    
	}
	$scope.toCancelPre=function(){
		$targets("content","#9");
	}
	$scope.toCancelConfirm=function(){
		$scope.freshCode();
		$targets("content","#10");
	}
	$scope.toResult1=function(){
		var parms={
				"accountNo":$scope.accountNo,
				"prdCode":$scope.prdCode,
				"tranType":"2",
				"amount":$scope.amount,
				"flag":$scope.transType,
				"_vTokenName":$scope.imgcode
			   }
		$remote.post("/pmobile/GenTimeStamp.do", {}, function(data) {
			var serviceTime = data._sysDate;
			var min="";
			min=new Date();
			$scope.nowdate = $scope.formartDate(serviceTime, 0);
			$scope.time = parseFloat($scope.nowdate) +  "";
			$scope.yy = $scope.time.substr(0, 4);
			$scope.mm = $scope.time.substr(4, 2);
			$scope.dd = $scope.time.substr(6, 2);
			$scope.time = $scope.yy + "年" + $scope.mm + "月" + $scope.dd+"日"+min.getHours()+"时"+min.getMinutes()+"分";
		});
				$remote.post("/pmobile/PLyinbaoZDkk.do",parms,function(data){
				    if(data._RejCode=="000000"){
				    	$scope.TransDate=$scope.time; 
				    	$targets("content","#11");
				    }
				});
	}
	$scope.freshCode = function(id) {//刷新验证码 
		$remote.post("/pmobile/GenTokenImg.do?r" + Math.random(), {},
				function(data) {
			console.log(data);
					$scope.TokenImg = data.imgKey;
				});
	}
	$scope.toXieYiPage=function(){
		$remote.post("/pmobile/TreatyContent.do",{"TreatyType":"14"},function(data){
			document.getElementById("LYBFileId").innerHTML=data.Content;
			$targets("content","#12");
		});
	}
	$scope.backInputPage=function(){
		$scope.agree=true;
		$targets("content","#3");
	}
}
</script>
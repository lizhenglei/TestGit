<!-- 我的分期 -->
<div v-view-setup="PMyInstallmentCtrl" v-init="init()">
	<!-- 查看分期页面 -->
	<div style="padding-bottom:0" v-page v-transition="native" title="我要分期">
		<div style="background-color:white;" v-show="p">
			<!-- 三个页签部分 -->
			<div class="creditcard_box">
			<div class="zz_cont">
				<div class="bor_1" style="width:100%;height:40px;line-height:35px;float:left;margin-bottom:10px;background:white;color:#fff;border:#fff 1px solid;margin-top:10px">
					<div class="set_left set1"  v-click="optionsCard($index,'billInstallment')" style="background-color:white;color:black;width: 32%;">账单分期</div>
					<div class="set_left set2 " v-click="optionsCard($index,'linghuoInstallment')" style="background-color:white;color:#0084ff;width: 32%;">灵活分期</div>
					<div class="set_right set3 " v-click="optionsCard($index,'myInstallment')" style="background-color:white;color:#0084ff; width: 32%;">我的分期</div>
				</div>
				<div class="d1" style="height:10px;width:100%;background:white;float:left;">
					<div class="d3" style="height:2px;width:30%;background:white;float:left"></div>
					<div class="d2" style="height:2px;width:23%;background:#0084ff;float:left"></div>
				</div>
			</div>
			</div>
				<div v-show="isGiven=='bill'">
					<div class="zz_cont" v-show="zhangdan=='1'">
						<ul>
							<li><em>付款账号：</em> <i>
									<select v-change="getZhangdanCardInfo()" v-model="payCard1" name="payCard1" v-options="credit.creditCardNo for credit in credList">
								</select> </i></li>
						</ul>
					</div>
				    <!-- 账单分期 -->
					<div class="zz_cont" v-show="zhangdan=='1'">
						<ul>
							<li><em>账单年月：</em><i>{{zhangdanfenqi.tranYM|formatShortDate}}</i></li>
							<li><em>本期账单金额：</em><i>{{zhangdanfenqi.nowTranAmt|number:2}}元</i></li>
							<li><em>可分期金额：</em><i>{{zhangdanfenqi.referApply|number:2}}元</i></li>
							<li><em>申请金额：</em><i><input type="text" id="inviteAmount" name="inviteAmount" v-model="inviteAmount"  class="y_srk" placeholder="请输入申请金额"/>元</i></li>
							<li><em>分期期数：</em><i><select v-model="billfenqi" name="billfenqi" id="billfenqi"  class="y_srk" placeholder="请选择分期期数" v-options="item.qishumc for item in billfenqiList" ></select></i></li>
						</ul>
					</div>
			    	<div class="zz_cont"  v-show="zhangdan=='1'">
				     	<input type="submit" id="nextBillButton"  class="button_1" name="nextBillButton" value="下一步" v-click="fenqiNext(inviteAmount,billfenqi)">
				    </div>
				     <div class="zz_cont"  v-show="zhangdan=='1'" ><img src="images/ts.png" />
							    <font class="tishi">
									温馨提示</br>
								</font>
									&nbsp;&nbsp;1.每期手续费=分期本金总额×对应期数的每期手续费率。</br>
									&nbsp;&nbsp;2.每期应还本金=分期本金总额/分期期数，精确到分，余数计入最后一期。</br>
									&nbsp;&nbsp;3.每期应还款=每期手续费+每期应还本金。</br>
									&nbsp;&nbsp;4.账单分期手续费一经收取，不予退还。</br>
								<div style="font-size:12px; line-height:16px; color:#929292;"> </div>
					  </div>
				    <!-- 回显试算结果 -->
				    <div class="zz_cont" v-show="zhangdan=='2'">
						<ul>
							<li><em>付款账号：</em><i>{{zhangdanfenqi.creditCardNo}}</i></li>
							<li><em>账单年月：</em><i>{{zhangdanfenqi.tranYM|formatShortDate}}</i></li>
							<li><em>本期账单金额：</em><i>{{zhangdanfenqi.nowTranAmt|number:2}}元</i></li>
							<li><em>可分期金额：</em><i>{{zhangdanfenqi.referApply|number:2}}元</i></li>
							<li><em>申请金额：</em><i>{{zhangdanshisuan.flexBalanceAmt|number:2}}元</i></li>
							<li><em>分期期数：</em><i>{{zhangdanshisuan.flexDate|number}}期</i></li>
							<li><em>每期手续费率：</em><i>{{zhangdanshisuan.monInter|number:2}}%</i></li>
							<li><em>分期总手续费：</em><i>{{zhangdanshisuan.originalCharge|number:2}}元</i></li>
							<li><em>每期还款额：</em><i>{{zhangdanshisuan.monTotal|number:2}}元</i></li>
							<li><em>手机动态码：</em><i>
								<input type="tel" id="SmsCode" name="SmsCode" v-model="SmsCode" maxlength=6 class="y_srk_50" placeholder="请输入动态码" />
								<button class="inp_butt" v-sms="getDYcode()">获取动态码</button>
							</i></li>
							<li v-show="showflag==1"><em></em><i style=" width:100%; height: 20px;line-height: 20px;margin-left: 15px;color:red;">短信验证码已发送至{{mobilePhone|encryptAcNof}}，请注意查收</i></li>
							<li><em>交易密码:</em> <i>	<input id="jiyimima" type="password" maxlength=6 name="jiyimima" v-model="jiyimima" class="y_srk" placeholder="请输入信用卡交易密码"  v-click="getPW()" readonly/></i></li>
						</ul>
					</div>
			    	<div class="zz_cont"  v-show="zhangdan=='2'">
				     	<input type="submit" id="invite"  class="button_1" name="invite" value="申请" v-click="inviteZhangdanfenqi(zhangdanshisuan,jiyimima,SmsCode)">
				    </div>
				    <div class="zz_cont" v-show="zhangdan=='3'">
				    	<div class="d5" style="float: left; padding-left: 5px; width: 20%; margin-left:70px; padding-top: 20px">
							<img src="images/cg_img.png" style="width: 60px; height: 60px" />
						</div>
						<div class="d8"	style="float: left; width: 50%; height: 70px; padding-top: 9%;">
							<div style="text-align: center; font-size: x-large; color: #0069c9">交易成功</div>
							<div class="transtime"	style="padding-bottom: 0px; padding-top: 10px; font-size: inherit;">{{fenqishenqing.TransDate}}</div>
				    	</div>
				    	<ul>
				    		<li><em>付款账号：</em><i>{{fenqishenqing.creditCardNo}}</i></li>
<!-- 				    		<li><em>可分期金额：</em><i>{{fenqishenqing.referApply|number:2}}元</i></li> -->
							<li><em>申请金额：</em><i>{{fenqishenqing.flexBalanceAmt|number:2}}元</i></li>
							<li><em>分期期数：</em><i>{{fenqishenqing.flexDate|number}}期</i></li>
							<li><em>每期手续费率：</em><i>{{zhangdanshisuan.monInter|number:2}}%</i></li>
							<li><em>分期总手续费：</em><i>{{fenqishenqing.originalCharge|number:2}}元</i></li>
							<li><em>每期还款额：</em><i>{{fenqishenqing.monTotal|number:2}}元</i></li>
				    	</ul>
					</div>
				</div>
				
				<div v-show="isGiven=='linghuo'">
						<div class="zz_cont" v-show="linghuoFlag=='1'">
							<ul>
								<li><em>付款账号：</em> 
									<i>
										<select v-change="getLinghuoCardInfo()" v-model="payCard2" name="payCard2" v-options="credit.creditCardNo for credit in credList">
										</select> 
									</i>
								</li>
							</ul>
						</div>
						<div class="bg_box" v-show="linghuoFlag=='1' && linghuoList" v-repeat="linghuo in linghuoList" v-click="inviteNextLinghuo(linghuo)">
							<div class="zz_cont">
								<div>
							      	<div style="float:left;padding:left;width:45%;padding-left:10px;margin-top:3%;">
										<div style="float:left"></div>
										<div style="float:left;color:#ff6000">
											{{linghuo.tranDescrition}}
										</div>
									</div>
									<div style="float:left;width:45%">
										<div>
											<div style="float:left"></div>
											<div >
												{{linghuo.tranAmount|number:2}}元
											</div>
										</div>
										<div>
											<div style="float:left" ></div>
											<div >
												{{linghuo.purDateFormat}}
											</div>
										</div>
									</div>
								</div>
								<div class="xiangq_img" style="margin-top:-2%;"><img src="images/more.png" /></a></div>
						    </div>
						</div>
						
					    <div class="zz_cont moreBtn"  v-show="linghuoFlag=='1'&&linghuoPage==1" >
					     		<input type="submit" class="button_1" name="Submit" value="查看更多" v-click="linghuoMore()">
					    </div>
					      <div class="zz_cont" v-show="linghuoFlag=='1'"><img src="images/ts.png" />
							    <font class="tishi">
									温馨提示</br>
								</font>
									&nbsp;&nbsp;1.分期总手续费=分期本金总额*每期手续费率*分期期数。 </br>
									&nbsp;&nbsp;2.分期总手续费将在第一期账单日一次性收取。 </br>
									&nbsp;&nbsp;3.每期应还本金=分期本金总额/分期期数，精确到分。 </br>
								<div style="font-size:12px; line-height:16px; color:#929292;"> </div>
						  </div>
					<div class="zz_cont" v-show="linghuoFlag=='2'">
						<ul>
							<li><em>付款账号：</em><i>{{payCard2.creditCardNo}}</i></li>
							<li><em>本期消费金额：</em><i>{{linghuo2.tranAmount|number:2}}元</i></li>
							<li><em>消费日期：</em><i>{{linghuo2.purDateFormat}}</i></li>
							<li><em>交易描述：</em><i>{{linghuo2.tranDescrition}}</i></li>
							<li><em>分期期数：</em><i><select v-model="linghuoqishu" name="linghuoqishu" id="linghuoqishu" class="y_srk" placeholder="请选择分期期数" v-options="item.qishumc for item in linghuofenqiList" ></select></i></li>
						</ul>
					</div>
			    	<div class="zz_cont"  v-show="linghuoFlag=='2'">
				     	<input type="submit" id="nextBillButton"  class="button_1" name="nextBillButton" value="下一步" v-click="inviteShisuanNext(linghuoqishu,linghuo2)">
				    </div>
					
					<div class="zz_cont" v-show="linghuoFlag=='3'">
						<ul>
							<li><em>付款账号：</em><i>{{linghuoshisuan.creditCardNo}}</i></li>
							<li><em>本期消费金额：</em><i>{{linghuo2.tranAmount|number:2}}元</i></li>
							<li><em>消费日期：</em><i>{{linghuo2.purDateFormat}}</i></li>
							<li><em>交易描述：</em><i>{{linghuo2.tranDescrition}}</i></li>
							<li><em>分期期数：</em><i>{{linghuoshisuan.flexDate|number}}期</i></li>
							<li><em>每期手续费率：</em><i>{{linghuoshisuan.monInter|number:2}}%</i></li>
							<li><em>分期总手续费：</em><i>{{linghuoshisuan.originalCharge|number:2}}元</i></li>
							<li><em>每期还款额：</em><i>{{linghuoshisuan.monTotal|number:2}}元</i></li>
							<li><em>手机动态码：</em><i>
								<input type="tel" id="SmsCode" name="SmsCode" v-model="SmsCode" maxlength=6 class="y_srk_50" placeholder="请输入动态码" />
								<button class="inp_butt" v-sms="getDYcode2()">获取动态码</button>
							</i></li>
							<li v-show="showflag==1"><em></em><i style=" width:100%; height: 20px;line-height: 20px;margin-left: 15px;color:red;">短信验证码已发送至{{mobilePhone|encryptAcNof}}，请注意查收</i></li>
							<li><em>交易密码:</em> <i>	<input id="jiyimima2" type="password" maxlength=6 name="jiyimima2" v-model="jiyimima2" class="y_srk" placeholder="请输入信用卡交易密码" v-click="getPW2()" readonly/></i></li>
						</ul>
					</div>
			    	<div class="zz_cont"  v-show="linghuoFlag=='3'">
				     	<input type="submit" id="nextBillButton"  class="button_1" name="nextBillButton" value="申请" v-click="inviteLinghuo(linghuo2,SmsCode,jiyimima2,linghuoshisuan)">
				    </div>
					<div class="zz_cont" v-show="linghuoFlag=='4'">
				    	<div class="d5" style="float: left; padding-left: 5px; width: 20%; margin-left:70px; padding-top: 20px">
							<img src="images/cg_img.png" style="width: 60px; height: 60px" />
						</div>
						<div class="d8"	style="float: left; width: 50%; height: 70px; padding-top: 9%;">
							<div style="text-align: center; font-size: x-large; color: #0069c9">交易成功</div>
							<div class="transtime"	style="padding-bottom: 0px; padding-top: 10px; font-size: inherit;">{{linghuoshenqing.TransDate}}</div>
				    	</div>
				    	<ul>
				    		<li><em>付款账号：</em><i>{{linghuoshisuan.creditCardNo}}</i></li>
							<li><em>本期消费金额：</em><i>{{linghuo2.tranAmount|number:2}}元</i></li>
							<li><em>分期期数：</em><i>{{linghuoshenqing.flexDate|number}}期</i></li>
							<li><em>每期手续费率：</em><i>{{linghuoshisuan.monInter|number:2}}%</i></li>
							<li><em>分期总手续费：</em><i>{{linghuoshenqing.originalCharge|number:2}}元</i></li>
							<li><em>每期还款额：</em><i>{{linghuoshenqing.monPayBack|number:2}}元</i></li>
				    	</ul>
					</div>
					
					
				</div>
				<div v-show="isGiven=='my'">
						<div class="zz_cont" >
							<ul>
								<li><em>付款账号：</em> 
									<i>
										<select v-model="payCard3" name="payCard3" v-options="credit.creditCardNo for credit in credList">
										</select> 
									</i>
								</li>
							</ul>
						</div>
						<div class="bg_box" >
							<div class="zz_cont" >
								<ul>
									<li>
										<em>开始日期：</em>
										<i style="padding-top:8px">
											<input type="date" name="beginDate" id="beginDate" placeholder="请选择开始日期" v-model="beginDate"  style="height:20px;margin-top:10px" class="y_srk" >
										</i>
									</li>
									<li>
										<em>结束日期：</em>
										<i style="padding-top:8px">
											<input type="date" name="endDate" id="endDate" placeholder="请选择结束日期" v-model="endDate" style="height:20px;margin-top:10px" class="y_srk">
										</i>
									</li>
								</ul>
							</div>
							<div class="zz_cont">
			     				<input type="submit"  class="button_1" name="Submit" value="查询" v-click="toQuery(beginDate,endDate)">
			     			</div>
			     			<div class="bg_box" v-show="myList" v-repeat="detail in myList" v-click="findDetail(detail)">
								<div class="zz_cont">
									<div>
										<div style="float:left;width:45%">
											<div>
												<div style="float:left"></div>
												<div >
													{{detail.desc}}
												</div>
											</div>
											<div>
												<div style="float:left" ></div>
												<div >
													{{detail.tranDate|formatDate}}
												</div>
											</div>
										</div>
								      	<div style="float:right;padding:right;width:45%;padding-left:20px;margin-top:3%;">
											<div style="float:right"></div>
											<div style="float:right;color:#ff6000;margin-right:40px">
												{{detail.flexAmt|number:2}}元
											</div>
										</div>
									</div>
									<div class="xiangq_img" style="margin-top:-2%;"><img src="images/more.png" /></a></div>
							    </div>
							</div>
						    <div class="zz_cont moreBtn">
						     		<input type="submit" v-show="myPageFlag==1" class="button_1" name="Submit" value="查看更多" v-click="myFenqiMore(beginDate,endDate)">
						     </div>
						</div>
				</div>
			</div>
	</div>

</div>
<script>
PMyInstallmentCtrl.$inject = ["$scope","$remote","$targets","$context","$timeout","$filter"];
function PMyInstallmentCtrl($scope,$remote,$targets,$context,$timeout){
	//初始化函数
	$scope.init=function(){
		$scope.showflag=2;
		$scope.p=false;
		//初始化账单分期分期期数下来框数据
		$scope.billfenqiList=[{"qishumc" : "3期",	"qishu" : "3"},
		                        {"qishumc" : "6期",	"qishu" : "6"},
		                        {"qishumc" : "9期",	"qishu" : "9"},
		                        {"qishumc" : "12期",	"qishu" : "12"},
		                        {"qishumc" : "24期",	"qishu" : "24"},
			                       ];
		//初始化灵活分期分期期数下来框数据
		$scope.linghuofenqiList=[{"qishumc" : "3期",	"qishu" : "3"},
		                        {"qishumc" : "6期",	"qishu" : "6"},
		                        {"qishumc" : "9期",	"qishu" : "9"},
		                        {"qishumc" : "12期",	"qishu" : "12"},
		                        {"qishumc" : "24期",	"qishu" : "24"},
		                        {"qishumc" : "36期",	"qishu" : "36"},
			                       ];
		
// 		默认将账单分期分期期数设置为第一个
		$scope.billfenqi=$scope.billfenqiList[0];
// 		默认将灵活分期分期期数设置为第一个
		$scope.linghuoqishu=$scope.linghuofenqiList[0];
		
		//查询到信用卡账号
		$remote.post("/pmobile/ActListQry.do",{},function(data){
			$scope.credList=data.CreditList;
			var fristcard=$context.getJson().selectedNum;
			var f;
			if($scope.credList.length==0){
				$scope.alert("无信用卡加挂信息或卡片未激活");
			}else if($scope.credList.length==1){
				$scope.payCard1=$scope.credList[0];
				$scope.payCard2=$scope.credList[0];
				$scope.payCard3=$scope.credList[0];
				$scope.getZhangdanCardInfo();
			}else{
				if(fristcard){
					vx.forEach($scope.credList,function(item,index){
						if(fristcard==item.creditCardNo){
							f=index;
						}
					});
					$scope.payCard1=$scope.credList[f];
					$scope.payCard2=$scope.credList[f];
					$scope.payCard3=$scope.credList[f];
					$scope.getZhangdanCardInfo();
				}else{
					$scope.payCard1=$scope.credList[0];
					$scope.payCard2=$scope.credList[0];
					$scope.payCard3=$scope.credList[0];
					$scope.getZhangdanCardInfo();
				}
			}
		});
		$remote.post("/pmobile/GenTimeStamp.do",{},function(data){
			var serviceTime=data._sysDate;
			$scope.beginDate=$scope.formartDate(serviceTime,-7,"-");
			$scope.endDate=$scope.formartDate(serviceTime,0,"-");
		});
	}
	
	//获取账单list
	$scope.getZhangdanCardInfo=function(){
		$scope.cardpara=$scope.payCard1;
		$timeout(function(){
			$scope.isGiven="no";
			$('.set2').css('color','black');
			$('.set1').css('color','#0084ff');
			$('.set3').css('color','black');
			$('.d3').css('width','6%');
			$scope.isGiven="bill";
			$scope.zhangdanQuery($scope.payCard1);
			$scope.zhangdan='1';
		},500);
	}
	//获取灵活分期list
	$scope.getLinghuoCardInfo=function(){
		$scope.cardpara=$scope.payCard2;
		$timeout(function(){
			$scope.isGiven="no";
			$('.set2').css('color','#0084ff');
			$('.set1').css('color','black');
			$('.set3').css('color','black');
			$('.d3').css('width','38%');
			$scope.isGiven="linghuo";
			$scope.linghuoQuery();
			$scope.zhangdan='1';
		},500);
	}
	//查询可分期的账单信息
	$scope.zhangdanQuery=function(){
		var params={
				"creditCardNo":$scope.payCard1.creditCardNo,
				"operationType":'2'
		};
		$remote.post("/pmobile/ZhangdanfenqiQuery.do",params,function(data){
			$scope.zhangdanfenqi=data;
			$scope.zhangdan='1';
			$scope.p=true;
		},function(data){
			if(data.jsonError){
				$scope.alert(data.jsonError);
			}
			$scope.zhangdanfenqi="";
			return data.jsonError;
		});
	}
	//根据分期金额 分期期数计算分期的手续费
	$scope.fenqiNext=function(inviteAmount,billfenqi){
		if(!billfenqi){
			NativeCall.toast("请选择要分期的期数");
			return false;
		}
		if(!inviteAmount){
			NativeCall.toast("请输入分期金额");
			return false;
		}
		var params={
				"creditCardNo":$scope.payCard1.creditCardNo,
				"flexDate":billfenqi.qishu,
				"flexAmt":inviteAmount,
				"flexType":"Y"
		};
		$remote.post("/pmobile/Fenqishisuan.do",params,function(data){
			$scope.zhangdanshisuan=data;
			$scope.zhangdan='2';
		},function(data){
			if(data.jsonError){
				$scope.alert(data.jsonError);
			}
			return data.jsonError;
		});
	}
	//账单分期获取手机动态码
	$scope.getDYcode=function(){
			$remote.post("/pmobile/CreditcardCustInfo.do",{"CreditNo":$scope.payCard1.creditCardNo},function(data){
				$scope.mobilePhone=data.mobileNo;
				$scope.email=data.email;
				$scope.showflag=1;
				$scope.businessName="账单分期";
				var params={
						"BusinessName":$scope.businessName,
						"MobileNo":$scope.mobilePhone,
						"ServiceCode":"CCM000011"
				}
				$remote.post("/pmobile/GenTokenName.do",params,function(data){
					$scope.msmNo=data.SerialNo;
				});
			});
	}
	//账单分期调用密码控件
	$scope.getPW=function(){
		$("#jiyimima").val("");
		$scope.buttonDis=true;
		$("#invite").attr("disabled",$scope.buttonDis);
		var scrollHeight=$scope.getPWPosition($("#jiyimima").get(0));//定位当前密码输入栏位在文档中的位置
		$scope.getPassword(function(pwResponse){
			var resJson=vx.fromJson(pwResponse);
			if(resJson.Flag==0){
				$("#jiyimima").val(resJson.passWord);
			}else if(resJson.Flag==1){
				$scope.miwen=resJson.passWord;
				$scope.buttonDis1 = resJson.buttonDis;
				if($scope.buttonDis1=="true"){
					$scope.buttonDis = false;
					$("#invite").attr("disabled",$scope.buttonDis);
				}
			}
		},scrollHeight);
	}
	//申请账单分期
	$scope.inviteZhangdanfenqi=function(zhangdanshisuan,jiyimima,SmsCode){
		if(!SmsCode){
			NativeCall.toast("请输入手机动态码");
			return false;
		}
		var params={
				"SmsCode":SmsCode,"SerialNo":$scope.msmNo
		}
		//短信验证码验证
		$remote.post("/pmobile/SmsCodeValidate.do",params,function(data){
			//获取完成交易token防重复码
			$remote.post("/pmobile/getNewTokenName.do",{},function(data){
				var _tokenName=data._tokenName;
				if(data._RejCode=="000000"){
					var params={
							"creditCardNo":zhangdanshisuan.creditCardNo,
							"flexDate":zhangdanshisuan.flexDate,
							"flexAmt":zhangdanshisuan.flexBalanceAmt,
							"flexType":'Y',//进行申请
							"CashTrsPassword":$scope.miwen,
							"_tokenName":_tokenName
					};
					$remote.post("/pmobile/ZhangdanfenqiInvite.do",params,function(data){
						$scope.fenqishenqing=data;
						$scope.zhangdan='3';
					},function(data){
						if(data.jsonError){
							$scope.alert(data.jsonError);
						}
						$scope.fenqishenqing="";
						return data.jsonError;
					});
				}
			});
		});
	}
	
	//灵活分期查询
	$scope.linghuoQuery=function(){
		$scope.linghuoList="";
		$scope.linghuoPage='0';
		$scope.linghuoFlag='1';
		var params={
				"creditCardNo":$scope.payCard2.creditCardNo,
				"SearchCondit":'2'//未申请灵活分期
		};
		$remote.post("/pmobile/LinghuofenqiQuery.do",params,function(data){
			$scope.linghuoPage=data.turnPageFlag;
			$scope.linghuoList=data.List;
		},function(data){
			if(data.jsonError){
				$scope.alert(data.jsonError);
			}
			$scope.linghuoList="";
			return data.jsonError;
		});
	}
	//灵活分期查看更多
	$scope.linghuoMore=function(){
		var leg = $scope.linghuoList.length-1;
		var params={
				"creditCardNo":$scope.payCard2.creditCardNo,
				"SearchCondit":'2',//未申请灵活分期
				"turnPageFlag":'1',
				"bookingDate":$scope.linghuoList[leg].bookingDate,
				"writeDate":$scope.linghuoList[leg].writeDate,
				"purDate":$scope.linghuoList[leg].purDate,
				"gwFlwNo":$scope.linghuoList[leg].gwFlwNo
		};
		$remote.post("/pmobile/LinghuofenqiQuery.do",params,function(data){
			$scope.linghuoFlag='1';
			$scope.linghuoPage=data.turnPageFlag;
			$scope.linghuoList=$scope.linghuoList.concat(data.List);
		},function(data){
			if(data.jsonError){
				$scope.alert(data.jsonError);
			}
			$scope.linghuoList="";
			return data.jsonError;
		});
		
	}
	//具体分期数据主要为了选择期数进行试算
	$scope.inviteNextLinghuo=function(linghuo){
		$scope.linghuoFlag='2';
		$scope.linghuo2=linghuo;
	}
	//进行试算回显利率相关数据
	$scope.inviteShisuanNext=function(billfenqi,linghuo2){
		var params={
				"creditCardNo":$scope.payCard2.creditCardNo,
				"flexDate":billfenqi.qishu,
				"flexAmt":linghuo2.tranAmount,
				"flexType":"A"
		};
		$remote.post("/pmobile/Fenqishisuan.do",params,function(data){
			$scope.linghuoshisuan=data;
			$scope.linghuoFlag='3';
		},function(data){
			if(data.jsonError){
				$scope.alert(data.jsonError);
			}
			$scope.linghuoshisuan="";
			return data.jsonError;
		});
	}
	//获取手机动态码
	$scope.getDYcode2=function(){
		$remote.post("/pmobile/CreditcardCustInfo.do",{"CreditNo":$scope.payCard2.creditCardNo},function(data){
			$scope.mobilePhone=data.mobileNo;
			$scope.email=data.email;
			$scope.showflag=1;
			$scope.businessName="灵活分期";
			var params={
					"BusinessName":$scope.businessName,
					"MobileNo":$scope.mobilePhone,
					"ServiceCode":"CCM000011"
			}
			$remote.post("/pmobile/GenTokenName.do",params,function(data){
				$scope.msmNo=data.SerialNo;
			});
		});
	}
	//灵活分期调用密码控件
	$scope.getPW2=function(){
		$("#jiyimima2").val("");
		$scope.buttonDis=true;
		$("#nextBillButton").attr("disabled",$scope.buttonDis);
		var scrollHeight=$scope.getPWPosition($("#jiyimima2").get(0));//定位当前密码输入栏位在文档中的位置
		$scope.getPassword(function(pwResponse){
			var resJson=vx.fromJson(pwResponse);
			if(resJson.Flag==0){
				$("#jiyimima2").val(resJson.passWord);
			}else if(resJson.Flag==1){
				$scope.miwen2=resJson.passWord;
				$scope.buttonDis1 = resJson.buttonDis;
				if($scope.buttonDis1=="true"){
					$scope.buttonDis = false;
					$("#nextBillButton").attr("disabled",$scope.buttonDis);
				}
			}
		},scrollHeight);
	}
	//进行申请灵活分期
	$scope.inviteLinghuo=function(linghuo2,SmsCode,jiyimima,linghuoshisuan){
		if(!SmsCode){
			NativeCall.toast("请输入手机动态码");
			return false;
		}
		var params={
				"SmsCode":SmsCode,"SerialNo":$scope.msmNo
		}
		//短信验证码验证
		$remote.post("/pmobile/SmsCodeValidate.do",params,function(data){
			$remote.post("/pmobile/getNewTokenName.do",{},function(data){
				var _tokenName=data._tokenName;
				if(data._RejCode=="000000"){
					var params={
							"creditCardNo":$scope.payCard2.creditCardNo,
							"flexDate":linghuoshisuan.flexDate,
							"flexAmt":linghuoshisuan.flexBalanceAmt,
							"flexType":'A',//进行申请
							"CashTrsPassword":$scope.miwen2,
							"_tokenName":_tokenName
					};
					$remote.post("/pmobile/LinghuofenqiInvite.do",params,function(data){
						$scope.linghuoshenqing=data;
						$scope.linghuoFlag='4';
					},function(data){
						if(data.jsonError){
							$scope.alert(data.jsonError);
						}
						$scope.linghuoshenqing="";
						return data.jsonError;
					});
				}
			});
		});
	}
	//查询我的分期内容
	$scope.toQuery=function(beginDate,endDate){
		$scope.myList="";
		$scope.myPageFlag='0';
		var params={
				"creditCardNo":$scope.payCard3.creditCardNo,
				"beginDate":$scope.formartDate(beginDate,0),
				"endDate":$scope.formartDate(endDate,0),
				"SearchCondit":'0'
		}
		$remote.post("/pmobile/FenqiQuery.do",params,function(data){
			$scope.myList=data.List;
			$scope.myPageFlag=data.turnPageFlag;
			$scope.myFlag='1';
		},function(data){
			if(data.jsonError){
				$scope.alert(data.jsonError);
			}
			$scope.myList="";
			return data.jsonError;
		});
	}
	//我的分期查看更多
	$scope.myFenqiMore=function(beginDate,endDate){
		var leg = $scope.myList.length-1;
		var params={
				"creditCardNo":$scope.payCard3.creditCardNo,
				"beginDate":$scope.formartDate(beginDate,0),
				"endDate":$scope.formartDate(endDate,0),
				"SearchCondit":'0',
				"turnPageFlag":'1',
				"turnPageDate":$scope.myList[leg].tranDate,
				"turnPagePayNo":$scope.myList[leg].flexPaySeq
		}
		$remote.post("/pmobile/FenqiQuery.do",params,function(data){
			$scope.myPageFlag=data.turnPageFlag;
			$scope.myList=$scope.myList.concat(data.List);
		},function(data){
			if(data.jsonError){
				$scope.alert(data.jsonError);
			}
			$scope.myList="";
			return data.jsonError;
		});
	}
	$scope.findDetail=function(detail){
		$scope.imtShow(function(){},vx.toJson(detail));
	}
	//选项卡切换
	$scope.optionsCard=function(index,id){
		$scope.showflag=2;
		if(id=="billInstallment"){
			$('.set3').css('color','black');
			$('.set2').css('color','black');
			$('.set1').css('color','#0084ff');
			$('.d3').css('width','6%');
			$scope.isGiven="bill";
			$scope.zhangdanQuery($scope.payCard1);
		}else if(id=="linghuoInstallment"){
			$('.set1').css('color','black');
			$('.set3').css('color','black');
			$('.set2').css('color','#0084ff');
			$('.d3').css('width','38%');
			$scope.isGiven="linghuo";
			$scope.linghuoQuery();
		}else if(id=="myInstallment"){
			$('.set2').css('color','black');
			$('.set1').css('color','black');
			$('.set3').css('color','#0084ff');
			$('.d3').css('width','72%');
			$scope.isGiven="my";
		}
	}
}
</script>
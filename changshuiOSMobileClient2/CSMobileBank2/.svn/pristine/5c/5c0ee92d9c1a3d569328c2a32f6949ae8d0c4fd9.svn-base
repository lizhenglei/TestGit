<div v-view-setup="PMyAwardCtrl" v-init="init()">
	<div>
			<div class="yhj"  v-repeat="card in lt" style="background-color:white">
				<div class="yhj_top" >
					<span class="left f98973" style=" margin-left:-2%;text-align: center;width:62%; padding-top: 10%;font-size:15px;line-height:25px"><font class="fontsize2">{{card.prizeName}}</font>
					<br>{{card.prizeId}}
					<font class="fontsize1"></font><br/>
					</span>
					<span class="right" style="margin-bottom: 20px;padding-right: 5%;  padding-left: 8%;  margin-top: 20px;padding-top: 0px;border-left: 1px solid #f18903;">
					<span class="kal" style="font-size:15px">{{card.prizeGrade}}等奖
					 </span>
					 <br/>
					 <span class="kall" style="font-size:15px" >{{card.tranDate}}
					 </span>
					 <br/>
					<span class="fleft" style=" height: 20px; width: 65px;margin-left:1px;
					 text-align: center;border: 1px solid #f18903;  background: #f18903;  color: white;
					 border-radius: 5px;line-height: 20px;"  v-click="password($index,card)">查看详情</span>
<!-- 					 <br/>您于{{card.tranDate}}日获得{{card.prizeGrade}}等奖 -->
					 </span>
				</div>
<!-- 				<div class="yhj_bottom"> -->
<!-- 				</div> -->
		<div v-show="moreInfo==$index" class="zz_cont" style=" margin-top: 0%;">
		 <div class="box_cont">
			<ul>
				<li style="border:0px;height:20px"><em style="line-height: 15px;">奖品名称：</em><i style="line-height: 15px;">{{card.prizeName}}</i></li>
				<li style="border:0px;height:20px"><em style="line-height: 15px;">奖品价值：</em><i style="line-height: 15px;">{{card.prizePrice}}</i></li>
				<li style="border:0px;height:20px"><em style="line-height: 15px;">奖品编码：</em><i style="line-height: 15px;">{{card.prizeId}}</i></li>
				<li style="border:0px;height:20px"><em style="line-height: 15px;">卡券密码：</em><i style="line-height: 15px;">{{passwordf}}</i></li>
			</ul>
			</div>
		</div>
			</div>
			  <div v-show="lt.length==0" class="mingce">
			      <ul>
						<li class="center">对不起，你目前没有抽奖信息</li>
				  </ul>
		    </div>   
	</div>
	<div></div>
		<div class="zz_cont"><img src="images/ts.png" />
		    <font class="tishi">
				温馨提示</br>
			</font>
				&nbsp;&nbsp;您可查询自己的中奖纪录。</br>
			<div style="font-size:12px; line-height:16px; color:#929292;"> </div>
	   </div>
	   <div style="width:100%;height:40px"></div>
</div>
<script>
PMyAwardCtrl.$inject = ["$scope","$remote","$targets","$filter"];
function PMyAwardCtrl($scope,$remote,$targets,$filter){
	
	//页面初始化
	$scope.init=function(){
		$remote.post("/pmobile/GenTimeStamp.do", {}, function(data) {
			var serviceTime = data._sysDate;
			$scope.nowdate = $scope.formartDate(serviceTime, 0);
			$scope.time = parseFloat($scope.nowdate) + 10000 + "";
			$scope.yy = $scope.time.substr(0, 4);
			$scope.mm = $scope.time.substr(4, 2);
			$scope.dd = $scope.time.substr(6, 2);
			$scope.time = $scope.yy + "-" + $scope.mm + "-" + $scope.dd;
		});
		$scope.getClientState(function(response){
			var resJson=vx.fromJson(response);
			$scope.userType=resJson.Userinfo.CifNo;
			$scope.idNo=resJson.Userinfo.IdNo;
			$scope.mobileNo=resJson.Userinfo.MobileNo;
			$scope.idType=resJson.Userinfo.IdType;
			$remote.post("/pmobile/TransRewardsResultQry.do", {"clientNo":$scope.userType,"currentIndex":"1","pageSize":"20"}, function(data) {
				$scope.lt=data.List;
				if($scope.lt){
					var filterFn=$filter("filter");
					$scope.lt=filterFn($scope.lt,function(obj,text){
						if(obj.tranDate != undefined){
							obj.tranDate=obj.tranDate.substr(0,4)+"-"+ obj.tranDate.substr(4,2)+"-"+obj.tranDate.substr(6,2);
							if(obj.prizeGrade == "1"){
								obj.prizeGrade="一"
							}
							if(obj.prizeGrade == "2"){
								obj.prizeGrade="二"
							}
							if(obj.prizeGrade == "3"){
								obj.prizeGrade="三"
							}
							return true;
						}
					});
				}
			})
		});
		
 	}
	$scope.password=function(index,obj){
		if($scope.moreInfo==index){
			$scope.moreInfo=-1;
			return;
		}
		$remote.post("/pmobile/TransRewardsPasswordQry.do", {"clientNo":$scope.userType,"prizeId":obj.prizeId,"mobileNo":$scope.mobileNo,"idNo":$scope.idNo,"idType":$scope.idType}, function(data) {
			var i=$scope.mobileNo.substr(0,3)+'****'+$scope.mobileNo.substr(7,4);
// 			$scope.alertAllow(function(){},data.prizePassword);
			$scope.passwordf=data.prizePassword;
			if($scope.moreInfo!=index){
				$scope.moreInfo=index;//点击，展开对应信用卡信息
			}else{
				$scope.moreInfo=-1;//点击，收起对应信用卡信息
				return;
			}
// 			if($scope.moreInfo!=index){
// 				$scope.moreInfo=index;//点击，展开对应信用卡信息
// 			}else{
// 				$scope.moreInfo=-1;//点击，收起对应信用卡信息
// 			}
// 			$scope.alert(" 奖品名称："+obj.prizeName+"！\n 卡券密码：："+data.prizePassword+"！");
		})
	}
	
	//跳转到确认页面

}
</script>
<div v-view-setup="LotteryDrawCtrl" v-init="init()">
	<div style="padding-bottom: 0" v-page v-transition="native">
<!-- 		<div class="wrap"> -->
<!-- 			<div class="bgfff"> -->
<!-- 				<div class="bgff7558"> -->
<!-- 					<div id="lottery"> -->
<!-- 						<table border="0" align="center" cellpadding="0" cellspacing="0"> -->
<!-- 							<tr> -->
<!-- 								<td class="lottery-unit lottery-unit-0 bgfffeec">一等奖</td> -->
<!-- 								<td class="lottery-unit lottery-unit-1 bgffecec">二等奖</td> -->
<!-- 								<td class="lottery-unit lottery-unit-2 bgfffeec">三等奖</td> -->
<!-- 								<td class="lottery-unit lottery-unit-3 bgffecec">谢谢参与</td> -->
<!-- 							</tr> -->
<!-- 							<tr> -->
<!-- 								<td class="lottery-unit lottery-unit-11 bgffecec">谢谢参与</td> -->
<!-- 								<td colspan="2" rowspan="2"><a href="#" -->
<!-- 									v-click="starting()"><img src="images/start.jpg" -->
<!-- 										width="100%"></a></td> -->
<!-- 								<td class="lottery-unit lottery-unit-4 bgfffeec">一等奖</td> -->
<!-- 							</tr> -->
<!-- 							<tr> -->
<!-- 								<td class="lottery-unit lottery-unit-10 bgfffeec">三等奖</td> -->
<!-- 								<td class="lottery-unit lottery-unit-5 bgffecec">二等奖</td> -->
<!-- 							</tr> -->
<!-- 							<tr> -->
<!-- 								<td class="lottery-unit lottery-unit-9 bgffecec">谢谢参与</td> -->
<!-- 								<td class="lottery-unit lottery-unit-8 bgfffeec">二等奖</td> -->
<!-- 								<td class="lottery-unit lottery-unit-7 bgffecec">一等奖</td> -->
<!-- 								<td class="lottery-unit lottery-unit-6 bgfffeec">三等奖</td> -->
<!-- 							</tr> -->
<!-- 						</table> -->
<!-- 					</div> -->
<!-- 				</div> -->
<!-- 			</div> -->
<!-- 		</div> -->
		<div class="c1" id="c1" style="position: relative;">
			<div
				style="position: absolute;width:100%;text-align:center;z-index: 1;height:100%;overflow:auto;margin:auto;top:0;right:0;left:0;bottom:0">
			<img class="dzpan" id="dzpan" src="images/dzpan.png" v-click="togo()"
				 style="position: absolute;width:20%;text-align:center;overflow:auto;margin:auto;top:0;right:0;left:0;bottom:0">
			</div>
			<img class="dzp" style="width: 100%;" id="dzp"
				src="images/dzp.png">
		</div>
	
		<div class="bottom">
			<div class="color1">游戏规则</div>
			<div class="color2" v-bind-html="activityRule">
				{{activityRule}}
			</div>
		</div>
	</div>
</div>
<style type="text/css">
body {
	margin: 0;
	padding: 0;
	font-family: "微软雅黑";
	background: #fff3b9;
}

#lottery {
	width: 100%;
	height: auto;
	overflow: hidden;
	margin: 0 auto;
}

#lottery table td {
	height: auto;
	padding: 0;
	text-align: center;
	vertical-align: middle;
	font-size: 24px;
	color: #333;
	font-index: -999
}

#lottery table td img {
	max-width: 100%
}

#lottery table td a {
	line-height: 150px;
	display: block;
	text-decoration: none;
}

#lottery table td.active {
	background-color: #ffb1a3;
}

.wrap {
	width: 94%;
	height: auto;
	margin: 0 auto;
	overflow: hidden;
	background: #ff7558;
	padding: 3%;
}

.bgfff {
	width: 96%;
	height: auto;
	margin: 0 auto;
	overflow: hidden;
	background: #fff;
	padding: 2%;
}

.bgff7558 {
	width: 98%;
	height: auto;
	margin: 0 auto;
	overflow: hidden;
	background: #ff7558;
	padding: 1%;
}

.bgfffeec {
	background: #fffeec;
	border: none;
}

.bgffecec {
	background: #ffecec;
	border: none;
}

.bottom {
	width: 94%;
	background: #fff3b9;
	padding: 3%;
	margin: 0 auto;
}

.color1 {
	color: #b65000;
	font-size: 1.4em;
	font-weight: bold;
	line-height: 30px;
}

.color2 {
	color: #5e5e5e;
	font-size: 1.1em;
	line-height: 20px;
}
</style>
<script>
	LotteryDrawCtrl.$inject = [ "$scope", "$remote", "$targets", "$context",
			"$filter", "$timeout" ];
	function LotteryDrawCtrl($scope, $remote, $targets, $context, $filter,
			$timeout) {
		$scope.init = function() {
			$scope.o = 0;
			$scope.u = 0;
			$remote.post("/pmobile/TransRewardsRuleQry.do", {"gameType":"0"}, function(data) {
				$scope.activityRule=data.activityRule
				$scope.activityRule=$scope.activityRule.replace(/br/g,"</br>")
			})
			$scope.getClientState(function(response){
				var resJson=vx.fromJson(response);
				$scope.userType=resJson.Userinfo.CifNo;
				$scope.HexinKehuhao=resJson.Userinfo.HexinKehuhao
			});
		}
		$scope.togo = function() {
			$scope.fl = 0;
			$scope.f2 = 0;
			$scope.i = 0;
			$scope.k = 0;
			$scope.spreed = 90;
			$scope.f = 0;
			$scope.wtf = 0;
			$scope.wtf = $context.getJson().innerParam;
			if (!$scope.wtf) {
				$scope.k = 1;
			}
			if ($scope.k == 0) {
				if ($scope.u == 0) {
					$scope.u=$scope.u+1;
					$remote.post("/pmobile/getNewTokenName.do", {}, function(
							data) {
						$scope.tokenName = data._tokenName;
						params = {
							"TRANSNAME" : $scope.wtf.TransName,
							"_tokenName" : $scope.tokenName,
							"clientNo":$scope.userType,
							"hostCustNo":$scope.HexinKehuhao
						}
						// 						if (!$scope.wtf.IsReward) {
						// 							alert("抱歉，抽奖次数已经用没");
						// 							return false;
						// 						}
						$remote.post("/pmobile/PlayTransRewards.do", params,
								function(data) {
									$scope.f1 = data.PrizeGrade;
									$scope.f2 = data.PrizeName;
									$scope.f3=data.IsLucky;
									if ($scope.f1 == "1") {
										var positionl = [ 300, 310, 290 ];
										var pl = Math.random() * 3 | 0;
										$scope.o = positionl[pl];
										$scope.nam="一";
									}
									if ($scope.f1 == "2") {
										var positionl = [ 340, 345, 355 ];
										var pl = Math.random() * 3 | 0;
										$scope.o = positionl[pl];
										$scope.nam="二";
									}
									if ($scope.f1 == "3") {
										var positionl = [ 375, 385, 395 ];
										var pl = Math.random() * 3 | 0;
										$scope.o = positionl[pl];
										$scope.nam="三";
									}
									if ($scope.f1 == "") {
										var positionl = [ 420, 430, 440 ];
										var pl = Math.random() * 3 | 0;
										$scope.o = positionl[pl];
									}
									$scope.toRun();
									$timeout(function(){
										if($scope.f3=="0"){
											$scope.alert("恭喜你获得"+$scope.nam+"等奖！\n 奖品为："+$scope.f2);
										}else{
											$scope.alert("还差一点，请继续努力！");
										}
									},6000);
								}, function(data) {
									alert(data.jsonError);
									return false;
								});
					});
				} else {
					$scope.alert("抱歉 ，只能进行一次抽奖！");
					return false;
				}
			} else {
				$remote.post("/pmobile/getNewTokenName.do", {}, function(data) {
					$scope.tokenName = data._tokenName;
					params = {
						"TRANSNAME" : "bbbbbb",
						"_tokenName" : $scope.tokenName,
						"clientNo":$scope.userType,
						"hostCustNo":$scope.HexinKehuhao
					}
					$remote.post("/pmobile/PlayTransRewards.do", params,
							function(data) {
								console.log(data);
								$scope.f1 = data.PrizeGrade;
								$scope.f2 = data.PrizeName;
								$scope.f3=data.IsLucky;
								if ($scope.f1 == "1") {
									var positionl = [ 300, 310, 290 ];
									var pl = Math.random() * 3 | 0;
									$scope.o = positionl[pl];
									$scope.nam="一";
									
								}
								if ($scope.f1 == "2") {
									var positionl = [ 340, 345, 355 ];
									var pl = Math.random() * 3 | 0;
									$scope.o = positionl[pl];
									$scope.nam="二";
								}
								if ($scope.f1 == "3") {
									var positionl = [ 375, 385, 395 ];
									var pl = Math.random() * 3 | 0;
									$scope.o = positionl[pl];
									$scope.nam="三";
								}
								if ($scope.f1 == "") {
									var positionl = [ 420, 430, 440 ];
									var pl = Math.random() * 3 | 0;
									$scope.o = positionl[pl];
								}
								$scope.toRun();
								$timeout(function(){
									if($scope.f3=="0"){
										alert("恭喜你获得"+$scope.nam+"等奖！\n 奖品为："+$scope.f2);
									}else{
										alert("还差一点，请继续努力！");
									}
								},5000);
							});
				});
			}
		}
		$scope.toRun = function() {
			// 		$("#dzp").rotate(90);
			if ($scope.f % 3 == 0) {

				$scope.spreed--;

			}
			if ($scope.f > 100) {

				$scope.spreed = 3;

			}
			if ($scope.f > 200) {

				$scope.spreed = 1;

			}
			$scope.i = $scope.i + $scope.spreed;
			// 			$timeout(function() {
			// 				while (f < 200) {
			// 					f++;
			// 					console.log($scope.i);
			// 					$("#dzp").css("-webkit-transform","rotate(-" + $scope.i + "deg)");
			// 					$("#dzp").css("-moz-transform","rotate(-" + $scope.i + "deg)");
			// 				}
			// 			}, 1000);
			$scope.f = $scope.f + 1;
			$("#dzp").css("-webkit-transform", "rotate(" + $scope.i + "deg)");
			$("#dzp").css("-moz-transform", "rotate(" + $scope.i + "deg)");
			$("#dzp").css("transform", "rotate(" + $scope.i + "deg)");
			$("#dzp").css("-o-transform", "rotate(" + $scope.i + "deg)");
			if ($scope.f < $scope.o ) {
				$timeout(function() {
					$scope.toRun();
				}, 10);
			}

		}
	}
	// 		$scope.starting = function() {
	// 			var lottery = {
	// 				index : -1, //当前转动到哪个位置，起点位置
	// 				count : 0, //总共有多少个位置
	// 				timer : 0, //setTimeout的ID，用clearTimeout清除
	// 				speed : 20, //初始转动速度
	// 				times : 0, //转动次数
	// 				cycle : 50, //转动基本次数：即至少需要转动多少次再进入抽奖环节
	// 				prize : -1, //中奖位置
	// 				init : function(id) {
	// 					if ($("#" + id).find(".lottery-unit").length > 0) {
	// 						console.log($("#" + id).find(".lottery-unit"));
	// 						$lottery = $("#" + id);
	// 						$units = $lottery.find(".lottery-unit");
	// 						console.log($units);
	// 						this.obj = $lottery;
	// 						this.count = $units.length;
	// 						console.log($lottery
	// 								.find(".lottery-unit-" + this.index));
	// 						$lottery.find(".lottery-unit-" + this.index).addClass(
	// 								"active");
	// 					}
	// 					;
	// 				},
	// 				roll : function() {
	// 					var index = this.index;
	// 					var count = this.count;
	// 					var lottery = this.obj;
	// 					$(lottery).find(".lottery-unit-" + index).removeClass(
	// 							"active");
	// 					index += 1;
	// 					if (index > count - 1) {
	// 						index = 0;
	// 					}
	// 					;
	// 					$(lottery).find(".lottery-unit-" + index)
	// 							.addClass("active");
	// 					this.index = index;
	// 					return false;
	// 				},
	// 				stop : function(index) {
	// 					this.prize = index;
	// 					return false;
	// 				}
	// 			};
	// 			function roll() {
	// 				lottery.times += 1;
	// 				lottery.roll();
	// 				if (lottery.times > lottery.cycle + 10
	// 						&& lottery.prize == lottery.index) {
	// 					clearTimeout(lottery.timer);
	// 					lottery.prize = -1;
	// 					lottery.times = 0;
	// 					click = false;
	// 				} else {
	// 					if (lottery.times < lottery.cycle) {
	// 						lottery.speed -= 10;
	// 					} else if (lottery.times == lottery.cycle) {
	// 						var index = $scope.set;
	// 						lottery.prize = index;
	// 					} else {
	// 						if (lottery.times > lottery.cycle + 10
	// 								&& ((lottery.prize == 0 && lottery.index == 7) || lottery.prize == lottery.index + 1)) {
	// 							lottery.speed += 110;
	// 						} else {
	// 							lottery.speed += 20;
	// 						}
	// 					}
	// 					if (lottery.speed < 40) {
	// 						lottery.speed = 40;
	// 					}
	// 					;
	// 					//console.log(lottery.times+'^^^^^^'+lottery.speed+'^^^^^^^'+lottery.prize);
	// 					lottery.timer = setTimeout(roll, lottery.speed);
	// 				}
	// 				return false;
	// 			}
	// 			if ($scope.fl == 0) {
	// 				$remote.post("/pmobile/getNewTokenName.do", {}, function(data) {
	// 					$scope.fl++;
	// 					$scope.tokenName = data._tokenName;
	// 					paras = {
	// 						"ClientType" : 2,
	// 						"GameType" : 0,
	// 						"_tokenName" : $scope.tokenName
	// 					}
	// 					$remote.post("/pmobile/PlayTransRewards.do", paras,
	// 							function(data) {
	// 								if (_RejCode = '000000') {
	// 									console.log(data);
	// 									if (data.PrizeGrade == 1) {
	// 										var positionl = [ 0, 4, 7 ];
	// 										var pl = Math.random() * 3 | 0;
	// 										console.log(positionl[pl]);
	// 										$scope.set = positionl[pl];
	// 										return false;
	// 									}
	// 									if (data.PrizeGrade == 3) {
	// 										var positionl = [ 2, 6, 10 ];
	// 										var pl = Math.random() * 3 | 0;
	// 										console.log(positionl[pl]);
	// 										$scope.set = positionl[pl];
	// 										return false;
	// 									}
	// 									if (data.PrizeGrade == 2) {
	// 										var positionl = [ 1, 5, 8 ];
	// 										var pl = Math.random() * 3 | 0;
	// 										console.log(positionl[pl]);
	// 										$scope.set = positionl[pl];
	// 										return false;
	// 									}
	// 									if (data.PrizeGrade == "") {
	// 										var positionl = [ 3, 9, 11 ];
	// 										var pl = Math.random() * 3 | 0;
	// 										console.log(positionl[pl]);
	// 										$scope.set = positionl[pl];
	// 										return false;
	// 									}
	// 								}
	// 							});
	// 					lottery.init('lottery');
	// 					lottery.speed = 100;
	// 					roll();
	// 				});
	// 			} else {
	// 				alert("对不起，只能抽奖一次");
	// 				return false;
	// 			}

	// 		}
</script>
<div v-view-setup="PSafetySetCtrl" v-init="init()">
	<div v-page>
		<div class="bg_box">
			<div class="box_cont">
				<div class="zz_cont">
				      <ul>
							<li>
								<em style="width:35%">当前认证方式：</em>
								<i style = "font-style : normal;width: 60%">{{currentSecurityText}}</i>
							</li>
							<li v-hide = "flag">
								<em style="width:35%;">选择认证方式：</em>
								<i style="width: 60%;">
									<select style="font-style:normal" v-model=newSafeType name="newSafeType" v-options="sl.optionalSafeType for sl in safeList" ></select>
								</i>
							</li>
					 </ul>
			    </div>
				<div class="zz_cont" v-hide = "flag">
					<input type="button" class="button_1" name="button" value="设置"  v-click="toConfirm()">
				</div>
			    
			</div>
		</div>
	</div>
</div>
<script>
PSafetySetCtrl.$inject = ["$scope","$remote","$targets"];
function PSafetySetCtrl($scope,$remote,$targets){
	//判断可选认证方式
	//页面初始化
	$scope.init=function(){
			$remote.post("/pmobile/ChannelAuthTypeQry.do",{},function(data){
 				$scope.optionSecurityFlag = data.SecurityFlag;
				$scope.currentSecurity =  data.OldSecurity;  
				var pList=[];//长度为几个1，内容是第几位为1
				for(i=1;i<$scope.optionSecurityFlag.length;i++){
					if($scope.optionSecurityFlag.substr(i-1,1)=="1"){
						pList.push(i);
					}
				}

				if(pList.length==1){
					$scope.flag = true;
					if ($scope.currentSecurity == 07){//当前认证方式--卡密码+手机动态码
						$scope.currentSecurityText = "卡密码+手机动态码";
					}
				}
				else {
					$scope.flag = false;
					$scope.safeList = [];
					var typeSafe = {};
					if ($scope.currentSecurity=="07"){//当前认证方式--卡密码+手机动态码
						$scope.currentSecurityText = "卡密码+手机动态码";
						typeSafe.optionalSafeType="手机key";
					}
					else if($scope.currentSecurity=="05"){//当前认证方式--手机key
						$scope.currentSecurityText = "手机key";
						typeSafe.optionalSafeType="卡密码+手机动态码";
					}
					else{//其他标识为手机渠道暂不用的认证方式，显示具体的码
						
					}
					$scope.safeList.push(typeSafe);//将初始化的数组里面的对象放入到数组中
					$scope.newSafeType= $scope.safeList[0];//给控件赋初始值
				}
			});
	} 
	
	//跳转到确认页面
	$scope.toConfirm=function(){
		
		if($scope.currentSecurity == "07"){//设置为手机key
			$remote.post("/pmobile/ChannelAuthTypeUpd.do",{"security":"05"},function(data){
				if(data._RejCode=="000000"){
					$scope.alert("认证方式修改成功");
					$scope.changeClientInfo(vx.toJson({"Security":"05"}));//修改登录信息
					$targets("content","#0");			
				}
			});
		}
		else if($scope.currentSecurity == "05"){//设置为卡密码+手机动态码
			$remote.post("/pmobile/ChannelAuthTypeUpd.do",{"security":"07"},function(data){				
				if(data._RejCode=="000000"){
					$scope.alert("认证方式修改成功");
					$scope.changeClientInfo(vx.toJson({"Security":"07"}));//修改登录信息
					$targets("content","#0");				
				}
			});
		}
		else {
			$scope.alert("您没有修改认证方式!");
		}
	}
}
</script>
//
//  SkinManager.m
//  MobileClient
//
//  Created by 杨楠 on 14/8/21.
//  Copyright (c) 2014年 pro. All rights reserved.
//

#import "SkinManager.h"
#import "Context.h"

static SkinManager* instace = nil;

@interface SkinManager ()
{
    NSString* _skinKey;
    NSArray* _backgrounds;
    NSUserDefaults* _defaults;
    BOOL isRetina4;
}
@end

@implementation SkinManager

- (NSInteger)readSkinIndex {
    return [_defaults integerForKey:_skinKey];
}

- (void)writeSkinIndex:(NSInteger)index {
    [_defaults setInteger:index forKey:_skinKey];
    [_defaults synchronize];
}

- (UIImage *)currentBackgroundImage {
    NSInteger index = [_defaults integerForKey:_skinKey];
    NSString* name = _backgrounds[index];
    if (isRetina4) {
        name = [NSString stringWithFormat:@"%@-2",name];
    }
//    NSLog(@"%@",name);
    return [UIImage imageNamed:name];
}

- (NSInteger)currentSkinKey {
    NSInteger index = [_defaults integerForKey:_skinKey];
    return index / 3;
}

+ (SkinManager *)sharedInstance {
    @synchronized(self) {
        if (!instace) {
            instace = [[self alloc] init]; //该方法会调用allWithZone:
        }
    }
    return instace;
}

+ (id)allocWithZone:(struct _NSZone *)zone {
    @synchronized(self) {
        if (!instace) {
            instace = [super allocWithZone:zone];
            return instace;
        }
    }
    return nil;
}

- (id)init {
    self = [super init];
    if (self) {
        _skinKey = @"SkinSelectKey";
        _defaults = [NSUserDefaults standardUserDefaults];
        _backgrounds = @[@"background",@"山水中原",@"中国梦",@"童年记忆",@"秋风落叶",@"冬季恋歌"];
        isRetina4 = [Context iPhone5];
//        NSLog(@"---->%f,%d",ScreenHeight,isRetina4);
    }
    return self;
}

- (id)copyWithZone:(NSZone *)zone {
    return self;
}

@end

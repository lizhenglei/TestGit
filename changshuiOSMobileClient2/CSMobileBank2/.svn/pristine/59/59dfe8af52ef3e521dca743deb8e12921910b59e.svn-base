//
//  CSIISavCalculatorController.m
//  MobileClient
//
//  Created by 张海亮 on 13-8-16.
//  Copyright (c) 2013年 pro. All rights reserved.
//

#import "CSIISavCalculatorController.h"

//#define FONT cell.textLabel.font = [UIFont fontWithName:@"Helvetica" size:15];
#define TEXTFIELD_FRAME CGRectMake(150,7,146, 30)
#define TEXTFIELD_FRAME2 CGRectMake(150,7,120, 30)
#define PULLDOWN_WIDTH 25

#define TEXTFIELD_FRAME_IPad CGRectMake(self.view.bounds.size.width-45-166-10,7,166, 30)
#define TEXTFIELD_FRAME2_IPad CGRectMake(self.view.bounds.size.width-45-130-10,7,130, 30)

@interface CSIISavCalculatorController ()
{
    float exchangeRate;
    UIPickerView *saveTimePick;
    NSMutableArray *timeKey;
    
    UIImageView *yuanJiaoImageUp;
    UIImageView *yuanJiaoImageDown;
}
@end

@implementation CSIISavCalculatorController

@synthesize calculateTableView;

- (void)viewDidLoad
{
    [super viewDidLoad];
    timeKey = [NSMutableArray array];
    exchangeRate = 1.0;
    calculateTableView = [[UITableView alloc] initWithFrame:self.view.bounds style:UITableViewStyleGrouped];
    calculateTableView.backgroundView = nil;
    calculateTableView.backgroundColor = [UIColor clearColor];
    calculateTableView.delegate = self;
    calculateTableView.dataSource = self;
    [self.view addSubview:calculateTableView];
    
	// Do any additional setup after loading the view.
    YuanArray=[NSArray arrayWithObjects:@"人民币",@"欧元",@"美元",@"英镑",@"加拿大元",@"新加坡元",@"瑞士法郎",@"港元",@"日元",@"澳元",nil];
    
    NewArray=[NSArray arrayWithObjects:@"整存整取",@"零存整取",@"活期",@"存本取息",@"定活两便",nil];
    
    ratedictionary=[NSDictionary dictionaryWithObjectsAndKeys :@"0.28600%", @"三个月",@"3.0800%",@"六个月",@"3.3000%",@"一年",@"4.1250%",@"两年",@"4.67500%",@"三年",@"5.22500%",@"五年",nil];
    [timeKey addObjectsFromArray:[ratedictionary allKeys]];
    

    
    yuanJiaoImageUp = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"安全中心_r1_c1.png"]];
    
    yuanJiaoImageDown = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"安全中心_r4_c1.png"]];}

- (CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section{
    
    switch (section) {
        case 0:
            return 20;
            break;
            
        case 1:
            return 10;
            break;
    }
    return 0;
}

-(UIView *)tableView:(UITableView *)tableView viewForHeaderInSection:(NSInteger)section
{
//    if (section==0) {
//        UIView *coverview0=[[UIView alloc]initWithFrame:CGRectMake(0, 0, 320, 40)];
//        UILabel*labeltitle= [[UILabel alloc]initWithFrame:CGRectMake(20, 2, 300, 30)];
//        labeltitle.backgroundColor = [UIColor clearColor];
//        labeltitle.font=[UIFont fontWithName:@"Helvetica" size:20];
//        labeltitle.text = @"存款计算器";
//        [coverview0 addSubview:labeltitle];
//        
//        return coverview0;
//    }
    
    return nil;
}

-(CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath
{
    if (indexPath.section==1) {
        return 60;
    }
    return 44;
}
- (CGFloat)tableView:(UITableView *)tableView heightForFooterInSection:(NSInteger)section{
    switch (section) {
        case 0:
            return 10;
            break;
            
        case 1:
            return 60;
            break;
    }
    return 0;
}
- (void)viewWillAppear:(BOOL)animated
{
    [super viewWillAppear:animated];
    ((UILabel*)[self.navigationController.navigationBar viewWithTag:99]).text = @"存款计算器";
}

- (void)didReceiveMemoryWarning
{
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}


#pragma mark - Table view data source

- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView
{
    // Return the number of sections.
    return 2;
}

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section
{
    // Return the number of rows in the section.
    switch (section) {
        case 0:
            return 7;
            break;
        case 1:
            return 1;
        default:
            break;
    }
    return 0;
}


- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
    //  记得修改这3行，初始化定义cell
    NSString *CellIdentifier=[NSString stringWithFormat:@"%d %d",indexPath.section,indexPath.row];
    UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:CellIdentifier];
    
    if(cell == nil){
        cell =[[UITableViewCell alloc]initWithStyle:UITableViewCellStyleDefault reuseIdentifier:CellIdentifier];
        cell.backgroundColor=[UIColor clearColor];
        cell.selectionStyle = UITableViewCellSelectionStyleNone;
        SET_CELL_TEXTLABEL_FONT;
        
    switch (indexPath.section) {
        case 0:
            if(indexPath.row == 0){
                cell.textLabel.text=@"存款类型：";
                cell.backgroundView = yuanJiaoImageUp;
                Newfield=[[CSIITextField alloc] initWithAccount:self frame:IPAD ? TEXTFIELD_FRAME_IPad:TEXTFIELD_FRAME pickerData:nil];
                Newfield.BorderStyle=UITextBorderStyleNone;
                Newfield.background = IMAGE(@"输入框.png");
                Newfield.delegate = self;
                Newfield.text = NewArray[0];
                [self.inputControls addObject:Newfield];
                Newpickview=[[UIPickerView alloc] init];
                Newpickview.showsSelectionIndicator = YES;
                Newpickview.delegate = self;
                Newpickview.dataSource = self;
                Newfield.inputView = Newpickview;
                
//                UIButton *doneBtn = [[UIButton alloc]initWithFrame:CGRectMake(236, 2, 74, 38)];
//                [doneBtn setImage:[UIImage imageWithContentsOfFile:[[NSBundle mainBundle] pathForResource:@"done.png" ofType:nil]] forState:UIControlStateNormal];
//                [doneBtn addTarget:self action:@selector(changeSavKind:) forControlEvents:UIControlEventTouchUpInside];
//                [Newfield.inputAccessoryView addSubview:doneBtn];
                UIImageView *xiala = [[UIImageView alloc] initWithImage:IMAGE(@"下拉框.png")];
                xiala.frame = CGRectMake(Newfield.frame.origin.x+Newfield.frame.size.width-PULLDOWN_WIDTH, Newfield.frame.origin.y, PULLDOWN_WIDTH, Newfield.frame.size.height);
                
                [cell.contentView addSubview:Newfield];
                [cell.contentView addSubview:xiala];
            }
            else if(indexPath.row == 1){
                cell.textLabel.text=@"币      种:";
                UIImageView* rectangleImage1 = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"安全中心_r2_c1.png"]];
                cell.backgroundView = rectangleImage1;
                Yuanfield=[[CSIITextField alloc] initWithFrame:IPAD ? TEXTFIELD_FRAME_IPad:TEXTFIELD_FRAME];
                Yuanfield.BorderStyle=UITextBorderStyleNone;
                Yuanfield.background = IMAGE(@"输入框.png");
                Yuanfield.clearButtonMode = UITextFieldViewModeNever;
                Yuanfield.delegate = self;
                Yuanfield.text = YuanArray[0];
                [self.inputControls addObject:Yuanfield];
                Yuanpickview=[[UIPickerView alloc] init];
                Yuanpickview.showsSelectionIndicator = YES;
                Yuanpickview.delegate = self;
                Yuanpickview.dataSource = self;
                Yuanfield.inputView =Yuanpickview;
//                btn = [[UIButton alloc]initWithFrame:CGRectMake(236, 2, 74, 38)];
//                [btn setImage:[UIImage imageWithContentsOfFile:[[NSBundle mainBundle] pathForResource:@"done.png" ofType:nil]] forState:UIControlStateNormal];
//                [btn addTarget:self action:@selector(hiddenKeyboard:) forControlEvents:UIControlEventTouchUpInside];
//                [Yuanfield.inputAccessoryView addSubview:btn];
                
                UIImageView *xiala = [[UIImageView alloc] initWithImage:IMAGE(@"下拉框.png")];
                xiala.frame = CGRectMake(Yuanfield.frame.origin.x+Yuanfield.frame.size.width-PULLDOWN_WIDTH, Yuanfield.frame.origin.y, PULLDOWN_WIDTH, Yuanfield.frame.size.height);
                
                [cell.contentView addSubview:Yuanfield];
                [cell.contentView addSubview:xiala];
            }
            else if (indexPath.row == 2)
            {
                cell.textLabel.text=@"存款期限：";
                saveTime=[[CSIITextField alloc] initWithFrame:IPAD ? TEXTFIELD_FRAME_IPad:TEXTFIELD_FRAME];
                saveTime.BorderStyle=UITextBorderStyleNone;
                saveTime.background = IMAGE(@"输入框.png");
                saveTime.clearButtonMode = UITextFieldViewModeNever;
                saveTime.text = [timeKey objectAtIndex:0];
                saveTime.delegate=self;
                [self.inputControls addObject:saveTime];
                
                saveTimePick=[[UIPickerView alloc] init];
                saveTimePick.showsSelectionIndicator = YES;
                saveTimePick.delegate = self;
                saveTimePick.dataSource = self;
                saveTime.inputView =saveTimePick;
                
//                UIButton *doneBtn = [[UIButton alloc]initWithFrame:CGRectMake(236, 2, 74, 38)];
//                [doneBtn setImage:[UIImage imageWithContentsOfFile:[[NSBundle mainBundle] pathForResource:@"done.png" ofType:nil]] forState:UIControlStateNormal];
//                [doneBtn addTarget:self action:@selector(savKind:) forControlEvents:UIControlEventTouchUpInside];
//                [saveTime.inputAccessoryView addSubview:doneBtn];
               UIImageView* rectangleImage2 = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"安全中心_r2_c1.png"]];
                cell.backgroundView = rectangleImage2;
                
                UIImageView *xiala = [[UIImageView alloc] initWithImage:IMAGE(@"下拉框.png")];
                xiala.frame = CGRectMake(saveTime.frame.origin.x+saveTime.frame.size.width-PULLDOWN_WIDTH, saveTime.frame.origin.y, PULLDOWN_WIDTH, saveTime.frame.size.height);
                
                [cell.contentView addSubview:saveTime];
                [cell.contentView addSubview:xiala];
            }
            else if(indexPath.row == 3){
                cell.textLabel.text=@"初始存款金额：";
                UIImageView* rectangleImage3 = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"安全中心_r2_c1.png"]];
                cell.backgroundView = rectangleImage3;
                textfield=[[CSIITextField alloc] initWithFrame:IPAD ? CGRectMake(self.view.bounds.size.width-275, 8, 130, 30) : TEXTFIELD_FRAME2];
//                textfield.backgroundColor = [UIColor clearColor];
                textfield.placeholder = @"初始存款数目";
                textfield.clearButtonMode = UITextFieldViewModeWhileEditing;
                textfield.BorderStyle=UITextBorderStyleNone;
                textfield.background = IMAGE(@"输入框.png");
                [self.inputControls addObject:textfield];
                textfield.keyboardType=UIKeyboardTypeDecimalPad;
                textfield.delegate=self;
                textfield.textAlignment = NSTextAlignmentLeft;
                [cell.contentView addSubview:textfield];
                
                UILabel *label = [[UILabel alloc]initWithFrame:IPAD ? CGRectMake(self.view.bounds.size.width-135, 8, 25, 30):CGRectMake(275, 8, 25, 27)];
                label.text = @"元";
                label.backgroundColor = [UIColor clearColor];
                [cell.contentView addSubview:label];
            }
            else if(indexPath.row == 4){
                cell.textLabel.text=@"年  利  率：";
                UIImageView* rectangleImage4 = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"安全中心_r2_c1.png"]];
                cell.backgroundView = rectangleImage4;
                ratefield=[[CSIITextField alloc] initWithFrame:IPAD ? CGRectMake(self.view.bounds.size.width-275, 8, 130, 30) : TEXTFIELD_FRAME2];
                ratefield.text = @"4.572";//[NSString stringWithFormat:@"%.3f",rate];
                ratefield.clearButtonMode = UITextFieldViewModeWhileEditing;
                ratefield.BorderStyle=UITextBorderStyleNone;
                ratefield.background = IMAGE(@"输入框.png");
                [self.inputControls addObject:ratefield];
                ratefield.keyboardType=UIKeyboardTypeDecimalPad;
                ratefield.delegate=self;
                ratefield.textAlignment = NSTextAlignmentLeft;
                [cell.contentView addSubview:ratefield];
                
                UILabel *label = [[UILabel alloc]initWithFrame:IPAD ? CGRectMake(self.view.bounds.size.width-135, 8, 25, 30):CGRectMake(275, 8, 25, 27)];
                label.text = @"%";
                label.backgroundColor = [UIColor clearColor];
                [cell.contentView addSubview:label];
            }
            else if(indexPath.row == 5){
                cell.textLabel.text=@"存款利息：";
                UIImageView* rectangleImage5 = [[UIImageView alloc] initWithImage:[UIImage imageNamed:@"安全中心_r2_c1.png"]];
                cell.backgroundView = rectangleImage5;
                resultlable=[[UILabel alloc] initWithFrame:IPAD ? CGRectMake(self.view.bounds.size.width-265, 8, 130, 27):TEXTFIELD_FRAME];
                resultlable.textAlignment = NSTextAlignmentRight;
                resultlable.backgroundColor = [UIColor clearColor];
                [cell.contentView addSubview:resultlable];
                
            }
            else if(indexPath.row == 6){
                cell.textLabel.text=@"本息总额：";
                cell.backgroundView = yuanJiaoImageDown;
                resultlableAmount=[[UILabel alloc] initWithFrame:IPAD ? CGRectMake(self.view.bounds.size.width-265, 8, 130, 27):TEXTFIELD_FRAME];
                resultlableAmount.textAlignment = NSTextAlignmentRight;
                resultlableAmount.backgroundColor = [UIColor clearColor];
                
                [cell.contentView addSubview:
                 resultlableAmount];
            }
            break;
        case 1:
        {
            UIView *tempView=[[UIView alloc]init];
            tempView.backgroundColor=[UIColor clearColor];
            cell.backgroundView=tempView;
            UIButton*calculatebtn;
            UILabel *label;
            switch (indexPath.row) {
                case 0:
                    label = [[UILabel alloc]initWithFrame:CGRectMake(0, 0, self.view.bounds.size.width-20, 40)];
                    label.font = [UIFont systemFontOfSize:22];
                    label.text = @"计算";
                    label.textAlignment=NSTextAlignmentCenter;
                    label.backgroundColor = [UIColor clearColor];
                    label.textColor = [UIColor whiteColor];
                    calculatebtn = [UIButton buttonWithType:UIButtonTypeCustom];
                    if (IPAD) {
                        calculatebtn.frame = CGRectMake(0, 0, self.view.bounds.size.width-90, 40);
                    } else {
                        calculatebtn.frame = CGRectMake(0, 0, self.view.bounds.size.width-20, 40);
                    }
                    
                    
                    [calculatebtn setBackgroundImage:[UIImage imageNamed:@"按钮_r1_c1.png"] forState:UIControlStateNormal];
                    [calculatebtn setBackgroundImage:[UIImage imageNamed:@"按钮_r3_c2.png"] forState:UIControlStateHighlighted];
                    calculatebtn.layer.masksToBounds = YES;
                    calculatebtn.layer.cornerRadius = 10.f;
                    [calculatebtn addSubview:label];
                    
                    [calculatebtn addTarget:self action:@selector(buttondo) forControlEvents:UIControlEventTouchUpInside];
                    [cell.contentView addSubview:calculatebtn];
        
                    break;
                    
                default:
                    break;
            }
            }
    }
    }
    
    
    return cell;
}

-(BOOL)textFieldShouldBeginEditing:(UITextField *)textField{
    
    return YES;
}


-(void)changeSavKind:(id)sender
{
    if (self.view.frame.origin.y<0) {
        NSTimeInterval animationDuration = 0.30f;
        [UIView beginAnimations:@"ResizeForKeyboard" context:nil];
        [UIView setAnimationDuration:animationDuration];
        CGRect rect = CGRectMake(0.0f, 0.0f, self.view.frame.size.width, self.view.frame.size.height);
        self.view.frame = rect;
        [UIView commitAnimations];
    }
    
    [Newfield resignFirstResponder];
    [timeKey removeAllObjects];
    
    if (![Newfield.text isEqualToString:@"定活两便"])
    {
       ratedictionary=[NSDictionary dictionaryWithObjectsAndKeys :@"0.28600%", @"三个月",@"3.0800%",@"六个月",@"3.3000%",@"一年",@"4.1250%",@"两年",@"4.67500%",@"三年",@"5.22500%",@"五年",nil];
        [timeKey addObjectsFromArray:[ratedictionary allKeys]];
        [saveTimePick reloadAllComponents];
        return;
    }
    ratedictionary=[NSDictionary dictionaryWithObjectsAndKeys :@"2.86000%",@"一年",@"3.0800%",@"三年",@"3.3000%",@"五年",nil];
    [timeKey addObjectsFromArray:[ratedictionary allKeys]];
    [saveTimePick reloadAllComponents];
}

-(void)savKind:(id)sender
{
    if (self.view.frame.origin.y<0) {
        NSTimeInterval animationDuration = 0.30f;
        [UIView beginAnimations:@"ResizeForKeyboard" context:nil];
        [UIView setAnimationDuration:animationDuration];
        CGRect rect = CGRectMake(0.0f, 0.0f, self.view.frame.size.width, self.view.frame.size.height);
        self.view.frame = rect;
        [UIView commitAnimations];
    }    
    
    [saveTime resignFirstResponder];
    if ([Newfield.text isEqualToString:@"活期"])
    {
        rate = 0.385;
        NSIndexPath *index = [NSIndexPath indexPathForRow:4 inSection:0];
        NSArray *array = [NSArray arrayWithObjects:index, nil];
        [self.calculateTableView reloadRowsAtIndexPaths:array withRowAnimation:UITableViewRowAnimationFade];
        return;
    }
    if([Newfield.text isEqualToString: @"整存整取"])
    {
        if([saveTime.text isEqualToString:@"三个月"]){
            rate = 2.86;
        }else if([saveTime.text isEqualToString:@"六个月"]){
            rate = 3.08;
        }else if([saveTime.text isEqualToString:@"一年"]){
            rate = 3.30;
        }else if([saveTime.text isEqualToString:@"两年"]){
            rate = 4.125;
        }else if([saveTime.text isEqualToString:@"三年"]){
            rate = 4.675;
        }else if([saveTime.text isEqualToString:@"五年"]){
            rate = 5.225;
        }
        NSIndexPath *index = [NSIndexPath indexPathForRow:4 inSection:0];
        NSArray *array = [NSArray arrayWithObjects:index, nil];
        [self.calculateTableView reloadRowsAtIndexPaths:array withRowAnimation:UITableViewRowAnimationFade];
        return;
    }
    if([Newfield.text isEqualToString:@"定活两便"])
    {
        if([saveTime.text isEqualToString:@"三个月"]){
            rate = 2.86;
        }else if([saveTime.text isEqualToString:@"六个月"]){
            rate = 3.08;
        }else if([saveTime.text isEqualToString:@"一年"]){
            rate = 3.30;
        }else if([saveTime.text isEqualToString:@"两年"]){
            rate = 4.125;
        }else if([saveTime.text isEqualToString:@"三年"]){
            rate = 4.675;
        }else if([saveTime.text isEqualToString:@"五年"]){
            rate = 5.225;
        }
        rate *=0.6;
    }
    else
    {
        if([saveTime.text isEqualToString:@"一年"]){
            rate = 2.86;
        }else if([saveTime.text isEqualToString:@"三年"]){
            rate = 3.08;
        }else if([saveTime.text isEqualToString:@"五年"]){
            rate = 3.30;
        }
    }
    NSIndexPath *index = [NSIndexPath indexPathForRow:4 inSection:0];
    NSArray *array = [NSArray arrayWithObjects:index, nil];
    [self.calculateTableView reloadRowsAtIndexPaths:array withRowAnimation:UITableViewRowAnimationFade];
}

-(void)hiddenKeyboard:(id)sender{
    
    if (self.view.frame.origin.y<0) {
        NSTimeInterval animationDuration = 0.30f;
        [UIView beginAnimations:@"ResizeForKeyboard" context:nil];
        [UIView setAnimationDuration:animationDuration];
        CGRect rect = CGRectMake(0.0f, 0.0f, self.view.frame.size.width, self.view.frame.size.height);
        self.view.frame = rect;
        [UIView commitAnimations];
    }
    
    [Yuanfield resignFirstResponder];
    if([Yuanfield.text isEqualToString: @"人民币"]){
        exchangeRate = 1.0;
    }else if([Yuanfield.text isEqualToString:@"欧元"]){
        exchangeRate = 8.1515;
    }else if([Yuanfield.text isEqualToString:@"美元"]){
        exchangeRate = 6.111;
    }else if([Yuanfield.text isEqualToString:@"英镑"]){
        exchangeRate = 9.5555;
    }else if([Yuanfield.text isEqualToString:@"加拿大元"]){
        exchangeRate = 5.9198;
    }else if([Yuanfield.text isEqualToString:@"新加坡元"]){
        exchangeRate = 4.8102;
    }else if([Yuanfield.text isEqualToString:@"瑞士法郎"]){
        exchangeRate = 0.9388;
    } else if([Yuanfield.text isEqualToString:@"港元"]){
        exchangeRate = 0.7882;
    }else if([Yuanfield.text isEqualToString:@"日元"]){
        exchangeRate = 0.0627;
    }else if([Yuanfield.text isEqualToString:@"澳元"]){
        exchangeRate = 5.6319;
    }
}
#pragma mark - Table view delegate

-(void)buttondo
{
    if (textfield.text ==nil || [textfield.text doubleValue]<0 ||[textfield.text hasPrefix:@"."] ||[textfield.text hasSuffix:@"."]) {
        UIAlertView * aler=[[UIAlertView alloc]initWithTitle:nil message:@"请输入正确金额" delegate:self  cancelButtonTitle:@"确定" otherButtonTitles:nil, nil];
        [aler show];
    }
if([saveTime.text isEqualToString:@"三个月"]){
    double resultMeony = [textfield.text doubleValue]*exchangeRate*([ratefield.text doubleValue]/100)/4;
    resultlable.text = [NSString stringWithFormat:@"%0.2lf元",resultMeony];
    resultlableAmount.text = [NSString stringWithFormat:@"%0.2f元",[textfield.text doubleValue]*exchangeRate+resultMeony];
    
}else if([saveTime.text isEqualToString:@"六个月"]){
    double resultMeony = [textfield.text doubleValue]*exchangeRate*([ratefield.text doubleValue]/100)/2;
    resultlable.text = [NSString stringWithFormat:@"%0.2lf元",resultMeony];
    resultlableAmount.text = [NSString stringWithFormat:@"%0.2f元",[textfield.text doubleValue]*exchangeRate+resultMeony];
}else if([saveTime.text isEqualToString:@"一年"]){
    double resultMeony = [textfield.text doubleValue]*exchangeRate*([ratefield.text doubleValue]/100);
    resultlable.text = [NSString stringWithFormat:@"%0.2lf元",resultMeony];
    resultlableAmount.text = [NSString stringWithFormat:@"%0.2f元",[textfield.text doubleValue]*exchangeRate+resultMeony];
}else if([saveTime.text isEqualToString:@"两年"]){
    double resultMeony = [textfield.text doubleValue]*exchangeRate*([ratefield.text doubleValue]/100)*2;
    resultlable.text = [NSString stringWithFormat:@"%0.2lf元",resultMeony];
    resultlableAmount.text = [NSString stringWithFormat:@"%0.2f元",[textfield.text doubleValue]*exchangeRate+resultMeony];
}else if([saveTime.text isEqualToString:@"三年"]){
    double resultMeony = [textfield.text doubleValue]*exchangeRate*([ratefield.text doubleValue]/100)*3;
    resultlable.text = [NSString stringWithFormat:@"%0.2lf元",resultMeony];
    resultlableAmount.text = [NSString stringWithFormat:@"%0.2f元",[textfield.text doubleValue]*exchangeRate+resultMeony];
}else if([saveTime.text isEqualToString:@"五年"]){
    double resultMeony = [textfield.text doubleValue]*exchangeRate*([ratefield.text doubleValue]/100)*5;
    resultlable.text = [NSString stringWithFormat:@"%0.2lf元",resultMeony];
    resultlableAmount.text = [NSString stringWithFormat:@"%0.2f元",[textfield.text doubleValue]*exchangeRate+resultMeony];
}
}


- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath
{
    [tableView deselectRowAtIndexPath:indexPath animated:YES];
    
}

-(NSInteger)numberOfComponentsInPickerView:(UIPickerView *)pickerView{
    return 1;
}

-(NSInteger) pickerView:(UIPickerView *)pickerView numberOfRowsInComponent:(NSInteger)component{
    if(pickerView == Yuanpickview){
        return [YuanArray count];
    }
    else if(pickerView == saveTimePick)
    {
        return [timeKey count];
    }
    else
    {
        return [NewArray count];
    }
}

-(NSString*) pickerView:(UIPickerView *)pickerView titleForRow:(NSInteger)row forComponent:(NSInteger)component{
    if(pickerView == Yuanpickview){
        return [YuanArray objectAtIndex:row];
        [Newpickview reloadInputViews];
    }
    else if(pickerView == saveTimePick)
    {
        return [timeKey objectAtIndex:row];
    }
    else
    {
        return [NewArray objectAtIndex:row];
    }
}

-(void)doneClicked
{
    if([saveTime.text isEqualToString: @"三个月"]){
        rate = 0.028600;        
    }else if([saveTime.text isEqualToString:@"六个月"]){
        rate= 0.030800;
    }else if([saveTime.text isEqualToString:@"一年"]){
        rate = 0.033000;
    }else if([saveTime.text isEqualToString:@"两年"]){
        rate = 0.041250;
    }else if([saveTime.text isEqualToString:@"三年"]){
        rate = 0.042500;        
    }else if([saveTime.text isEqualToString:@"五年"]){
        rate = 0.047500;        
    }else{
        rate = 0.047500;
    }
    ratefield.text = [NSString stringWithFormat:@"%.3f",rate*100];
    [saveTime resignFirstResponder];
}

-(void)doneClicked1
{
    NSInteger type = [Newpickview selectedRowInComponent:0];
    YuanArray = nil;
    if(type == 0){
        YuanArray=[NSArray arrayWithObjects:@"三个月",@"六个月",@"一年",@"两年",@"三年",@"五年",nil];
    }else{
        YuanArray=[NSArray arrayWithObjects:@"一年",@"三年",@"五年",@"1",@"2",@"3",nil];
    }
    [Newfield resignFirstResponder];
}

-(void)doneClicked2
{
    [textfield resignFirstResponder];
}

-(void)textFieldDidEndEditing:(UITextField *)textField
{
    [self doneClicked];
    
    if(textField == Yuanfield){
        NSInteger row = [Yuanpickview selectedRowInComponent:0];
        Yuanfield.text = [YuanArray objectAtIndex:row];
    }
    else if (textField == saveTime)
    {
        NSInteger row = [saveTimePick selectedRowInComponent:0];
        saveTime.text = [timeKey objectAtIndex:row];
    }
    else
    {
        NSInteger row = [Newpickview selectedRowInComponent:0];
        Newfield.text = [NewArray objectAtIndex:row];
    }
}


@end

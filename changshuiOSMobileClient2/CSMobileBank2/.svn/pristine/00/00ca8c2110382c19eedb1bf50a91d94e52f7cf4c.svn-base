//
//  PiontStoreViewController.m
//  MobileClient
//
//  Created by 李正雷 on 15/7/20.
//  Copyright (c) 2015年 pro. All rights reserved.
//

#import "PiontStoreViewController.h"

#import "CommonFunc.h"

@interface PiontStoreViewController ()<UIWebViewDelegate>
{
    UIWebView *webView;
}
@end

@implementation PiontStoreViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    webView = [[UIWebView alloc]initWithFrame:CGRectMake(0, 0, self.view.bounds.size.width, self.view.bounds.size.height - 44 - 60)];
    webView.delegate= self;
    self.view.backgroundColor = [UIColor clearColor];
    NSString *urlString;
    if ([MobileBankSession sharedInstance].isLogin == YES) {
        NSString *phoneNum = [[MobileBankSession sharedInstance].Userinfo objectForKey:@"MobileNo"];
        NSData *data = [phoneNum dataUsingEncoding:NSUTF8StringEncoding];
        NSString *base64String = [CommonFunc base64EncodedStringFrom:data];
        NSString *md5KeyString = [NSString stringWithFormat:@"%@K74YQXF1RNDPSR5G0815X18H08733OID",phoneNum];
        NSString *md5String = [CommonFunc md5:md5KeyString];
        if ([self.webViewUrl rangeOfString:@"?"].length>0) {
            urlString = [NSString stringWithFormat:@"%@&mobile=%@&crypt=%@",self.webViewUrl,base64String,md5String];
        }else{
            urlString = [NSString stringWithFormat:@"%@?mobile=%@&crypt=%@",self.webViewUrl,base64String,md5String];
        }
    }else{
        urlString = self.webViewUrl;
    }
    NSURL *url = [NSURL URLWithString:urlString];
    NSURLRequest *request = [NSURLRequest requestWithURL:url cachePolicy:0 timeoutInterval:15.0f];
    [webView loadRequest:request];
    [self.view addSubview:webView];
    
//    NSString *dataString = [NSString stringWithContentsOfURL:url encoding:NSUTF8StringEncoding error:nil];
//    [webViewController loadHTMLString:dataString baseURL:nil];
}

-(void)webViewDidStartLoad:(UIWebView *)webView
{
    [[MobileBankSession sharedInstance] showMask:nil maskMessage:@"请稍后..." maskType:Common];
}
-(void)webViewDidFinishLoad:(UIWebView *)webView
{
    [[MobileBankSession sharedInstance] hideMask];
}
-(void)webView:(UIWebView *)webView didFailLoadWithError:(NSError *)error
{
    UIAlertView *alert = [[UIAlertView alloc]initWithTitle:@"提示" message:@"请求超时" delegate:self cancelButtonTitle:@"确认" otherButtonTitles:nil, nil];
    [alert show];
}
-(void)alertView:(UIAlertView *)alertView clickedButtonAtIndex:(NSInteger)buttonIndex
{
    if (buttonIndex==0) {
        [self.navigationController popToRootViewControllerAnimated:YES];
    }
}

-(void)viewWillAppear:(BOOL)animated
{
    [super viewWillAppear:animated];
    ((UILabel *)[self.navigationController.navigationBar viewWithTag:99]).text = self.webViewName;
}

- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}
-(void)viewWillDisappear:(BOOL)animated
{
    [super viewWillDisappear:animated];
//    
//    NSURLRequest *request = [NSURLRequest requestWithURL:[NSURL URLWithString:@"about:blank"]];
//    [webView loadRequest:request];
//    [[NSURLCache sharedURLCache] removeAllCachedResponses];
    
}

/*
#pragma mark - Navigation

// In a storyboard-based application, you will often want to do a little preparation before navigation
- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender {
    // Get the new view controller using [segue destinationViewController].
    // Pass the selected object to the new view controller.
}
*/

@end

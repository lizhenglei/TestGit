<div v-view-setup="PLifePayCtrl" v-init="init()">
	<!--1 电费缴费查询录入-->
	<div v-page v-transition="native" title="生活缴费">
		<div class="jiaofei">
			<ul>
				<li class="borderright CheckElect" v-click="changeType('2')"  style="font-size:18px;vertical-align:middle;">
					<img v-show="fdf" class="imgdf" src="images/df.png"><img v-hide="fdf" class="imgdf" src="images/df1.png"><span style="font-size:16px;   padding-top: 2px; padding-left:10px;display:inline-block;height:100%;vertical-align:middle;">电费</span>
				</li>
				<li class="borderright CheckWater" v-click="changeType('1')" style="font-size:18px;vertical-align:middle;"> 
					<img v-show="fsf" class="imgsf" src="images/sf.png"><img v-hide="fsf" class="imgsf" src="images/sf1.png"><span style="font-size:16px;   padding-top: 2px; padding-left:10px;display:inline-block;height:100%;vertical-align:middle;">水费</span>
				</li>
				<li class="CheckPhone" v-click="changeType('3')" style="font-size:18px;vertical-align:middle;">
					<img v-show="fhf" class="imghf" src="images/hf.png"><img v-hide="fhf" class="imghf" src="images/hf1.png"><span style="font-size:16px;  padding-top: 2px; padding-left:10px;display:inline-block;height:100%;vertical-align:middle;">固话</span>
				</li>
			</ul>
	    </div> 
		<div class="bg_box">
			<div class="box_cont">
				<div class="zz_cont">
					<ul>
						<li v-show="ChangePayType!=3">
							<em>省  份 ：</em>
							<i>
								江苏省
							</i>
						</li>
						<li v-show="ChangePayType!=3">
							<em> 城  市 ：</em>
							<i>
								<select v-model="City" name="City" 
								 v-change="changeCity()" v-options="tl.Name for tl in CityList" >
								</select>
							</i>
						</li>
<!-- 						<li v-show="ChangePayType==3||PayTypeBool"> -->
<!-- 							<em>缴费名称：</em> -->
<!-- 							<i> -->
<!-- 								<select v-model="PayType" name="PayType" -->
<!-- 								 v-change="checkPayType()" v-options="tl.Name for tl in PayTypeList" > -->
<!-- 								</select> -->
<!-- 							</i> -->
<!-- 						</li> -->
						<li  v-show="ChangePayType==3"> 
							<em>固话号码：</em>
							<i>
								<input v-model="PhonePayNo" name="PhonePayNo"  v-change="judje(PhonePayNo)"  maxlength="8" placeholder="请输入固话号码" class="y_srk" required>
								</input>
								<span v-click="queryBook('03')"><img src="images/skr_icon.png" /></span>
							</i>
						</li>
						<li v-show="ChangePayType==1"> 
							<em>水 表 号：</em>
							<i>
								<input v-model="WaterPayNo" name="WaterPayNo" v-change="judje(WaterPayNo)" placeholder="请输入水表号" class="y_srk" required>
								</input>
								<span v-click="queryBook('01')"><img src="images/skr_icon.png" /></span>
							</i>
						</li>
						<li  v-show="ChangePayType==2"> 
							<em>电费总户号：</em>
							<i>
								<input v-model="ElectPayNo" pname="ElectPayNo" v-change="judje(ElectPayNo)" placeholder="请输入电费总户号" class="y_srk" required>
								</input>
								<span v-click="queryBook('02')"><img src="images/skr_icon.png" /></span>
							</i>
						</li>
					</ul>
					<div>
			     		<input  type="submit"  class="button_1" name="Submit" value="查询" v-disabled="fl" v-click="queryPayInfo()"/>
			     	</div>
			    </div>
			</div>
		</div>
	</div>
	<!--2  电费缴费信息查询-->
	<div v-page v-transition="native">
		<div class="jiaofei">
			<ul>
				<li class="borderright CheckElect" v-click="changeType('2')"  style="font-size:18px;vertical-align:middle;">
					<img v-show="fdf" class="imgdf" src="images/df.png"><img v-hide="fdf" class="imgdf" src="images/df1.png"><span style="font-size:16px;   padding-top: 2px;padding-left:10px;display:inline-block;height:100%;vertical-align:middle;">电费</span>
				</li>
				<li class="borderright CheckWater" v-click="changeType('1')" style="font-size:18px;vertical-align:middle;"> 
					<img v-show="fsf" class="imgsf" src="images/sf.png"><img v-hide="fsf" class="imgsf" src="images/sf1.png"><span style="font-size:16px;   padding-top: 2px;padding-left:10px;display:inline-block;height:100%;vertical-align:middle;">水费</span>
				</li>
				<li class="CheckPhone" v-click="changeType('3')" style="font-size:18px;vertical-align:middle;">
					<img v-show="fhf" class="imghf" src="images/hf.png"><img v-hide="fhf" class="imghf" src="images/hf1.png"><span style="font-size:16px;   padding-top: 2px;padding-left:10px;display:inline-block;height:100%;vertical-align:middle;">固话</span>
				</li>
			</ul>
	    </div> 
		<div class="bg_box">
			<div class="box_cont">
				<div class="zz_cont">
					<ul>
<!-- 						<li v-show="ChangePayType==3||PayTypeBool"> -->
<!-- 							<em>缴费名称：</em> -->
<!-- 							<i> -->
<!-- 								{{PayType.Name}} -->
<!-- 							</i> -->
<!-- 						</li> -->
						<li v-show="ChangePayType!=3">
							<em>缴费地区：</em>
							<i>
								{{City.Name}}
							</i>
						</li>
						<li v-show="ChangePayType==1"> 
							<em>水 表 号：</em>
							<i>
								{{WaterPayNo}}
							</i>
						</li>
						<li  v-show="ChangePayType==2"> 
							<em>电费总户号：</em>
							<i>
								{{ElectPayNo}}
							</i>
						</li>
						<li  v-show="ChangePayType==3"> 
							<em>固话号码：</em>
							<i>
								{{PhonePayNo}}
							</i>
						</li>
						<li v-show="PayInfo.custName">
							<em>用户姓名：</em>
							<i>
								{{PayInfo.custName}}
							</i>
						</li>
						
					</ul>
			    </div>
			</div>
		</div>
		<div class="bg_box" v-show="!PayTypeBool&&ChangePayType!=3" v-repeat="item in PayInfoList" v-click="PayNext(item)">
			<div class="box_cont">
				<div class="zz_cont">
				    <div>
			      		<div style="float:left;padding:left;width:45%;padding-left:10px;margin-top:20%;margin-top:3%;">
							<div style="float:left">月 份 ：</div>
							<div style="float:left">
								{{item.month|yymmDate}}
							</div>
						</div>
						<div style="float:left;width:45%">
							<div>
								<div style="float:left">欠费金额：</div>
								<div style="color:#ff6000">
									{{item.arrearage|number:2}}
								</div>
							</div>
							<div>
								<div style="float:left">滞纳金额：</div>
								<div style="color:#ff6000">
									{{item.overdueFine|number:2}}
								</div>
							</div>
						</div>
					</div>
					<div class="xiangq_img" style="margin-top:-2%;"><img src="images/more.png" /></a></div>
			    </div>
			</div>
		</div>
		<div class="bg_box" v-show="!PayTypeBool&&ChangePayType==3" v-click="PayNext(PayInfo)">
			<div class="box_cont">
				<div class="zz_cont">
					<div>
				      	<div style="float:left;padding:left;width:45%;padding-left:10px;margin-top:3%;">
							<div style="float:left">欠费总额：</div>
							<div style="float:left">
								{{PayInfo.totalArrearage}}
							</div>
						</div>
						<div style="float:left;width:45%">
							<div>
								<div style="float:left">总滞纳金 ：</div>
								<div style="color:#ff6000">
									{{PayInfo.totleOverdueFine|number:2}}
								</div>
							</div>
							<div>
								<div style="float:left" >销帐金额 ：</div>
								<div style="color:#ff6000">
									{{PayInfo.writeOffAmt|number:2}}
								</div>
							</div>
						</div>
					</div>
					<div class="xiangq_img" style="margin-top:-2%;"><img src="images/more.png" /></a></div>
			    </div>
			</div>
		</div>
		<div class="bg_box" v-show="PayTypeBool" v-repeat="item in PayInfoList" v-click="PayNext(item)">
			<div class="box_cont">
				<div class="zz_cont">
				      <div>
				      		<div style="float:left;padding:left;width:45%;padding-left:10px;margin-top:3%;">
								<div style="float:left">客户姓名 ：</div>
								<div style="float:left">
									{{item.custName}}
								</div>
							</div>
							<div style="float:left;width:45%">
								<div>
									<div style="float:left">　余　额：</div>
									<div style="color:#ff6000">
										{{item.balance|number:2}}
									</div>
								</div>
								<div>
									<div style="float:left" >应缴金额：</div>
									<div style="color:#ff6000">
										{{item.payAmount|number:2}}
									</div>
								</div>
							</div>
					</div>
					 <div class="xiangq_img"style="margin-top:-2%;"><img src="images/more.png" /></a></div>
			    </div>
			</div>
		</div>
		<div class="bg_box" v-show="PayInfoList==''" style="text-align:center;padding-top:10px;">
			<em class="transtime">查询无欠费记录！</em>
		</div>
	</div>
	<!--3  电费缴费录入-->
	<div v-page v-transition="native">
			<div class="jiaofei">
				<ul>
					<li class="borderright CheckElect" v-click="changeType('2')"  style="font-size:18px;vertical-align:middle;">
						<img v-show="fdf" class="imgdf" src="images/df.png"><img v-hide="fdf" class="imgdf" src="images/df1.png"><span style="font-size:16px;  padding-top: 2px; padding-left:10px;display:inline-block;height:100%;vertical-align:middle;">电费</span>
					</li>
					<li class="borderright CheckWater" v-click="changeType('1')" style="font-size:18px;vertical-align:middle;"> 
						<img v-show="fsf" class="imgsf" src="images/sf.png"><img v-hide="fsf" class="imgsf" src="images/sf1.png"><span style="font-size:16px;  padding-top: 2px; padding-left:10px;display:inline-block;height:100%;vertical-align:middle;">水费</span>
					</li>
					<li class="CheckPhone" v-click="changeType('3')" style="font-size:18px;vertical-align:middle;">
						<img v-show="fhf" class="imghf" src="images/hf.png"><img v-hide="fhf" class="imghf" src="images/hf1.png"><span style="font-size:16px;   padding-top: 2px;padding-left:10px;display:inline-block;height:100%;vertical-align:middle;">固话</span>
					</li>
				</ul>
			  </div> 
		<div class="bg_box">
			<div class="box_cont">
				<div class="zz_cont">
					<ul>
			      		<li>
							<em>付款账号：</em>
							<i>
								<select v-model="AcNo" name="AcNo" v-change="getCardInfo()" v-options="tl.AcNo1 for tl in AcNoList" >
								</select>
							</i>
						</li>
						<li>
							<em>可用余额：</em>
							<i class="colff6" ui-money='{"amounts":"balance"}'></i>
						</li>
						<li  v-show="ChangePayType==2"> 
							<em>电费总户号：</em>
							<i>
								{{ElectPayNo}}
							</i>
						</li>
						<li v-show="ChangePayType==1"> 
							<em>水 表 号：</em>
							<i>
								{{WaterPayNo}}
							</i>
						</li>
						<li v-show="ChangePayType==3"> 
							<em>固话号码：</em>
							<i>
								{{PhonePayNo}}
							</i>
						</li>
						<li v-show="ChangePayType==3&&!PayTypeBool">
							<em>欠费总额：</em>
							<i>
								{{PayDoInfo.totalArrearage|number:2}}
							</i>
						</li>
						<li v-show="ChangePayType==3&&!PayTypeBool">
							<em>总滞纳金 ：</em>
							<i>
								{{PayDoInfo.totleOverdueFine|number:2}}
							</i>
						</li>
						<li v-show="ChangePayType==3&&!PayTypeBool">
							<em>销帐金额 ：</em>
							<i>
								{{PayDoInfo.writeOffAmt|number:2}}
							</i>
						</li>
						<li v-show="ChangePayType!=3&&!PayTypeBool">
							<em>缴费月份：</em>
							<i>
								{{PayDoInfo.month|yymmDate}}
							</i>
						</li>
						<li v-show="ChangePayType!=3&&!PayTypeBool">
							<em>欠费金额：</em>
							<i>
								{{PayDoInfo.arrearage|number:2}}
							</i>
						</li>
						<li v-show="ChangePayType!=3&&!PayTypeBool">
							<em>滞纳金额：</em>
							<i>
								{{PayDoInfo.overdueFine|number:2}}
							</i>
						</li>
						<li v-show="PayTypeBool">
							<em>客户姓名 ：</em>
							<i>
								{{PayDoInfo.custName}}
							</i>
						</li>
						<li v-show="PayTypeBool">
							<em>　余　额：</em>
							<i>
								{{PayDoInfo.balance|number:2}}
							</i>
						</li>
						<li v-show="PayTypeBool">
							<em>欠费金额：</em>
							<i>
								{{PayDoInfo.payAmount|number:2}}
							</i>
						</li>
						<li>
							<em>应缴金额：</em>
							<i>
								<input type="text" placeholder="请输入转账金额" style="color:#ff6000" name="" v-model="amount"  ui-num='{"maxlength":11,"hasDot":true,"tip":"应缴金额"}' class="y_srk" required/>
							</i>
						</li>
					</ul>
					<div>
			     		<input  type="submit"  class="button_1" name="Submit" value="确认" v-click="PayConfirm()"/>
			     	</div>
			    </div>
			</div>
		</div>
	</div>
	<!-- 4 电费缴费确认-->
	<div v-page v-transition="native">
		<div class="jiaofei">
			<ul>
				<li class="borderright CheckElect" v-click="changeType('2')"  style="font-size:18px;vertical-align:middle;">
					<img v-show="fdf" class="imgdf" src="images/df.png"><img v-hide="fdf" class="imgdf" src="images/df1.png"><span style="font-size:16px;  padding-top: 2px; padding-left:10px;display:inline-block;height:100%;vertical-align:middle;">电费</span>
				</li>
				<li class="borderright CheckWater" v-click="changeType('1')" style="font-size:18px;vertical-align:middle;"> 
					<img v-show="fsf" class="imgsf" src="images/sf.png"><img v-hide="fsf" class="imgsf" src="images/sf1.png"><span style="font-size:16px;  padding-top: 2px; padding-left:10px;display:inline-block;height:100%;vertical-align:middle;">水费</span>
				</li>
				<li class="CheckPhone" v-click="changeType('3')" style="font-size:18px;vertical-align:middle;">
					<img v-show="fhf" class="imghf" src="images/hf.png"><img v-hide="fhf" class="imghf" src="images/hf1.png"><span style="font-size:16px;  padding-top: 2px; padding-left:10px;display:inline-block;height:100%;vertical-align:middle;">固话</span>
				</li>
			</ul>
		</div> 
		<div class="bg_box">
			<div class="box_cont">
				<div class="zz_cont">
				      <ul>
				      		<li>
								<em>付款账号：</em>
								<i>
									{{AcNo.AcNo1}}
								</i>
							</li>
<!-- 							<li v-show="ChangePayType==3||PayTypeBool"> -->
<!-- 								<em>缴费名称：</em> -->
<!-- 								<i> -->
<!-- 									{{PayType.Name}} -->
<!-- 								</i> -->
<!-- 							</li> -->
							<li  v-show="ChangePayType==2"> 
								<em>电费总户号：</em>
								<i>
									{{ElectPayNo}}
								</i>
							</li>
							<li v-show="ChangePayType==1"> 
								<em>水 表 号：</em>
								<i>
									{{WaterPayNo}}
								</i>
							</li>
							<li v-show="ChangePayType==3"> 
								<em>固话号码：</em>
								<i>
									{{PhonePayNo}}
								</i>
							</li>
							<li v-show="ChangePayType==3&&!PayTypeBool">
								<em>欠费总额：</em>
								<i>
									{{PayDoInfo.totalArrearage|number:2}}
								</i>
							</li>
							<li v-show="ChangePayType==3&&!PayTypeBool">
								<em>总滞纳金 ：</em>
								<i>
									{{PayDoInfo.totleOverdueFine|number:2}}
								</i>
							</li>
							<li v-show="ChangePayType==3&&!PayTypeBool">
								<em>销帐金额 ：</em>
								<i>
									{{PayDoInfo.writeOffAmt|number:2}}
								</i>
							</li>
							<li v-show="ChangePayType!=3&&!PayTypeBool">
								<em>缴费月份：</em>
								<i>
									{{PayDoInfo.month|yymmDate}}
								</i>
							</li>
							<li v-show="ChangePayType!=3&&!PayTypeBool">
								<em>欠费金额：</em>
								<i>
									{{PayDoInfo.arrearage|number:2}}
								</i>
							</li>
							<li v-show="ChangePayType!=3&&!PayTypeBool">
								<em>滞纳金额：</em>
								<i>
									{{PayDoInfo.overdueFine|number:2}}
								</i>
							</li>
							<li v-show="PayTypeBool">
								<em>客户姓名 ：</em>
								<i>
									{{PayDoInfo.custName}}
								</i>
							</li>
							<li v-show="PayTypeBool">
								<em>　余　额：</em>
								<i>
									{{PayDoInfo.balance|number:2}}
								</i>
							</li>
							<li v-show="PayTypeBool">
								<em>欠费金额：</em>
								<i>
									{{PayDoInfo.payAmount|number:2}}
								</i>
							</li>
							<li>
								<em>应缴金额：</em>
								<i style="color:#ff6000">
									{{tranAmount|number:2}}
								</i>
							</li>
					 </ul>
				<div class="zz_cont">
			   	 	<ul>
						<li>
							<em>验证码：</em>
							<i><input type="tel" name="imgcode" v-model="imgcode" class="y_srk" maxlength=4 placeholder="请输入验证码" style="width:50%"/></i>
							<img id="img" name="img" v-model="img" src="data:image/png;base64,{{TokenImg}}" data-ke-src="data:image/png;base64,{{TokenImg}}"  style="position:relative;left:40%;margin-top:3%" v-click="freshCode('img')">
<!-- 						<img id="img" name="img" v-model="img" src="/pmobile/GenTokenImg.do"  style="position:relative;left:40%;margin-top: 2%" v-click="freshCode('img')"> -->
						</li>
				  	</ul>
		     	</div>
					<div>
			     		<input  type="submit"  class="button_1" name="Submit" value="确认" v-click="PayDo()"/>
			     	</div>
			    </div>
			</div>
		</div>
	</div>
	<!--5缴费结果 -->
	<div v-page v-transition="native" data-back="false">
		<div class="bg_box">
			<div class="box_cont">
				<div class="selected">
					<span><img class="jindu" src="images/u1.png" /></span> <span><img
						class="jindu" src="images/u2.png" /></span> <span><img class="jindu" src="images/u3.png" /></span>
				</div>
				<div class="zz_cont">
					<div v-show="IsReward=='true'" class="maind" style="margin:0px">
						<div class="d1" style="float:left;padding-left:5px;width:20%;padding-top:20px"><img src="images/cg_img.png" style="width:60px;height:60px"/></div>
						<div class="d2" style="float:left;width:50%;height:70px;  padding-top:9%;">
							<div style="  text-align: center;font-size:x-large;color:#0069c9"> 交易成功</div>
							<div class="transtime" style="padding-bottom:0px;padding-top:10px;font-size:inherit;">{{Result.TransDate}}</div>
						</div>
					<div class="d3"  style="padding-top: 25px;float:left;width:20%;margin-left:-3%"><img  v-click="gotoRewardPage()" src="images/img_reward.gif" style="width:100px;height:60px;"/></div>
					</div>
					<div v-hide="IsReward=='true'">
						<div class="d1" style="float:left;padding-left:50px;;width:20%;padding-top:20px"><img src="images/cg_img.png" style="width:60px;height:60px"/></div>
						<div class="d2" style="float:right;width:50%;height:70px;  padding-top:9%;padding-right:30px">
							<div style="  text-align: center;font-size:x-large;color:#0069c9"> 交易成功</div>
							<div class="transtime" style="padding-bottom:0px;padding-top:10px;font-size:inherit;">{{Result.TransDate}}</div>
						</div>
					</div>
					<div class="resultForm">
						<ul>
							<li><em>付款账号：</em><i>{{AcNo.AcNo1}}</i></li>
							<li v-show="ChangePayType=='3'"><em>固话号：</em><i>{{PayInfo.custName}}</i></li>
							<li><em>缴费金额：</em><i style="color:red">{{amount|number:2}}元</i></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!--6缴费名册 -->
	<div class="bg_box" v-page v-transition="native">
	    <div v-show="payeeList.length<=0" class="mingce">
			<ul>
				<li class="center">未搜索到您要查找的收款人的信息</li>
			</ul>
	   	</div>
	   	<div v-repeat="payee in payeeList"  v-click="Checkpayee(payee)">
	   		<div class="j-heightb"></div>
		   	<div class="mingce" >
				<ul>
					<li><em class="f666">{{payee.memo}}</em><i class="f666">&nbsp;</i></li>
					<li class="f18903">{{payee.recordNo}}</li>
					<li class="f2f2f2" v-show="payee.payType==01">水费</li>
					<li class="f2f2f2" v-show="payee.payType==02">电费</li>
					<li class="f2f2f2" v-show="payee.payType==03">固话</li>
				</ul>
			</div>
		</div>
	</div>
</div>
<script>
PLifePayCtrl.$inject = ["$scope","$remote","$targets","$context","$filter"];
function PLifePayCtrl($scope,$remote,$targets,$context,$filter){
	$scope.init=function(){
		$remote.post("/pmobile/TransRewardsQry.do",{"TRANSNAME":"PLifePay"},function(data){
			$scope.IsReward=data.ISREWARD;
		});
		$scope.fl=true;
		$scope.changeType('2');
		$scope.PayTypeBool = false;
		$scope.fdf=true;
		$scope.fsf=true;
		$scope.fhf=true;
	}
	//判断不能为空
	$scope.judje=function(acno){
		if(acno!="" && acno!=undefined){
			$scope.fl=false;
		}else{
			$scope.fl=true;
		}
	}
	//选择缴费类型
	$scope.changeType= function(data){
		$scope.PhonePayNo="";
		$scope.fl=true;
		if($scope.ChangePayType!=data){
			$scope.ChangePayType = data; 
			if($scope.ChangePayType=='1'){
				$scope.PayTypeList=[{"Name":"","Code":""}];
				$scope.PayType = $scope.PayTypeList[0];
				$('.CheckWater').css('color','white');
				$('.CheckElect').css('color','#000000');
				$('.CheckPhone').css('color','#000000');
				$('.CheckWater').css('background-color','#41a3f1');
				$('.CheckPhone').css('background-color','white');
				$('.CheckElect').css('background-color','white');
				$scope.fdf=true;
				$scope.fsf=false;
				$scope.fhf=true;
				$scope.CityList=[{
					"Name":"常熟",
					"Code":"css"
				}];
				$scope.City = $scope.CityList[0];	
				$scope.changeCity();
				$targets("content","#1");
			}else if($scope.ChangePayType=='2'){
				$scope.PayTypeList=[{"Name":"江苏省电费","Code":"025000301"}];
				$scope.PayType = $scope.PayTypeList[0];
				$('.CheckWater').css('color','#000000');
				$('.CheckElect').css('color','white');
				$('.CheckPhone').css('color','#000000');
				$('.CheckElect').css('background-color','#41a3f1');
				$('.CheckPhone').css('background-color','white');
				$('.CheckWater').css('background-color','white');
				$scope.fdf=false;
				$scope.fsf=true;
				$scope.fhf=true;
				$scope.CityList=[{
					"Name":"常熟",
					"Code":"css" 
				},{
					"Name":"南京",
					"Code":"025"
				},{
					"Name":"无锡",
					"Code":"510"
				},{
					"Name":"徐州",
					"Code":"516"
				},{
					"Name":"常州",
					"Code":"519"
				},{
					"Name":"苏州",
					"Code":"512"
				},{
					"Name":"连云港",
					"Code":"518"
				},{
					"Name":"淮安",
					"Code":"517"
				},{
					"Name":"盐城",
					"Code":"515"
				},{
					"Name":"扬州",
					"Code":"514"
				},{
					"Name":"镇江",
					"Code":"511"
				},{
					"Name":"泰州",
					"Code":"523"
				},{
					"Name":"宿迁",
					"Code":"527"
				}];
				$scope.City = $scope.CityList[0];
				$scope.changeCity();
				$targets("content","#1");
			}else if($scope.ChangePayType=='3'){
// 				$scope.PayTypeList=[{
// 					"Name":"全国联通手机充值",
// 					"Code":"755060303"
// 				},{
// 					"Name":"全国电信手机充值",
// 					"Code":"755060302"
// 				},{
// 					"Name":"全国移动手机充值",
// 					"Code":"755060304"
// 				},{
// 					"Name":"常熟电信固话缴费",
// 					"Code":"css"
// 				}];
				$scope.PayTypeBool = false;
// 				$scope.PayType = $scope.PayTypeList[0];
				$('.CheckWater').css('color','#000000');
				$('.CheckElect').css('color','#000000');
				$('.CheckPhone').css('color','white');
				$('.CheckPhone').css('background-color','#41a3f1');
				$('.CheckWater').css('background-color','white');
				$('.CheckElect').css('background-color','white');
				$scope.fdf=true;
				$scope.fsf=true;
				$scope.fhf=false;
// 				$scope.checkPayType();
				$targets("content","#1");
			}
			
		}
	}
	//选择城市列表
	$scope.changeCity = function(){
		//是否选择本地缴费
		if($scope.City.Code == "css"){
			$scope.PayTypeBool = false;
		}else{
			$scope.PayTypeBool = true;
		}
	}
	//选择缴费类型
	$scope.checkPayType = function(){
		if($scope.PayType.Code == "css"){
			$scope.PayTypeBool = false;
		}else{
			$scope.PayTypeBool = true;
		}
	}
	
	//查询缴费信息
	$scope.queryPayInfo = function(){
		if($scope.PhonePayNo){
			if($scope.PhonePayNo.length<8){
				NativeCall.toast("号码位数不正确");
				return false;
			}
		}
		var param={
				"businessType":$scope.PayTypeBool?$scope.PayType.Code:"",
				"CityCode":$scope.City.Code,
				"recordNo":$scope.WaterPayNo,
				"ammeterNo":$scope.ElectPayNo,
				"telephone":$scope.PhonePayNo,
				"ChangePayType":$scope.ChangePayType,
				"PayType":$scope.PayType,
				"pageSize":"5",
				"currentIndex":"1",
		}
		$remote.post("/pmobile/queryPayInfo.do",param,function(data){
			$scope.PayInfo = data
			$scope.PayInfoList = data.List;
			$targets("content","#2");
		});
	}
	
	//详细页面跳转
	$scope.PayNext = function(item){
		$scope.PayDoInfo = item;
		if($scope.ChangePayType!='3'&&!$scope.PayTypeBool){
			$scope.amount = parseFloat($scope.PayDoInfo.arrearage);
		}else if($scope.ChangePayType=='3'&&!$scope.PayTypeBool){
			$scope.amount = parseFloat($scope.PayDoInfo.tranAmount);
		}else{
			$scope.amount = $scope.PayDoInfo.payAmount;
		}
		$remote.post("/pmobile/ActListQry.do",{},function(data){
			if(data.acList.length<=0){
				NativeCall.toast("用户无可用借记卡帐号！");
				return;
			}
			$scope.AcNoList=data.acList;
			var filterFn=$filter("filter");
			$scope.AcNoList=filterFn($scope.AcNoList,function(obj,text){
				if(obj.AcNo != undefined){
					obj.AcNo1=obj.AcNo.substring(0,4)+"****"+ obj.AcNo.substring(obj.AcNo.length-4)
					if(obj.AcAlias.length>4){
						obj.AcNo1=obj.AcNo1+" / "+obj.AcAlias.substring(0,4)+"...";
					}else if(obj.AcAlias.length<=4&&obj.AcAlias.length>0){
						obj.AcNo1=obj.AcNo1+" / "+obj.AcAlias;
					}else{
						obj.AcNo1=obj.AcNo1;
					}
					return true;
				}
			});
			$scope.AcNo = $scope.AcNoList[0];
			$scope.getCardInfo();
			$targets("content","#3");
		});
		
	}
	
	$scope.getCardInfo=function(){
		var cardNo=$scope.AcNo.AcNo;
		//查询余额
		$remote.post("/pmobile/ActBalQry.do",{"AcNo":cardNo},function(data){
			$scope.cardInfo=data;
			$scope.balance=data.AvailBal;
		});
	}
	//缴费确认
	$scope.PayConfirm = function(){
		if(parseFloat($scope.amount)>parseFloat($scope.balance)){
			NativeCall.toast("卡内余额不足！");
			return;
		}
		if($scope.amount==0||$scope.amount==""||$scope.amount==null){
			NativeCall.toast("请输入应缴金额！");
			return;
		}else{
			$scope.tranAmount= $scope.amount;
		}
		var param={
				"ChangePayType":$scope.ChangePayType,
				"accountNo":$scope.AcNo.AcNo,
				"tranAmount":$scope.amount,
				"businessType":$scope.PayTypeBool?$scope.PayType.Code:"",
				"custName":$scope.PayTypeBool?$scope.PayDoInfo.custName:$scope.PayInfo.custName,
				"recordNo":$scope.PayInfo.recordNo,
				"contractNo":$scope.PayDoInfo.contractNo,
				"payAmount":$scope.PayDoInfo.payAmount,
				"month":$scope.PayDoInfo.month,
				"overdueFine":$scope.PayDoInfo.overdueFine,
				"count":$scope.PayDoInfo.count,
				"branchId":$scope.PayDoInfo.branchId,
				"address":$scope.PayDoInfo.address,
				"flag":$scope.PayDoInfo.flag,
				"ammeterNo":$scope.ElectPayNo,
				"balance":$scope.PayInfo.balance,
				"telephone":$scope.PhonePayNo,
				"recordNum":$scope.PayInfo.recordNum,
				"fileName":$scope.PayInfo.fileName,
				"totalArrearage":$scope.PayInfo.totalArrearage,
				"totleOverdueFine":$scope.PayInfo.totleOverdueFine,
				"writeOffAmt":$scope.PayInfo.writeOffAmt,
		}
		$remote.post("/pmobile/PayConfirm.do",param,function(data){
			$scope.PayConfirmList = data;
			$remote.post("/pmobile/GenTokenImg.do",{},function(data){
				$scope.TokenImg=data.imgKey;
			});
			$scope.imgcode = "";
			$targets("content","#4");
			$scope.freshCode('img');
		});
	}
	//缴费名册
	$scope.queryBook = function(type){
		var param={
				"payType":type
		}
		$remote.post("/pmobile/QryPayBook.do",param,function(data){
			$scope.payeeList = data.List;
			$targets("content","#6");
			});
	}
	//选择缴费名册
	$scope.Checkpayee = function(item){
		if(item.payType=="01"){
			$scope.WaterPayNo = item.recordNo;
			$scope.fl=false;
			$targets("content","#1");
		}else if(item.payType=="02"){
			$scope.ElectPayNo = item.recordNo;
			$scope.fl=false;
			$targets("content","#1");
		}else if(item.payType=="03"){
			$scope.PhonePayNo = item.recordNo;
			$scope.fl=false;
			$targets("content","#1");
		}
	}
	//缴费结果
	$scope.PayDo = function(){
		var param={
				"ChangePayType":$scope.ChangePayType,
				"PayType":$scope.PayType,
				"accountNo":$scope.AcNo.AcNo,
				"tranAmount":$scope.amount,
				"businessType":$scope.PayTypeBool?$scope.PayType.Code:"",
				"custName":$scope.PayTypeBool?$scope.PayDoInfo.custName:$scope.PayInfo.custName,
				"recordNo":$scope.PayInfo.recordNo,
				"contractNo":$scope.PayDoInfo.contractNo,
				"payAmount":$scope.PayDoInfo.payAmount,
				"month":$scope.PayDoInfo.month,
				"overdueFine":$scope.PayDoInfo.overdueFine,
				"count":$scope.PayDoInfo.count,
				"branchId":$scope.PayDoInfo.branchId,
				"address":$scope.PayDoInfo.address,
				"flag":$scope.PayDoInfo.flag,
				"ammeterNo":$scope.ElectPayNo,
				"balance":$scope.PayInfo.balance,
				"telephone":$scope.PhonePayNo,
				"recordNum":$scope.PayInfo.recordNum,
				"fileName":$scope.PayInfo.fileName,
				"totalArrearage":$scope.PayInfo.totalArrearage,
				"totleOverdueFine":$scope.PayInfo.totleOverdueFine,
				"writeOffAmt":$scope.PayInfo.writeOffAmt,
				"_tokenName":$scope.PayConfirmList._tokenName,
				"_vTokenName":$scope.imgcode, 
		}
		$remote.post("/pmobile/PayDo.do",param,function(data){
			$scope.Result = data;
			$remote.post("/pmobile/AddPayBook.do",param,function(data){
				});
			$targets("content","#5");
			});
		}
	$scope.freshCode=function(id){
		$scope.img = "";
		$remote.post("/pmobile/GenTokenImg.do?r"+Math.random(),{},function(data){
			$scope.TokenImg=data.imgKey;
		});
	}
	$scope.gotoRewardPage=function(){
		$context.clear();
		$scope.TransName="PLifePay";
		$remote.post("/pmobile/TransRewardsQry.do",{"TRANSNAME":$scope.TransName},function(data){
			if(data.GAMETYPE=="0"){
				var param={
						"ReWardCount":data.REWARDCOUNT,"TransName":data.TRANSNAME,
						"Count":data.COUNT,
						"GameType":data.GAMETYPE,
						"IsReward":data.ISREWARD,
						
						"UpDateTime":data.UPDATETIME
				}
				$context.setJson({"innerParam":param});
				$scope.goto("LotteryDraw");
			}else if(data.GAMETYPE=="2"){
				var param={
						"ReWardCount":data.REWARDCOUNT,"TransName":data.TRANSNAME,
						"Count":data.COUNT,
						"GameType":data.GAMETYPE,
						"IsReward":data.ISREWARD,
						
						"UpDateTime":data.UPDATETIME
				}
				$context.setJson({"innerParam":param});
				$scope.goto("GuaGuaLe");
			}else if(data.GAMETYPE=="3"){
				var param={
						"ReWardCount":data.REWARDCOUNT,"TransName":data.TRANSNAME,
						"Count":data.COUNT,
						"GameType":data.GAMETYPE,
						"IsReward":data.ISREWARD,
						
						"UpDateTime":data.UPDATETIME
				}
				$context.setJson({"innerParam":param});
				$scope.goto("YaoYiYao");
			}
		});
	}
}
</script>
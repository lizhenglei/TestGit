<div v-view-setup="PPayeeBookMgmtCtrl" v-init="init()">
	<div class="bg_box" v-page v-transition="native"
		style="padding-bottom: 0">
		<div class="box_cont">
			<div class="zz_cont"
				style="margin-left: 0px; margin-right: 0px; padding: 0px; width: 100%;">
				<b class="bookTitle" style="padding: 0px; margin: 0px; width: 100%;">
					<li class="inner" id="inner" class="selectTitle"
					v-click="selectTitle('inner')">本行 <!-- 					<img style="float:left;width:30px;margin-top: 5px;margin-left:15px;height:24px" v-show="fhn" class="imghn" src="images/hn.png"><img v-hide="fhn" style="float:left;width:30%;height:24px;margin-top: 5px;margin-left:15px;" class="imghn" src="images/hn1.png"><span class="hn" style="padding-top: 2px;width:50%;height:35px;float:right;line-height:30px;margin-bottom:0px;text-align:left">本行</span> -->
				</li>
					<li class="cross" id="cross" v-click="selectTitle('cross')">
						他行 <!-- 					<img style="float:left;width:30px;margin-top: 5px;  padding-top: 3px;margin-left:15px;height:20px" v-show="fkh" class="imgkh" src="images/kh.png"><img v-hide="fkh" style="padding-top:3px;float:left;width:30%;height:20px;margin-top: 5px;margin-left:15px;" class="imgkh" src="images/kh1.png"><span class="kh" style="padding-top: 2px;width:50%;height:35px;float:right;line-height:30px;margin-bottom:0px;text-align:left">他行</span> -->
				</li>
					<li class="credit" id="credit" v-click="selectTitle('credit')"
					style="border-right: none">信用卡 <!-- 					<img style="float:left;width:30px;margin-top: 5px;  padding-top: 3px;margin-left:15px;height:18px" v-show="fxyk" class="imgxyk" src="images/xyk.png"><img v-hide="fxyk" style="padding-top:3px;float:left;width:30%;height:18px;margin-top: 5px;margin-left:15px;" class="imgxyk" src="images/xyk1.png"><span class="xyk" style="padding-top: 2px;width:50%;height:35px;float:right; line-height:30px;margin-bottom:0px;text-align:left">信用卡</span> -->
				</li>
					<div class="d1"
						style="height: 10px; width: 100%; background: white; float: left;">
						<div class="d3"
							style="height: 2px; width: 7%; background: white; float: left"></div>
						<div class="d2"
							style="height: 2px; width: 20%; background: #0084ff; float: left"></div>
					</div>
				</b>
			</div>
			<div class="zz_cont">
				<ul>
					<li><em> 关键字查询： </em> <i><input type="text"
							name="targetName" v-model="targetName" placeholder="请输入关键字"
							v-change="searchName()" class="y_srk"> <!-- 				<span v-click="searchName()"><img src="images/ss_icon.png" width="6%"></span> -->
					</i></li>
				</ul>
			</div>
			<div class="j-heightb"></div>
			<div class="bcfff1 zczl_cont background1"
				style="text-align: center; padding: 10px 0 10px 0"
				v-click="toAddPayee()">
				<img src="images/tj.png" /><span
					style="font-size: 16px; padding-left: 10px;"><a href="#"
					style="color: #666"> 新增收款人</a></span>
			</div>
			<div class="j-heightb"></div>
		</div>

		<!-- 行内收款人名册 -->
		<div v-show="titleName=='inner'" v-repeat="il in innerList">
			<div class="box_cont">
				<div class="zz_cont">
					<ul>
						<div class="delete" v-click="deletePayee($index,il)">
							<a href=""><img style="width: 13px; height: 16px;"
								src="images/d.png" /></a>
						</div>
						<div class="edit">
							<a href="" v-click="updatePayee(il)"><img
								style="width: 17px; height: 16px;" src="images/xiug_icon.png" /></a>
						</div>
						<li><em>收款人姓名：</em><i>{{il.PayeeAcName}}</i></li>
						<li><em>收款人账号：</em><i>{{il.PayeeAcNo}}</i></li>
						<li><em>别名：</em><i>{{il.AcAlias}}</i></li>
					</ul>


				</div>
			</div>
			<div class="j-heightb"></div>
		</div>
		<!-- 跨行收款人名册 -->
		<div v-show="titleName=='cross'" v-repeat="cl in crossList">
			<div class="box_cont">
				<div class="zz_cont">
					<ul>
						<div class="delete" v-click="deletePayee($index,cl)">
							<a href=""><img src="images/d.png"
								style="width: 13px; height: 16px;" /></a>
						</div>
						<div class="edit">
							<a href="" v-click="updatePayee(cl)"><img
								style="width: 17px; height: 16px;" src="images/xiug_icon.png" /></a>
						</div>
						<li><em>收款人姓名：</em><i>{{cl.PayeeAcName}}</i></li>
						<li><em>收款人账号：</em><i>{{cl.PayeeAcNo}}</i></li>
						<li v-show="cl.QuickPayeeBankName"><em>收款银行：</em><i>{{cl.QuickPayeeBankName}}</i></li>
						<li v-show="cl.NormalPayeeBankName"><em>收款开户行：</em><i
							style="line-height: 20px; padding-top: 10px;">{{cl.NormalPayeeBankName}}</i></li>
						<li><em>别名：</em><i>{{cl.AcAlias}}</i></li>
					</ul>
				</div>
			</div>
			<div class="j-heightb"></div>
		</div>
		<div v-show="titleName=='credit'" v-repeat="cr in creditList">
			<div class="box_cont">
				<div class="zz_cont">
					<ul>
						<div class="delete" v-click="deletePayee($index,cr)">
							<a href=""><img style="width: 13px; height: 16px;"
								src="images/d.png" /></a>
						</div>
						<div class="edit">
							<a href="" v-click="updatePayee(cr)"><img
								style="width: 17px; height: 16px;" src="images/xiug_icon.png" /></a>
						</div>
						<li><em>收款人姓名：</em><i>{{cr.PayeeAcName}}</i></li>
						<li><em>收款人信用卡：</em><i>{{cr.PayeeAcNo}}</i></li>
						<li><em>别名：</em><i>{{cr.AcAlias}}</i></li>
					</ul>
				</div>
			</div>
			<div class="j-heightb"></div>
		</div>
	</div>
</div>
<div v-show="fl" v-model="no" name="no" class="mingce">
	<ul>
		<li class="center">未搜索到您要查找的收款人的信息</li>
	</ul>
</div>
</div>
<script>
PPayeeBookMgmtCtrl.$inject = ["$scope","$remote","$targets","$context"];
function PPayeeBookMgmtCtrl($scope,$remote,$targets,$context){
	$scope.init=function(){
		$scope.fhn=true;
		$scope.fkh=true;
		$scope.fxyk=true;
		$scope.fl=false;
		$scope.selectTitle('inner');
		var typeCode=$context.getJson().transType;
		console.log(typeCode);
		if(typeCode=="0"||typeCode==undefined){
			$('.inner').css('color','#0084ff');
			$('.cross').css('color','black');
			$('.credit').css('color','black');
			$('.d3').css('width','7%');
			$scope.fkh=true;
			$scope.fhn=false;
			$scope.fxyk=true;
		}
		if(typeCode=="1"||typeCode=="6"){
			$('.cross').css('color','#0084ff');
			$('.inner').css('color','black');
			$('.credit').css('color','black');
			$('.d3').css('width','40%');
			$scope.fhn=true;
			$scope.fkh=false;
			$scope.fxyk=true;
		}
		if(typeCode=="5"){
			$('.credit').css('color','#0084ff');
			$('.cross').css('color','black');
			$('.inner').css('color','black');
			$('.d3').css('width','73%');
			$scope.fkh=true;
			$scope.fxyk=false;
			$scope.fhn=true;
		}
		if(typeCode=="1"||typeCode=="6"){
			$scope.titleName='cross';
			$("#cross").addClass("selectTitle").siblings().removeClass("selectTitle");
		}else if(typeCode=="0"){
			$scope.titleName='inner';
			$("#inner").addClass("selectTitle").siblings().removeClass("selectTitle");
		}else if(typeCode=="5"){
			$scope.titleName='credit';
			$("#credit").addClass("selectTitle").siblings().removeClass("selectTitle");
		}
		var params={
				"TransType":0,
				"pageSize":1000,
				"currentIndex":1
		}
		//获取核心客户号
		$remote.post("/pmobile/ActListQry.do",{},function(data){
			$scope.HostCustNo=data.CifNo;
		}); 
		//查询行内收款人
		$remote.post("/pmobile/TransferPayeeListQry.do",params,function(data){
				$scope.innerList=data.List;
				$scope.allInnerList=data.List;
		});
		/* $remote.get("data/InnerTransfer/InnerTransfer.json",params,function(data){
			$scope.innerList=data.List;
			$scope.allInnerList=data.List;
		}); */
		
		//查询跨行收款人
		$remote.post("/pmobile/CrossTransferPayeeListQry.do",{},function(data){
				$scope.crossList=data.List;
				$scope.allCrossList=data.List;
		}); 
		/* $remote.get("data/CrossTransfer/CrossTransfer.json",params,function(data){
				$scope.crossList=data.List;
				$scope.allCrossList=data.List;
		}); */
		//查询行内信用卡收款人
		var params2={
				"TransType":5,
				"pageSize":1000,
				"currentIndex":1
		}
		$remote.post("/pmobile/TransferPayeeListQry.do",params2,function(data){
				$scope.creditList=data.List;
				$scope.allCreditList=data.List;
		});
	}
	//修改收款人信息
	$scope.updatePayee=function(obj){
		obj.HostCustNo=$scope.HostCustNo;
		$context.setJson({"updatePayee":obj});
		$scope.goto("PPayeeBookMgmt","updatePayeeInfo");
	}
	//删除收款人
	$scope.deletePayee=function(index,obj){
		var params={
				"PayeeAcName":obj.PayeeAcName,
				"PayeeAcNo":obj.PayeeAcNo,
				"HostCustNo":$scope.HostCustNo,
				"TransType":obj.TransType,
				"OperationType":3
		}
		$scope.confirm("您确定要删除此信息？",function(){
			$remote.post("/pmobile/PayeeBookManage.do",params,function(data){
				if(data._RejCode=="000000"){
					if($scope.titleName=="inner"){
						$scope.innerList.splice(index,1);
					}else if($scope.titleName=="cross"){
						$scope.crossList.splice(index,1);
					}else if($scope.titleName=="credit"){
						$scope.creditList.splice(index,1);
					}
				}
			})
			
		},function(){
				
		});
	}
	//新增收款人
	$scope.toAddPayee=function(){
		$context.setJson({"HostCustNo":$scope.HostCustNo,"titleName":$scope.titleName});
		$scope.goto("PPayeeBookMgmt","AddPayee");
	}
	//选择页签
	$scope.selectTitle=function(id){
		$scope.fl=false;
		$scope.titleName=id;
		if(id=="inner"){
			$('.inner').css('color','#0084ff');
			$('.cross').css('color','black');
			$('.credit').css('color','black');
			$('.d3').css('width','7%');
			$scope.fkh=true;
			$scope.fhn=false;
			$scope.fxyk=true;
		}
		if(id=="cross"){
			$('.cross').css('color','#0084ff');
			$('.inner').css('color','black');
			$('.credit').css('color','black');
			$('.d3').css('width','40%');
			$scope.fhn=true;
			$scope.fkh=false;
			$scope.fxyk=true;
		}
		if(id=="credit"){
			$('.credit').css('color','#0084ff');
			$('.cross').css('color','black');
			$('.inner').css('color','black');
			$('.d3').css('width','73%');
			$scope.fkh=true;
			$scope.fxyk=false;
			$scope.fhn=true;
		}
		$("#"+id).addClass("selectTitle").siblings().removeClass("selectTitle");
	}
	//搜索收款人姓名
	$scope.searchName=function(){
		$scope.fl=false;
		var tempList,list;
		if($scope.titleName=="inner"){
			tempList=$scope.allInnerList;
		}else if($scope.titleName=="cross"){
			tempList=$scope.allCrossList;
		}else if($scope.titleName="credit"){
			tempList=$scope.allCreditList;
		}
		console.log(tempList);
		if($scope.targetName){
			var temp=[];
			vx.forEach(tempList,function(item){
				if(item.PayeeAcName.indexOf($scope.targetName)>-1||item.PayeeAcNo.indexOf($scope.targetName)>-1||item.AcAlias.indexOf($scope.targetName)>-1){
					temp.push(item);
					$scope.fl=false;
				}
			});
			list=temp;
		}else{
			list=tempList;
		}
		if($scope.titleName=="inner"){
			$scope.innerList=list;
			if($scope.innerList.length==0){
				$scope.fl=true;
			}
		}else if($scope.titleName=="cross"){
			$scope.crossList=list;
			if($scope.crossList.length==0){
				$scope.fl=true;
			}
		}else if($scope.titleName=="credit"){
			$scope.creditList=list;
			if($scope.creditList.length==0){
				$scope.fl=true;
			}
		}
	}
}
</script>
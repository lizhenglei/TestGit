
<div v-view-setup="KHbankCtrl" v-init="init()">
	<div  class="bg_box" v-page v-transition="native">
		<div class="box_cont">
			<div class="zz_cont">
					<ul>
						<li>
							<em>所在省：</em>
							<i>
								<select  v-change="getCity()" v-model="province" name="province" v-options="province.ProvinceName for province in provinceList" >
								</select>
							</i>
						</li>
						<li>
							<em>所在市：</em>
							<i>
								<select v-model="city" name="city" v-options="city.CityName for city in cityList" >
								</select>
							</i>
						</li>
						<li>
							<em>关键字：</em>
							<i class="colff6"> 
								<input type="text"  placeholder="请输入关键字" name="keyWord" v-model="keyWord" class="y_srk"/> 
							</i>
						</li>
					</ul>
			</div>
			<div  class="zz_cont">
			<input type="button" class="button_1" name="button" value="查询开户行" v-click="queryKw()"></div>			
		</div>
	</div>
</div>
			<div class="khh" v-repeat="bank in bankList" v-click="selectBank(bank)">
			      <ul>
						<li><em>银行名称:</em><i>{{bank.BankName}}</i></li>
						<li><em>银行号:</em><i>{{bank.BankNo}}</i></li>
				  </ul>
		    </div>
		    
		    <div v-show="tempList.length==20" class="center" v-click="queryKHH()">
		    	点击查看更多
		    </div>
		    <div style="height:40px;width:100%"></div>
<script>
KHbankCtrl.$inject = ["$scope","$remote","$targets","$context"];
function KHbankCtrl($scope,$remote,$targets,$context){
	$scope.init=function(){
		$scope.cindex=0;
		$scope.comeFrom=$context.getJson().comeFrom;
		//获取省列表
		$remote.post("/pmobile/ProvinceQry.do",{},function(data){
			$scope.provinceList=data.List;
			$scope.province=$scope.provinceList[0];
			$scope.getCity();
		});
	}
	//选定开户行
	$scope.selectBank=function(obj){
		if(obj.ClsBankNo==151000||obj.ClsBankNo==314305506621||obj.BankNo.substr(0,3)==320){
			NativeCall.toast("跨行转账不允许转给本行！");
			return;
		}
		$context.setJson({"selectedKHbank":obj});
		$scope.goto($scope.comeFrom);
	}
	//获取城市列表
	$scope.getCity=function(){
		$remote.post("/pmobile/CityQry.do",{"ProvinceCode":$scope.province.ProvinceCode},function(data){
			$scope.cityList=data.List;
			$scope.city=$scope.cityList[0];
		});
	}
	//由查询按钮触发
	$scope.queryKw=function(){
		$scope.cindex=0;
		$scope.bankList=[];
		$scope.queryKHH();
	}
	
	//查询开户行
	$scope.queryKHH=function(){
		$scope.cindex=$scope.cindex+1;
		$scope.tempList=[];
		var parmas={
				"ProvinceCode":$scope.province.ProvinceCode,
				"CityCode":$scope.city.CityCode,
				"KeyWords":$scope.keyWord,
				"pageSize":20,
				"currentIndex":$scope.cindex
		}
		//查询开户行
		$remote.post("/pmobile/BankNoSameCityQry.do",parmas,function(data){
			if(data._RejCode=="000000"){
				$scope.tempList=data.List;
				$scope.bankList=$scope.bankList.concat($scope.tempList);
			}
		});
	}
}
</script>
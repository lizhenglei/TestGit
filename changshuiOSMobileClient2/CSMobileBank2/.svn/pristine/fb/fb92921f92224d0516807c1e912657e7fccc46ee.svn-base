<div v-view-setup="MyOrderCtrl" v-init="init()">
	<!-- 我的预约查询页面 -->
	<div v-page v-transition="native" title="我的预约">
		<form name="OrderInput" class="bg_box">
			<div class="box_cont">
			<div class="zz_cont">
				
				<ul>
						<li><em>身份证号：</em><i><input type="text" id="IdNo" name="IdNo" v-model="IdNo" class="y_srk" placeholder="请输入身份证号码"/></i></li>
						<li><em>手机号：</em><i><input type="tel" id="MobileNo" name="MobileNo" v-model="MobileNo" class="y_srk" placeholder="请输入手机号"/></i></li>
						<li><em>手机动态码：</em>
							<i>
								<input type="tel" id="SmsCode" name="SmsCode" v-model="SmsCode" maxlength=6  class="y_srk_50" placeholder="请输入动态码"/>
								<button class="inp_butt" v-sms="getDYcode()">获取动态码</button>
							</i>
						</li>
				  </ul>
			</div>
			 <div class="zz_cont">
		     		<input type="submit"  class="button_1" name="Submit" v-disabled="!SmsCode" value="查询" v-click="query()">
		    </div>
			</div>
		</form>
	</div>
	<!-- 查询结果 -->
	<div v-page>
		<div class="creditcard_box">
			<div class="zz_cont">
				<div>
					<img style="top: 30px;left: 280px;height:60px;width:30px;position: absolute;" src="images/chexiao.png" v-click="cancelOrder()"/>
				</div>
				<ul>
							<li><em>预约编号：</em><i>{{OrderSeq}}</i></li>
							<li><em>预约网点：</em><i>{{OrderArea}}</i></li>
							<li><em>办理业务：</em><i>{{work}}</i></li>
							<li v-show="IsHaveAmount"><em>预约金额：</em><i>{{OrderAmount}}元</i></li>
							<li><em>预约日期：</em><i>{{OrderDate}}</i></li>
							<li><em>预约时间：</em><i>{{OrderTime}}</i></li>
				  </ul>
			</div>
		</div>
	</div>
</div>
<script>
MyOrderCtrl.$inject = ["$scope","$remote","$targets","$filter","$context","$timeout","$window"];
function MyOrderCtrl($scope,$remote,$targets,$filter,$context,$timeout,$window){
	$scope.init=function(){
		$scope.OrderSeq=$context.getJson().OrderSeq;
		$scope.OrderArea=$context.getJson().OrderArea;
		$scope.work=$context.getJson().work;
		if($scope.work=="1"){
			$scope.IsHaveAmount=true;
			$scope.OrderAmount=$context.getJson().OrderAmount;
		}
		$scope.OrderDate=$context.getJson().OrderDate;
		$scope.OrderTime=$context.getJson().OrderTime;
		$scope.getClientState(function(response){
			var vxJson = vx.fromJson(response);
			if (vxJson.isLogin == true){
				$timeout(function(){
					$targets("content","#2");
				},100);
			}else{
				
			}
		});
		
	}
	//查询结果
	$scope.query=function(){
		$targets("content","#2");
	}
	//撤销预约
	$scope.cancelOrder=function(){
		$scope.confirm("您确定撤销此预约吗!",function(){
			$remote.post("/pmobile/GeneralOrderCancel.do",{},function(data){
				$scope.alert("撤销成功！");
			});
		},null);
	}
	//获取手机动态码
	$scope.getDYcode=function(){
		$scope.businessName="在线预约";
		var params={
				"BusinessName":$scope.businessName,
				"MobileNo":$scope.MobilePhone,
				"ServiceCode":"PUM001001"
		}
		
		$remote.post("/pmobile/GenTokenName.do",params,function(data){
			$scope.msmNo=data.SerialNo;
		});
	}
}
</script>
<div v-view-setup="PMyAwardCtrl" v-init="init()">
	<div>
			<div class="yhj" v-repeat="card in lt">
				<div class="yhj_top" >
					<span class="left f98973" style="  padding-top: 4%;"><font class="fontsize2">{{card.prizeName}}</font><font class="fontsize1"></font></span>
					<span class="right"><font class="f98973 fontsize4" style="  margin-left: -40%;">{{card.prizeId}}</font>	<span class="fleft" style=" height: 19px; 
					width: 12%; text-align: center;  position: absolute;  border: 1px solid #f18903;  background: #f18903;  color: white;
					 border-radius: 5px;line-height: 18px;"  v-click="password(card)">
					兑奖</span><br/>您于{{card.tranDate}}日获得{{card.prizeGrade}}等奖</span>
				</div>
<!-- 				<div class="yhj_bottom"> -->
<!-- 				</div> -->
			</div>
	</div>
		<div class="zz_cont"><img src="images/ts.png" />
		    <font class="tishi">
				温馨提示</br>
			</font>
				&nbsp;&nbsp;您可查询自己的中奖纪录。</br>
			<div style="font-size:12px; line-height:16px; color:#929292;"> </div>
	   </div>
	   <div style="width:100%;height:40px"></div>
</div>
<script>
PMyAwardCtrl.$inject = ["$scope","$remote","$targets","$filter"];
function PMyAwardCtrl($scope,$remote,$targets,$filter){
	
	//页面初始化
	$scope.init=function(){
		$remote.post("/pmobile/GenTimeStamp.do", {}, function(data) {
			var serviceTime = data._sysDate;
			$scope.nowdate = $scope.formartDate(serviceTime, 0);
			$scope.time = parseFloat($scope.nowdate) + 10000 + "";
			$scope.yy = $scope.time.substr(0, 4);
			$scope.mm = $scope.time.substr(4, 2);
			$scope.dd = $scope.time.substr(6, 2);
			$scope.time = $scope.yy + "-" + $scope.mm + "-" + $scope.dd;
		});
		$scope.getClientState(function(response){
			var resJson=vx.fromJson(response);
			$scope.userType=resJson.Userinfo.CifNo;
			$scope.idNo=resJson.Userinfo.IdNo;
			$scope.mobileNo=resJson.Userinfo.MobileNo;
			$scope.idType=resJson.Userinfo.IdType;
			$remote.post("/pmobile/TransRewardsResultQry.do", {"clientNo":$scope.userType,"currentIndex":"1","pageSize":"20"}, function(data) {
				console.log(data);
				$scope.lt=data.List;
				if($scope.lt){
					var filterFn=$filter("filter");
					$scope.lt=filterFn($scope.lt,function(obj,text){
						if(obj.tranDate != undefined){
							obj.tranDate=obj.tranDate.substr(0,4)+"-"+ obj.tranDate.substr(4,2)+"-"+obj.tranDate.substr(6,2);
							if(obj.prizeGrade == "1"){
								obj.prizeGrade="一"
							}
							if(obj.prizeGrade == "2"){
								obj.prizeGrade="二"
							}
							if(obj.prizeGrade == "3"){
								obj.prizeGrade="三"
							}
							return true;
						}
					});
				}
			})
		});
		
 	}
	$scope.password=function(obj){
		$remote.post("/pmobile/TransRewardsPasswordQry.do", {"clientNo":$scope.userType,"prizeId":obj.prizeId,"mobileNo":$scope.mobileNo,"idNo":$scope.idNo,"idType":$scope.idType}, function(data) {
			alert(data);
			var i=$scope.mobileNo.substr(0,3)+'****'+$scope.mobileNo.substr(7,4);
			$scope.alert("兑奖密码已通过短信发送到"+i+"的手机上，请注意查收！");
		})
	}
	
	//跳转到确认页面

}
</script>
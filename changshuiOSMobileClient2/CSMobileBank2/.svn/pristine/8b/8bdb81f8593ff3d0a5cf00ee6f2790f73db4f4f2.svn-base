<div v-view-setup="TianTianLiRansomCtrl" v-init="init()">
	<!-- 天天利赎回申请录入页面 -->
	<div v-page v-transition="native" title="理财产品赎回">
		<form  name="transInput" class="bg_box">
			<div class="box_cont">
	
				<div class="selected">
					<span><img class="jindu" src="images/u1.png" /></span> 
					<span><img class="jindu" src="images/u2_1.png" /></span> 
					<span><img class="jindu" src="images/u3_1.png" /></span>
				</div>
				<div class="zz_cont">
					<ul>
						<li>
							<em>账号：</em>
							<i>
								{{ttlPro.AcNo}}
							</i>
						</li>
						<li>
							<em>产品名称：</em>
							<i>
								{{ttlPro.PrdctNm}}
							</i>
						</li>
						<li>
							<em>产品类型：</em>
							<i>
								{{ttlPro.PrdctCd}}
							</i>
						</li>
<!-- 						<li> -->
<!-- 							<em>预期年化收益率：</em> -->
<!-- 							<i> -->
<!-- 								{{ttlPro.rtnRate}} -->
<!-- 							</i> -->
<!-- 						</li> -->
						<li>
							<em>持有金额：</em>
							<i>
								{{ttlPro.FndPrdctLot|number:2}}
							</i>
						</li>
						<li>
							<em>赎回金额：</em>
							<i class="colff6">
								<input type="text" placeholder="请输入赎回金额" name="amount" v-model="amount"  ui-num='{"maxlength":11,"hasDot":true,"tip":"赎回金额"}' class="y_srk" required>
							</i>
						</li>
					</ul>
				</div>
				<div class="zz_cont">
					<input type="button" class="button_1" name="button" value="确认"  v-click="toConfirm()">
				</div>
			</div>
		</form>
		<div class="zz_cont"><img src="images/ts.png" />
		    <font class="tishi">
				温馨提示</br>
			</font>
				&nbsp;&nbsp;1、您可以部分或全额赎回您持有的天天利理财产品。</br>
				&nbsp;&nbsp;2、赎回金额与已申请赎回金额不得大于持有金额。 </br>
<!-- 				&nbsp;&nbsp;3、已申请赎回金额***元,赎回金额最低***元,累加金额为{{ttlPro.buyAddAmt}}的整数倍,单笔最高为{{ttlPro.singleBuyLimit}}元。</br> -->
			<div style="font-size:12px; line-height:16px; color:#929292;"> </div>
	   </div>
	</div>
	
	<!--天天利赎回申请确认页面 -->
	<div v-page v-transition="native" title="理财产品赎回">
		 <form name="transConfirm" class="bg_box">
		    <div class="box_cont">
		      <div class="selected">
		        <span><img class="jindu" src="images/u1.png" /></span>
		         <span><img class="jindu" src="images/u2.png" /></span>
		          <span><img class="jindu" src="images/u3_1.png" /></span>
		      </div>
		     <div class="zz_cont">
					<ul>
						<li>
							<em>账号：</em>
							<i>
								{{ttlPro.AcNo}}
							</i>
						</li>
						<li>
							<em>产品名称：</em>
							<i>
								{{ttlPro.PrdctNm}}
							</i>
						</li>
						<li>
							<em>产品代码：</em>
							<i>
								{{ttlPro.PrdctCd}}
							</i>
						</li>
<!-- 						<li> -->
<!-- 							<em>预期年化收益率：</em> -->
<!-- 							<i> -->
<!-- 								{{ttlPro.rtnRate|FloatTwo}} -->
<!-- 							</i> -->
<!-- 						</li> -->
						<li>
							<em>持有金额：</em>
							<i>
							{{ttlPro.FndPrdctLot|number:2}}
							</i>
						</li>
						<li>
							<em>赎回金额：</em>
							<i class="colff6">
								{{amount|number:2}}
							</i>
						</li>
					</ul>
				</div>
		       <div class="zz_cont">
			      <ul>
						<li>
							<em>验证码：</em>
							<i><input type="tel" name="imgcode" v-model="imgcode" class="y_srk" maxlength=4 placeholder="请输入验证码" style="width:50%"/></i>
							<img id="img" name="img" v-model="img" src="data:image/png;base64,{{TokenImg}}" data-ke-src="data:image/png;base64,{{TokenImg}}" style="position:relative;left:40%;margin-top:3%" v-click="freshCode('img')">
<!-- 							<img id="img" name="img" v-model="img" src="/pmobile/GenTokenImg.do?1" style="position:relative;left:40%" v-click="freshCode('img')"> -->
						</li>
				  </ul>
		     	</div>
		     	<div>
		     		<input type="submit"  class="button_1" name="Submit" value="确认" v-click="toResult('img')">
		     	</div>
		 </div>
		 </form>
	</div>
	
	
	<!-- 天天利赎回申请结果页面 -->
	<div v-page v-transition="native" data-back="false" title="理财产品赎回">
		<div class="bg_box">
		    <div class="box_cont">
			      <div class="selected">
			        <span><img class="jindu" src="images/u1.png" /></span>
			        <span><img class="jindu" src="images/u2.png" /></span>
			        <span><img class="jindu" src="images/u3.png" /></span>
			      </div>
				  <div class="zz_cont bor_bott">
			       <div v-show="IsReward=='true'" class="maind" style="margin:0px">
						<div class="d1" style="float:left;padding-left:5px;width:20%;padding-top:20px"><img src="images/cg_img.png" style="width:60px;height:60px"/></div>
						<div class="d2" style="float:left;width:50%;height:70px;  padding-top:9%;">
							 <div style="  text-align: center;font-size:x-large;color:#0069c9"> 交易成功</div>
							<div class="transtime" style="padding-bottom:0px;padding-top:10px;font-size:inherit;">{{resultData.TransDate}}</div>
						</div>
						<div class="d3"  style="padding-top: 25px;float:left;width:20%;margin-left:-3%"><img  v-click="gotoRewardPage()" src="images/img_reward.gif" style="width:100px;height:60px;"/></div>
					</div>
					<div v-hide="IsReward=='true'">
						<div class="d1" style="float:left;padding-left:50px;;width:20%;padding-top:20px"><img src="images/cg_img.png" style="width:60px;height:60px"/></div>
						<div class="d2" style="float:right;width:50%;height:70px;  padding-top:9%;padding-right:30px">
							 <div style="  text-align: center;font-size:x-large;color:#0069c9"> 交易成功</div>
							<div class="transtime" style="padding-bottom:0px;padding-top:10px;font-size:inherit;">{{resultData.TransDate}}</div>
						</div>
					</div>
<!-- 				     <div class="cc_img"><img src="images/cg_img.png" style="width:120px;height:120px" /></div> -->
<!-- 				     <div class="transtime">{{resultData.TransDate}}</div> -->
				  </div>
		 	</div>
 		<div class="transtime">您已成功赎回天天利理财产品:</div><div class="transtime" style="  color: #ff6000">{{amount|number:2}}元</div>
 		</div>
	</div>
</div>
<script>
TianTianLiRansomCtrl.$inject = ["$scope","$remote","$targets","$filter","$context"];
function TianTianLiRansomCtrl($scope,$remote,$targets,$filter,$context){
	$scope.init=function(){
		$remote.post("/pmobile/TransRewardsQry.do",{"TRANSNAME":"PMyPrd"},function(data){
			$scope.IsReward=data.ISREWARD;
		});
		$scope.ttlPro=$context.getJson().selectedTTL;
		
		console.log($scope.ttlPro);
	}
	//跳转到确认页面
	$scope.toConfirm=function(){
		//如果赎回的天天利存在个人最小购买单位
		if(parseFloat($scope.ttlPro.PrsnMinPrchUnit)>0){
			if((parseFloat($scope.ttlPro.FndPrdctLot)-parseFloat($scope.amount)<parseFloat($scope.ttlPro.PrsnMinPrchUnit))&&(parseFloat($scope.ttlPro.FndPrdctLot)!=parseFloat($scope.amount))){
				NativeCall.toast("个人持有份额不能小于"+$scope.ttlPro.PrsnMinPrchUnit);
				return false;
			}
		}
		if(parseFloat($scope.amount)>parseFloat($scope.ttlPro.balance)){
			NativeCall.toast("持有份额不足");
			//alert("持有份额不足");
			return false;
		}else{
			$scope.freshCode('img');
			$targets("content","#2");
		}
// 		else if(parseFloat($scope.ttlPro.singleBuyLimit) && parseFloat($scope.amount)>parseFloat($scope.ttlPro.singleBuyLimit)){
// 			NativeCall.toast("单笔最高不能超过"+$scope.ttlPro.singleBuyLimit+"元");
// 			//alert("单笔最高不能超过"+$scope.ttlPro.singleBuyLimit+"元");
// 		}else if(parseFloat($scope.ttlPro.buyAddAmt) && parseFloat($scope.amount)%parseFloat($scope.ttlPro.buyAddAmt)!=0){
// 			//alert("累加金额应为"+$scope.ttlPro.buyAddAmt+"的整数倍");
// 			NativeCall.toast("累加金额应为"+$scope.ttlPro.buyAddAmt+"的整数倍");
// 		}
	}
	//跳转到抽奖页面
	$scope.gotoRewardPage=function(){
		$context.clear();
		$scope.TransName="PMyPrd";
		$remote.post("/pmobile/TransRewardsQry.do",{"TRANSNAME":$scope.TransName},function(data){
			if(data.GAMETYPE=="0"){
				var param={
						"ReWardCount":data.REWARDCOUNT,
						"Count":data.COUNT,
						"GameType":data.GAMETYPE,
						"IsReward":data.ISREWARD,
						"TransName":data.TRANSNAME,
						"UpDateTime":data.UPDATETIME
				}
				$context.setJson({"innerParam":param});
				$scope.goto("LotteryDraw");
			}else if(data.GAMETYPE=="2"){
				var param={
						"ReWardCount":data.REWARDCOUNT,
						"Count":data.COUNT,
						"GameType":data.GAMETYPE,
						"IsReward":data.ISREWARD,
						"TransName":data.TRANSNAME,
						"UpDateTime":data.UPDATETIME
				}
				$context.setJson({"innerParam":param});
				$scope.goto("GuaGuaLe");
			}else if(data.GAMETYPE=="3"){
				var param={
						"ReWardCount":data.REWARDCOUNT,
						"Count":data.COUNT,
						"GameType":data.GAMETYPE,
						"IsReward":data.ISREWARD,
						"TransName":data.TRANSNAME,
						"UpDateTime":data.UPDATETIME
				}
				$context.setJson({"innerParam":param});
				$scope.goto("YaoYiYao");
			}
		});
	}
	//刷新验证码
	$scope.freshCode=function(id){
		$remote.post("/pmobile/GenTokenImg.do?r"+Math.random(),{},function(data){
			$scope.TokenImg=data.imgKey;
		});
	}
	//跳转到结果页
	$scope.toResult=function(id){
// 		$remote.post("/pmobile/TransRewardsQry.do",{"TRANSNAME":"PMyPrd"},function(data){
// 			$scope.IsReward=data.ISREWARD;
// 		});
		
		var params={
				"accountNo":$scope.ttlPro.AstAcctNo,
				"prdCode":$scope.ttlPro.PrdctCd,
				"tranAmount":$scope.amount,
				"_vTokenName":$scope.imgcode
		}
		$remote.post("/pmobile/QueryTTLShInfoNew.do",params,function(data){
			$scope.resultData=data;
			$targets("content","#3");
		},function(data){ 
			if(data.jsonError){
				$scope.alert(data.jsonError);
			}
			$scope.freshCode(id);
			return data.jsonError;
		});
	}
}
</script>
<div v-view-setup="PPubCtrl" v-init="init()">
	<div v-page v-transition="native" title="我要提款" style="background-color:white">
				<div class="zz_cont">
					<ul>
						<li><em>付款账号：</em> <i>
								<select v-change="getCardInfo()"
								v-model="payCard" name="payCard"
								v-options="ac.AcNo1 for ac in acList">
							</select> </i></li>
						<li><em>可用余额：</em> <i class="colff6"
							ui-money='{"amounts":"balance"}'></i></li>
							<input class="butn1" style="border: 1px solid #f18903;margin-right: 15%;margin-left: 20%;background-color:#f18903;color:#fff;width:55px;border-radius: 5px;" type="button"   value="评手气"  v-click="changesele(2)">
							<input class="butn2" style="border: 1px solid #f18903;color:#f18903;width:55px;  background-color: white; border-radius: 5px;" type="button"   value="普通"  v-click="changesele(1)">
							<li><em>红包个数：</em> <i><input type="text"
						placeholder="请输入提款金额" name="amount1" v-model="amount1" class="y_srk"></i></li>
							<li><em>红包金额：</em> <i><input type="text"
						placeholder="请输入提款金额" name="amount2" v-model="amount2" class="y_srk"></i></li>
							<li><em>手机动态码：</em>
							<i> <input type="tel" id="dycode" name="dycode"
								v-model="dycode"  maxlength=6
								class="y_srk_50" placeholder="请输入动态码" />
								<button id="anniu" class="inp_butt" v-sms="getDYcode()">获取动态码</button>
						</i></li>
					</ul>
				</div>
				<div class="zz_cont" style="background-color:white">
					<input type="button" class="button_1" name="button" value="微信好友"  v-click="tohaoyou()">
					<input type="button" class="button_1" name="button" value="朋友圈"  v-click="toConfirm()">
				</div>
	</div>
</div>
<script>
PPubCtrl.$inject = [ "$scope", "$remote", "$targets", "$filter",
			"$context" ];
	function PPubCtrl($scope, $remote, $targets, $filter, $context) {
		$scope.init = function() {
			$remote.post("/pmobile/ActListQry.do",{},function(data){
				//过滤器json添加一个acno1的字段，这里写麻烦了 可以用循环写
				$scope.acList=data.PayerList;
				console.log($scope.acList);
				var filterFn=$filter("filter");
				$scope.acList=filterFn($scope.acList,function(obj,text){
					if(obj.AcNo != undefined){
						obj.AcNo1=obj.AcNo.substring(0,4)+"****"+ obj.AcNo.substring(obj.AcNo.length-4);
						obj.AcNo2=obj.AcNo1;
						if(obj.AcAlias.length>4){
							obj.AcNo1=obj.AcNo1+" / "+obj.AcAlias.substring(0,4)+"...";
						}else if(obj.AcAlias.length<=4&&obj.AcAlias.length>0){
							obj.AcNo1=obj.AcNo1+" / "+obj.AcAlias;
						}else{
							obj.AcNo1=obj.AcNo1;
						}
						if($scope.innerParam){
							if($scope.innerParam.payCardAcNo==obj.AcNo){
								$scope.payCard=obj;
							}
						}else{
							var f=$context.getJson().toselectAcNo;//传送过来点击中的信用卡的卡号
							if(f){
								//在打开页面显示点击的信用卡卡号
								if(f==obj.AcNo){
									$scope.payCard=obj;
								}
							}
						}
						return true;
					}
				});
				$scope.mobileNo=data.MobilePhone;
				if(vx.isEmpty($scope.payCard)){
					$scope.payCard=$scope.acList[0];
				}
				$scope.getCardInfo();
				
			});
			$scope.changesele(2);
		}
		$scope.getCardInfo=function(){
			var cardNo=$scope.payCard.AcNo;
			//查询余额
			$remote.post("/pmobile/ActBalQry.do",{"AcNo":cardNo},function(data){
				$scope.cardInfo=data;
				$scope.balance=data.AvailBal;
			});
			//转给本人时，过滤掉当前选中的付款账号
			if($scope.acList){
				var temp=[];
				vx.forEach($scope.acList,function(item){
					if($scope.payCard.AcNo!=item.AcNo){
						temp.push(item);
					}
				});
				$scope.rAcList=temp;
				if($scope.rAcList){
					$scope.selfRCard=$scope.rAcList[0];
				}
			}
		}
		$scope.getDYcode=function(){
			//行内他人、行内本人、手机号
			$scope.businessName="发送红包";
			var params={
					"BusinessName":$scope.businessName,
					"MobileNo":$scope.mobileNo,
					"ServiceCode":"HBA000001"
			}
			//获取手机动态码
			$remote.post("/pmobile/GenTokenName.do",params,function(data){
				$scope.msmNo=data.SerialNo;
			});
		}
		$scope.changesele=function(id){
			if(id=="1"){
				$scope.type="1";
				$(".butn2").css('color','#fff');
				$(".butn1").css('color','#f18903');
				$(".butn2").css('background-color','#f18903');
				$(".butn1").css('background-color','#fff');
			}
			if(id=="2"){
				$scope.type="2";
				$(".butn1").css('color','#fff');
				$(".butn2").css('color','#f18903');
				$(".butn1").css('background-color','#f18903');
				$(".butn2").css('background-color','#fff');
			}
		}
		$scope.tohaoyou=function(){
			$scope.amount=$scope.amount1*$scope.amount2;
			console.log($scope.amount);
			var params={
					"accountNo":$scope.payCard.AcNo,
					"count":$scope.amount1,
					"tranAmount":$scope.amount,
					"amount":$scope.amount2,
					"type":"1",
					"mode":$scope.type
			}
// 			$remote.post("/pmobile/SmsCodeValidate.do",{"SmsCode":$scope.dycode,"SerialNo":$scope.msmNo},function(data){
				$remote.post("/pmobile/GetOutHB.do",params,function(data){
					
				});
// 			});
		}
	}
</script>
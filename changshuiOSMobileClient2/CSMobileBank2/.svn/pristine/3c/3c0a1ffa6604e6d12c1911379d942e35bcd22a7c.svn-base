<div v-view-setup="jzlcdetailCtrl" v-init="init()">
	<div class="background" v-page v-transition="native" title="我要提款">
		<div class="zz_cont">
					<ul>
						<li><em>付款账号：</em> <i>
								<select v-change="getCardInfo()"
								v-model="payCard" name="payCard"
								v-options="ac.AcNo1 for ac in acList">
							</select> </i></li>
						
					<li>
							<em>开始日期：</em>
							<i>
								<input type="text" name="beginDate" placeholder="请选择开始日期" v-model="beginDate" ui-calendar='{"maxView":3,"todayBtn":1,"minView":2,"autoclose": true,"format": "yyyy-mm-dd"}' class="y_srk" readonly>
							</i>
						</li>
						<li>
							<em>结束日期：</em>
							<i>
								<input type="text" name="endDate" placeholder="请选择结束日期" v-model="endDate" ui-calendar='{"maxView":3,"todayBtn":1,"minView":2,"autoclose": true,"format": "yyyy-mm-dd"}' class="y_srk" readonly>
							</i>
					</li>
					</ul>
		</div>
<!-- 		<div class="zz_cont" style="background-color:white"> -->
			
<!-- 		</div> -->
		<div style="width: 95%; padding-left: 5%;background-color: white;">
			<div style="width: 97%">
				<canvas id="canvas"></canvas>
			</div>
		</div>
	</div>
</div>
<script>
jzlcdetailCtrl.$inject = [ "$scope", "$remote", "$targets", "$filter",
			"$context","$chartService"];
	function jzlcdetailCtrl($scope, $remote, $targets, $filter, $context,$chartService ) {
		$scope.init = function() {
			$remote.post("/pmobile/GenTimeStamp.do",{},function(data){
				var serviceTime=data._sysDate;
				$scope.beginDate=$scope.formartDate(serviceTime,-7,"-");
				$scope.endDate=$scope.formartDate(serviceTime,0,"-");
			});
			$scope.jzlc=$context.getJson().jzlc;
			console.log($scope.jzlc);
			$remote.post("/pmobile/ActListQry.do",{},function(data){
				//过滤器json添加一个acno1的字段，这里写麻烦了 可以用循环写
				$scope.acList=data.PayerList;
				console.log($scope.acList);
				var filterFn=$filter("filter");
				$scope.acList=filterFn($scope.acList,function(obj,text){
					if(obj.AcNo != undefined){
						obj.AcNo1=obj.AcNo.substring(0,4)+"****"+ obj.AcNo.substring(obj.AcNo.length-4);
						obj.AcNo2=obj.AcNo1;
						if(obj.AcAlias.length>4){
							obj.AcNo1=obj.AcNo1+" / "+obj.AcAlias.substring(0,4)+"...";
						}else if(obj.AcAlias.length<=4&&obj.AcAlias.length>0){
							obj.AcNo1=obj.AcNo1+" / "+obj.AcAlias;
						}else{
							obj.AcNo1=obj.AcNo1;
						}
						if($scope.innerParam){
							if($scope.innerParam.payCardAcNo==obj.AcNo){
								$scope.payCard=obj;
							}
						}else{
							var f=$context.getJson().toselectAcNo;//传送过来点击中的信用卡的卡号
							if(f){
								//在打开页面显示点击的信用卡卡号
								if(f==obj.AcNo){
									$scope.payCard=obj;
								}
							}
						}
						return true;
					}
				});
				$scope.mobileNo=data.MobilePhone;
				if(vx.isEmpty($scope.payCard)){
					$scope.payCard=$scope.acList[0];
				}
				$scope.getCardInfo();
			});
// 			var pa={
// 					"TACd":$scope.jzlc.rdctCd,
// 					"PrdctCd":$scope.jzlc.PrdctCd,
// 					"BegDt":"20150221",
// 					"EndDt":"20150222",
// 			}
// 			$remote.post("/pmobile/LsjzQuery.do",{},function(data){
				
// 			});
			tempList={2: "3.5000", 3: "4.2200", 4: "4.1900", 5: "4.1700", 6: "4.2200", 7: "4.2200", 8: "4.2200", 9: "4.2200", 10: "3.7200", 11: "4.2200", 12: "4.2200", 13: "4.2200", 14: "4.2200", 15: "4.2200", 16: "4.2200", 17: "4.2200"}
			var params={
					"data":tempList,//数据源
					"pointDot":false,//是否显示节点
					"pointDotRadius":4,//节点大小-半径
					"scaleStartValue":3.5,//Y轴起始值
					"scaleSteps":4,//Y轴刻度个数
					"scaleStepWidth":0.2,//Y轴跨度
					"tooltipFillColor":"#008aff",//标注背景色
					"showTooltips":false,//点击显示标注
					"fillColor":"#d8edf4",//阴影填充色
					"strokeColor" : "#008aff",//曲线颜色
					"pointColor" : "yellow",//节点颜色
					"pointStrokeColor" : "#008aff",//节点边框颜色
					"pointHighlightFill" : "green",//选中节点颜色
					"pointHighlightStroke" : "blue",//选中节点边框颜色
					"widther" : "5px",
			};
			$chartService.line(document.getElementById("canvas"), params); 
		}
		$scope.getCardInfo=function(){
			var cardNo=$scope.payCard.AcNo;
			//查询余额
			$remote.post("/pmobile/ActBalQry.do",{"AcNo":cardNo},function(data){
				$scope.cardInfo=data;
				$scope.balance=data.AvailBal;
			});
			//转给本人时，过滤掉当前选中的付款账号
			if($scope.acList){
				var temp=[];
				vx.forEach($scope.acList,function(item){
					if($scope.payCard.AcNo!=item.AcNo){
						temp.push(item);
					}
				});
				$scope.rAcList=temp;
				if($scope.rAcList){
					$scope.selfRCard=$scope.rAcList[0];
				}
			}
		}
	}
</script>
<div v-view-setup="SpecialBusinessApplyCtrl" v-init="init()">
	<div style="padding-bottom:0" v-page v-transition="native">
			<div class="creditcard_box">
			<div class="zz_cont">
				
				<ul id="detailInfo">
						<li><em>申请人：</em><i><input type="text" id="ApplyName" name="ApplyName" v-model="ApplyName" class="y_srk" placeholder="请输入申请人名称"/></i></li>
						<li><em>商铺名称：</em><i><input type="text" id="ShopName" name="ShopName" v-model="ShopName" class="y_srk" placeholder="请输入商铺名称"/></i></li>
						<li><em>工商注册号：</em><i><input type="text" id="GSRegisterNo" name="GSRegisterNo" v-model="GSRegisterNo" class="y_srk" placeholder="请输入工商注册号"/></i></li>
						<li><em>所在省份：</em><i>
						<select  v-change="getCity()" v-model="province" name="province" v-options="province.ProvinceName for province in provinceList" >
								</select>
						</i></li>
						<li><em>所在城市：</em><i>
						<select v-model="city" name="city" v-options="city.CityName for city in cityList" >
								</select>
						</i></li>
						<li><em>县/地区：</em><i>
						<input type="text" id="Area" name="Area" v-model="Area" class="y_srk" placeholder="请输入县/地区"/>
						</i></li>	
						<li><em>镇/街道：</em><i>
						<input type="text" id="Street" name="Street" v-model="Street" class="y_srk" placeholder="请输入镇/街道"/>
						</i></li>		
						<li><em>详细地址：</em><i><input type="text" id="DetailAddr" name="DetailAddr" v-model="DetailAddr" class="y_srk" placeholder="请输入详细地址"/></i></li>
						<li><em>商户介绍：</em><i><input type="text" id="ShopIntroduce" name="ShopIntroduce" v-model="ShopIntroduce" class="y_srk" placeholder="请输入商户介绍"/></i></li>
						<li><em>手机号码：</em>
							<i class="colff6">
								<input type="text" placeholder="请输入手机号" name="MobilePhone" v-model="MobilePhone"  ui-num='{"maxlength":11,"hasDot":true}' class="y_srk">
							</i></li>
						<li><em>手机动态码：</em>
							<i>
								<input type="tel" id="SmsCode" name="SmsCode" v-model="SmsCode" maxlength=6 class="y_srk_50" placeholder="请输入动态码"/>
								<button class="inp_butt" v-sms="getDYcode()">获取验证码</button>
							</i></li>
				  </ul>
			</div>
			 <div class="zz_cont">
		     		<input type="submit"  class="button_1" name="Submit" v-disabled="!SmsCode" value="确认" v-click="toResult()">
		    </div>
</div>
	</div>
</div>
<script>
SpecialBusinessApplyCtrl.$inject = ["$scope","$remote","$targets","$context"];
function SpecialBusinessApplyCtrl($scope,$remote,$targets,$context){
	$scope.init=function(){
		//获取省列表
		$remote.post("/pmobile/ProvinceQry.do",{},function(data){
			$scope.provinceList=data.List;
			$scope.province=$scope.provinceList[0];
			$scope.getCity();
		});
	}
	//获取城市列表
	$scope.getCity=function(){
		$remote.post("/pmobile/CityQry.do",{"ProvinceCode":$scope.province.ProvinceCode},function(data){
			$scope.cityList=data.List;
			$scope.city=$scope.cityList[0];
		});
	}
	
	$scope.getDYcode=function(){
// 		$scope.getClientState(function(response){
// 		var resJson=vx.fromJson(response);
// 		var mobileNo=resJson.Userinfo.MobileNo;
		
		$scope.businessName="商户合作申请";
		var params={
				"BusinessName":$scope.businessName,
				"MobileNo":$scope.MobilePhone,
		}
		//获取手机动态码
		$remote.post("/pmobile/GenTokenName.do",params,function(data){
			$scope.msmNo=data.SerialNo;
		});
// 	});
	}
	
	$scope.toResult=function(){
		$remote.post("/pmobile/getNewTokenName.do",{},function(data){
			var tokenName=data._tokenName;
			var params={
					"ApplyName":$scope.ApplyName,
					"ShopName":$scope.ShopName,
					"GSRegisterNo":$scope.GSRegisterNo,
					"Province":$scope.province.ProvinceName,
					"City":$scope.city.CityName,
					"Area":$scope.Area,
					"Street":$scope.Street,
					"DetailAddr":$scope.DetailAddr,
					"ShopIntroduce":$scope.ShopIntroduce,
					"MobilePhone":$scope.MobilePhone,
					"SerialNo":$scope.msmNo,
					"SmsCode":$scope.SmsCode,
					"_tokenName":tokenName
			};
			$remote.post("/pmobile/SpecialBusinessApply.do",params,function(data){
				if(data._RejCode=="000000"){
					$scope.alert("商户合作申请成功！");
					NativeCall.goBack();
				}
			});
		});
	}
	
}
</script>
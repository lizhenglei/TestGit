<div v-view-setup="PRiskAssessCtrl" v-init="init()">
	<!-- 风险评估查询页 -->
	<div v-page v-transition="native" title="风险评估">
		<div class="bg_box">
			<div class="box_cont">
				<div class="zz_cont">
					<ul>
						<li>
							<em>评估账号：</em>
							<i>
								<select  v-model="payCard" name="payCard" v-options="ac.AcNo for ac in acList" >
									
								</select>
							</i>
						</li>
					</ul>
				</div>
				<div>
					<input type="button" class="button_1" name="button" value="查询"  v-click="toQueryRisk()">
				</div>
			</div>
		</div>
		<div class="zz_cont"><img src="images/ts.png" />
		    <font class="tishi">
				温馨提示</br>
			</font>
				&nbsp;&nbsp;1、向本行第一次申请任何理财投资产品前，请填写本问卷。</br>
				&nbsp;&nbsp;2、本问卷旨在了解您可承受的风险程度、以及您的投资经验，借此协助您选择合适的理财产品类型，以达到您的投资目标。</br>
				&nbsp;&nbsp;3、本银行建议您，当您的状况有重大转变时，应对您的投资组合检视，以确保您的理财投资决定与可承受的投资风险程度一致。</br>
				&nbsp;&nbsp;声明：本投资风险评估问卷的准确性视乎您所填写的答案而定，如有任何疑问，您可以对投资产品是否合适进行独立评估</br>
			<div style="font-size:12px; line-height:16px; color:#929292;"> </div>
	   </div>
	</div>
	<!--风险评估查询结果页-->
	<div v-page v-transition="native" title="风险评估">
		<div class="bg_box">
			<div class="box_cont">
				<div class="zz_cont">
					<ul>
<!-- 						<li> -->
<!-- 							<em>客户号：</em> -->
<!-- 							<i> -->
<!-- 								{{riskInfo.clientNo}} -->
<!-- 							</i> -->
<!-- 						</li> -->
						<li>
							<em>风险等级：</em>
							<i>
								{{riskInfo.riskLevel|riskFilter}}
							</i>
						</li>
						<li>
							<em>评估日期：</em>
							<i>
								{{riskInfo.lastModifyDate}}
							</i>
						</li>
						<li>
							<em>有效日期：</em>
							<i>
								{{riskInfo.expiryDate}}
							</i>
						</li>
					</ul>
				</div>
				<div v-hide="isDone">
					<input type="button" class="button_1" name="button" value="重新评估"  v-click="toReRisk()">
				</div>
				<div v-show="isDone">
					<input type="button" class="button_1" name="button" value="完成"  v-click="finishRisk()">
				</div>
			</div>
		</div>
	</div>
	
	<!-- 重新评估页 -->
	<div v-page v-transition="native" title="风险评估">
		<div class="bg_box">
			<div class="box_cont">
				<!-- <div class="safe_cont bor_bott">
			    	<dl  v-repeat="test in testList">
						<dt >{{test.QstCdList}}、{{test.PrmtMsg}}</dt>
						<dt v-repeat="tq in test.content">
							<input type="radio"  name="q{{test.QstCdList}}" value="{{tq.QstOpt}}" required-message="请选择该题" required /> 
							<span class="pl5">{{tq.QstOpt}}、{{tq.PrmtMsg}}</span>
						</dt>
					</dl>
			    </div> -->
			    <div v-repeat="test in testList">
			    <div class="zz_cont">
			    	<ul class="lineheight1">
			    		<li class="size2">{{test.querstion}}</li>
			    		<li class="lineheight1" v-repeat="tq in test.ansList" v-click="selectOptions()">
			    		<input  type="radio" style="display:none"  name="q{{test.querstionNum}}" value="{{tq.answerNum}}" required-message="请选择该题" />
			    		{{tq.answer}}<img style="display:none" src="images/dh.png" class="dh_img"/></li>
			    	</ul>
			    </div>
			    <div class="j-heightb" v-hide="$index==testList.length-1"></div>
			    </div>
				
			</div>
		</div>
		<div class="zz_cont">
					<input type="button" class="button_1" name="button" value="提交"  v-click="toEstimate()">
				</div>
	</div>
	 <div style="width:100%;height:40px;"></div>
</div>
<script>
PRiskAssessCtrl.$inject = ["$scope","$remote","$targets","$filter","$context"];
function PRiskAssessCtrl($scope,$remote,$targets,$filter,$context){
	$scope.init=function(){
		$scope.isDone=false;
		$scope.riskCard=$context.getJson().riskCard;
		$scope.comefrom=$context.getJson().comefrom;
		//查询借记卡
		$remote.post("/pmobile/ActListQry.do",{},function(data){
			$scope.acList=data.AcList;
			if($scope.riskCard){
				for(var i=0;i<$scope.acList.length;i++){
					if($scope.acList[i].AcNo=$scope.riskCard.AcNo){
						$scope.payCard=$scope.acList[i];
					}
				}
			}else{
				$scope.payCard=$scope.acList[0];
			}
			
		});
	$scope.getClientState(function(response){
			var resJson=vx.fromJson(response);
			$scope.HostCustNo=resJson.Userinfo.HexinKehuhao;
			$scope.toQueryRisk();
		});
	}
	//查询风险评估
	$scope.toQueryRisk=function(){
	
// 		$remote.post("/pmobile/QueryLJLCFxpgInfo.do?",{"AcNo":$scope.HostCustNo,"accountType":"1"},function(data){
		$remote.post("/pmobile/QueryLJLCFxpgInfo.do?",{"AcNo":$scope.payCard.AcNo},function(data){
			if(data.flag==0){
				$scope.alert("请到柜台进行风险评估");
			}else{
				$scope.riskInfo=data;
				$targets("content","#2");
			}
		});
	}
	//重新评估
	$scope.toReRisk=function(){
		var params={
				"pageSize":10,
				"currentIndex":1
		}
		$remote.post("/pmobile/QueryFxpgProblem.do?",params,function(data){
			$scope.testList=data.List;
			$targets("content","#3");
		});
		
	
		
	}
	//完成
	$scope.finishRisk=function(){
		if($scope.comefrom){
			$scope.goto($scope.comefrom);
		}else{
			$targets("content","#0");
		}
	}
	//重新评估获取答题内容
	$scope.selectOptions=function(){
		var el=$(event.target);
		el.siblings('li').find("img:eq(0)").css("display","none");
		el.find("img:eq(0)").css("display","inline");
		
	}
	//获取重新评估结果
	$scope.toEstimate=function(){
		var str1="";
		var str2="";
    	var obj = {};
    	for(var i=0;i<$scope.testList.length;i++){
    		obj = $scope.testList[i];
    		var radArr = document.getElementsByName("q"+obj.querstionNum);
    		// 选中标志位
    		var falg = false;    	
    		for(var j=0;j<radArr.length;j++){
    			if(radArr[j].nextSibling.nextSibling.getAttribute("style","display").indexOf("inline")>0){
    				falg=true;
    				//score = score+(radArr[j].value-0);
    				if(i==0){
    					str1=str1+obj.querstionNum;
    	    			str2= str2+radArr[j].value;
    	    		}else{
    	    			str1=str1+","+obj.querstionNum;
    	    			str2= str2+","+radArr[j].value;
    	    		}
    				break;
    			}
    		}
    		if(!falg){
    			//$scope.toast("请选择第"+(i+1)+"题");
    			NativeCall.toast("请选择第"+obj.querstionNum+"题");
				return;
    		}
    	}
    	var params={
    			"AcNo":$scope.payCard.AcNo,
				"optionList":str2,
				"questionList":str1
		}
		$remote.post("/pmobile/PingGuInfo.do?",params,function(data){
			if(data._RejCode=="000000"){
				$scope.toQueryRisk();
				$scope.isDone=true;
				$scope.alert("风险评估成功！");
			}
		}); 
	}
}
</script>
//
//  PublicContentView.m
//  MobileClient
//
//  Created by xiaoxin on 15/7/8.
//  Copyright (c) 2015年 pro. All rights reserved.
//

#import "PublicContentView.h"
#import "MarqueeLabel.h"
#import "CSIIMenuViewController.h"
#define marQueeLabelHeight 50
@implementation PublicContentView


// Only override drawRect: if you perform custom drawing.
// An empty implementation adversely affects performance during animation.
- (void)drawRect:(CGRect)rect {
    
    if (![CSIIMenuViewController sharedInstance].isLoadPubview) {
        return;
    }
    
    count = 0;
    
    scrollview = [[UIScrollView alloc]initWithFrame:CGRectMake(0, 0, self.frame.size.width, marQueeLabelHeight)];
    scrollview.contentSize = CGSizeMake(self.frame.size.width,_contentArray.count*marQueeLabelHeight);
    scrollview.showsHorizontalScrollIndicator = NO;
    scrollview.showsVerticalScrollIndicator = NO;
    scrollview.scrollEnabled = NO;
    scrollview.pagingEnabled = YES;
    [scrollview setBounces:NO]; //禁止回弹
    scrollview.userInteractionEnabled = YES;
    scrollview.delegate = self;
    [self addSubview:scrollview];
    
    for (int x=0; x<_contentArray.count; x++) {
        
        UIButton *view = [[UIButton alloc]initWithFrame:CGRectMake(10, x*marQueeLabelHeight, self.frame.size.width-10, marQueeLabelHeight)];
        view.backgroundColor = [UIColor clearColor];
        view.tag = x;
        MarqueeLabel*adverLabel = [[MarqueeLabel alloc]initWithFrame:CGRectMake(20, x*marQueeLabelHeight-2, self.frame.size.width-10, 25)];
        adverLabel.marqueeType = MLContinuous;
        adverLabel.font = [UIFont systemFontOfSize:13];
        adverLabel.textColor = [UIColor whiteColor];
        adverLabel.scrollDuration = 30.0f;
//        adverLabel.tag = x;
        adverLabel.userInteractionEnabled = YES;
        [view addTarget:self action:@selector(click:) forControlEvents:UIControlEventTouchUpInside];
        
        adverLabel.animationCurve = UIViewAnimationCurveEaseOut;
        adverLabel.fadeLength = 0;                                //两面虚化的长度
        adverLabel.continuousMarqueeExtraBuffer =  10.0f;
        adverLabel.text = [[_contentArray objectAtIndex:x] objectForKey:@"CONTENT"];//常熟农商行手机银行全新改版，常乐生活，等你来享！！！！
        [scrollview addSubview:adverLabel];
        [scrollview addSubview:view];

    }
    
    timer = [NSTimer scheduledTimerWithTimeInterval:5.0 target:self selector:@selector(loopAction) userInfo:nil repeats:YES];
}

-(void)loopAction{
    
    if (count<_contentArray.count-1) {
        
        count++;
        [UIView beginAnimations:nil context:nil];
        [UIView setAnimationDuration:0.2];
        scrollview.contentOffset = CGPointMake(0, count*marQueeLabelHeight);
        [UIView commitAnimations];

    }else{
        count = 0;
        scrollview.contentOffset = CGPointMake(0, 0);
    }
}

-(void)click:(UIButton*)tap{
    UIAlertView *alert = [[UIAlertView alloc]initWithTitle:[_contentArray[tap.tag] objectForKey:@"TITLE"] message:[_contentArray[tap.tag] objectForKey:@"CONTENT"] delegate:nil cancelButtonTitle:@"确定" otherButtonTitles:nil, nil];
    [alert show];
}
@end
